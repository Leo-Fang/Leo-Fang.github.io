<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="第一章    MySQL的架构介绍1.MySQL简介(1)概述 MySQL是一个关系型数据库管理系统，由瑞典MySQL AB公司开发，目前属于Oracle公司 MySQL是开源的，可以定制的，采用了GPL协议，可以修改源码来开发自己的MySQL系统 MySQL使用标准的SQL数据语言形式 MySQL可以允许于多个系统上，并且支持多种编程语言，这些编程语言包括C、C++、Python、java、Pe">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL数据库高级">
<meta property="og:url" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/index.html">
<meta property="og:site_name" content="Ale&#39;s Blog">
<meta property="og:description" content="第一章    MySQL的架构介绍1.MySQL简介(1)概述 MySQL是一个关系型数据库管理系统，由瑞典MySQL AB公司开发，目前属于Oracle公司 MySQL是开源的，可以定制的，采用了GPL协议，可以修改源码来开发自己的MySQL系统 MySQL使用标准的SQL数据语言形式 MySQL可以允许于多个系统上，并且支持多种编程语言，这些编程语言包括C、C++、Python、java、Pe">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/1.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719103811113.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113314011.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113344286.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113405527.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113429371.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113520100.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113545044.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113602686.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719152443461.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719171007442.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720090236151.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170146447.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170232804.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170322672.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720174415147.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720174453840.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720203753017.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721095852167.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721100300793.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721100532010.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721101619421.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721102914134.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721103926563.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721104312421.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721111056758.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721142924442.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143020991.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143259926.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143330869.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721144052186.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721144435797.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721191359672.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721192125088.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195829927.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195858961.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195932229.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722100057188.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722100148097.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722112507313.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722143510467.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722171207411.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722172155448.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200722302.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200758738.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200845638.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200953934.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201209582.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201700817.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201810839.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201951185.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722202017690.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723092905973.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093305458.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093443722.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093623235.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093736405.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723101100109.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142027717.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142108459.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142208796.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142543868.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142252568.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142619236.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723143034424.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723143101859.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144016111.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144057701.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144316148.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144357729.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144523550.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145205136.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145245123.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145402418.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723151818787.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723153252670.png">
<meta property="og:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/20180313225542529.png">
<meta property="article:published_time" content="2020-07-17T08:28:00.762Z">
<meta property="article:modified_time" content="2020-07-23T12:33:59.992Z">
<meta property="article:author" content="Leo-Fang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/1.png">

<link rel="canonical" href="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MySQL数据库高级 | Ale's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ale's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo-Fang">
      <meta itemprop="description" content="记录学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ale's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL数据库高级
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-17 16:28:00" itemprop="dateCreated datePublished" datetime="2020-07-17T16:28:00+08:00">2020-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-23 20:33:59" itemprop="dateModified" datetime="2020-07-23T20:33:59+08:00">2020-07-23</time>
              </span>

          
            <span id="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/" class="post-meta-item leancloud_visitors" data-flag-title="MySQL数据库高级" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="第一章-MySQL的架构介绍"><a href="#第一章-MySQL的架构介绍" class="headerlink" title="第一章    MySQL的架构介绍"></a>第一章    MySQL的架构介绍</h3><h4 id="1-MySQL简介"><a href="#1-MySQL简介" class="headerlink" title="1.MySQL简介"></a>1.MySQL简介</h4><h5 id="1-概述"><a href="#1-概述" class="headerlink" title="(1)概述"></a>(1)概述</h5><ul>
<li>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB公司开发，目前属于Oracle公司</li>
<li>MySQL是开源的，可以定制的，采用了GPL协议，可以修改源码来开发自己的MySQL系统</li>
<li>MySQL使用标准的SQL数据语言形式</li>
<li>MySQL可以允许于多个系统上，并且支持多种编程语言，这些编程语言包括C、C++、Python、java、Perl、PHP、Eiffel、Ruby和Tcl等</li>
<li>MySQL支持大型数据库，支持5000万条记录的数据仓库，32位系统支持的最大表文件为4GB，64位系统支持的最大表文件为8TB</li>
</ul>
<a id="more"></a>

<h5 id="2-高级MySQL"><a href="#2-高级MySQL" class="headerlink" title="(2)高级MySQL"></a>(2)高级MySQL</h5><ul>
<li>数据库内部结构和原理</li>
<li>数据库建模优化</li>
<li>数据库索引建立</li>
<li>SQL语句优化</li>
<li>SQL编程（自定义函数、存储过程、触发器、定时任务）</li>
<li>mysql服务器的安装配置</li>
<li>数据库的性能监控分析与系统优化</li>
<li>各种参数常量设定</li>
<li>主从复制</li>
<li>分布式架构搭建、垂直切割和水平切割</li>
<li>数据迁移</li>
<li>容灾备份和恢复</li>
<li>shell或python等脚本语言开发</li>
<li>对开源数据库进行二次开发</li>
</ul>
<h4 id="2-MySQL的Linux版安装"><a href="#2-MySQL的Linux版安装" class="headerlink" title="2.MySQL的Linux版安装"></a>2.MySQL的Linux版安装</h4><h5 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="(1)准备工作"></a>(1)准备工作</h5><p>(1)检查当前系统是否安装过mysql</p>
<p>①CentOS6环境下</p>
<p>命令：<code>rpm -qa | grep mysql</code></p>
<p>默认Linux在安装的时候，自带了mysql相关的组件，先卸载系统自带的mysql，执行卸载命令：<code>rpm -e --nodeps mysql-libs</code></p>
<p>②CentOS7环境下</p>
<p>命令：<code>rpm -qa | grep mariadb</code></p>
<p>默认Linux（CentOS7）在安装的时候，自带了mariadb（mysql完全开源版本）相关的组件，先卸载系统自带的mariadb，执行卸载命令：<code>rpm -e --nodeps mariadb-libs</code></p>
<p>(2)检查/tmp文件夹权限</p>
<p>查看/tmp文件夹权限：<code>ls -l</code></p>
<p>赋予其最大权限：<code>chmod -R 777 /tmp</code></p>
<h5 id="2-安装MySQL"><a href="#2-安装MySQL" class="headerlink" title="(2)安装MySQL"></a>(2)安装MySQL</h5><p>参考笔记<a href="[https://leo-fang.github.io/2020/07/12/Linux%E5%85%A5%E9%97%A8/](https://leo-fang.github.io/2020/07/12/Linux入门/)">Linux入门</a>中的第十四节第4点《安装MySQL》，这里不再赘述</p>
<h5 id="3-MySQL的安装路径及说明"><a href="#3-MySQL的安装路径及说明" class="headerlink" title="(3)MySQL的安装路径及说明"></a>(3)MySQL的安装路径及说明</h5><table>
<thead>
<tr>
<th>参数</th>
<th>路径</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>–datadir</td>
<td>/var/lib/mysql/</td>
<td>mysql数据库文件的存放路径</td>
<td></td>
</tr>
<tr>
<td>–basedir</td>
<td>/usr/bin</td>
<td>相关命令目录</td>
<td>mysqladmin、mysqldump等命令</td>
</tr>
<tr>
<td>–plugin-dir</td>
<td>/usr/lib64/mysql/plugin</td>
<td>mysql插件存放路径</td>
<td></td>
</tr>
<tr>
<td>–socket</td>
<td>/var/lib/mysql/mysql.sock</td>
<td>本地连接时用的unix套接字文件</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/usr/share/mysql</td>
<td>配置文件目录</td>
<td>mysql脚本及配置文件</td>
</tr>
<tr>
<td></td>
<td>/etc/init.d/mysql</td>
<td>服务启停相关脚本</td>
<td></td>
</tr>
</tbody></table>
<h5 id="4-修改字符集"><a href="#4-修改字符集" class="headerlink" title="(4)修改字符集"></a>(4)修改字符集</h5><p>(1)常用命令</p>
<table>
<thead>
<tr>
<th>SQL语句</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>show databases</td>
<td>列出所有数据库</td>
</tr>
<tr>
<td>create database 库名</td>
<td>创建一个数据库</td>
</tr>
<tr>
<td>create database 库名 character set utf8</td>
<td>创建数据库且执行字符集为utf-8</td>
</tr>
<tr>
<td>show create database 库名</td>
<td>查看数据库的字符集</td>
</tr>
<tr>
<td>show variables like ‘%char%’</td>
<td>查询所有跟字符集相关的信息</td>
</tr>
<tr>
<td>set [字符集属性]=utf8</td>
<td>设置相应的属性为utf8（只是临时修改，当前有效，服务重启后失效）</td>
</tr>
<tr>
<td>alter database 库名 character set ‘utf8’</td>
<td>修改数据库的字符集</td>
</tr>
<tr>
<td>alter table 表名 convert to character set ‘utf8’</td>
<td>修改表的字符集</td>
</tr>
</tbody></table>
<p>(2)字符集乱码的原因</p>
<p>如果在建库建表的时候，没有明确指定字符集，有些版本的mysql默认的字符集是latin1，其中是不包含中文字符的。可以通过修改mysql配置文件或修改已创建库、表的字符集来处理乱码，但是已经乱码的数据只能通过删除数据重新插入或更新数据才可以完全解决。</p>
<h4 id="3-MySQL逻辑架构"><a href="#3-MySQL逻辑架构" class="headerlink" title="3.MySQL逻辑架构"></a>3.MySQL逻辑架构</h4><h5 id="1-整体架构"><a href="#1-整体架构" class="headerlink" title="(1)整体架构"></a>(1)整体架构</h5><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/1.png" class="">

<p>MySQL插件式的存储引擎架构将查询处理和其他的系统任务以及数据的存储提取相分离，这种架构可以根据业务的需求和实际需要选择合适的存储引擎</p>
<p>各层介绍：</p>
<ul>
<li><p>连接层</p>
<p>最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信，主要完成一些类似于连接处理、授权认证及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接，服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p>
</li>
<li><p>服务层</p>
<table>
<thead>
<tr>
<th>Management Services &amp; Utilities</th>
<th>系统管理和控制工具</th>
</tr>
</thead>
<tbody><tr>
<td>SQL Interface</td>
<td>SQL接口。接受用户的SQL命令，并且返回用户需要查询的结果，比如select from就是调用SQL Interface</td>
</tr>
<tr>
<td>Parser</td>
<td>解析器。SQL命令传递到解析器的时候会被解析器验证和解析</td>
</tr>
<tr>
<td>Optimizer</td>
<td>查询优化器。SQL语句在查询之前会使用查询优化器对查询进行优化，比如有where条件时，优化器来决定先投影还是先过滤</td>
</tr>
<tr>
<td>Cache &amp; Buffer</td>
<td>查询缓存。如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据，这个缓存机制是由一系列小缓存组成的，比如表缓存，记录缓存，key缓存，权限缓存等</td>
</tr>
</tbody></table>
</li>
<li><p>引擎层</p>
<p>存储引擎层真正地负责了MySQL中数据的存储和提取，服务器通过API与存储引擎进行通信，不同的存储引擎具有的功能不同，这样就可以根据自己的实际需要进行选取。</p>
</li>
<li><p>存储层</p>
<p>数据存储层主要是将数据存储在运行于裸设备的文件系统之上，并完成与存储引擎的交互。</p>
</li>
</ul>
<h5 id="2-SQL执行周期"><a href="#2-SQL执行周期" class="headerlink" title="(2)SQL执行周期"></a>(2)SQL执行周期</h5><p>查看SQL的执行周期：<code>show profile;</code></p>
<p>查看profile是否开启：<code>show variables like &#39;%profiling%&#39;;</code></p>
<p>如果没有开启，可以执行<code>set profiling=1;</code>开启</p>
<p>查看最近的几次查询：<code>show profiles;</code></p>
<p>根据Query_ID查看SQL具体的执行步骤：<code>show profile cpu,block io for query Query_ID;</code></p>
<h5 id="3-MySQL的查询流程"><a href="#3-MySQL的查询流程" class="headerlink" title="(3)MySQL的查询流程"></a>(3)MySQL的查询流程</h5><ul>
<li>MySQL的查询流程大致是：MySQL客户端通过协议与MySQL服务器建连接，发送查询语句，先检查查询缓存，如果命中则直接返回结果，否则进行语句解析，也就是说在解析查询之前，服务器会先访问查询缓存（query cache）——它存储select语句以及相应的查询结果集。如果某个查询结果已经位于缓存中，服务器就不会再对查询进行解析、优化以及执行，它仅仅将缓存中的结果返回给用户即可，大大提高了系统的性能。</li>
<li>语法解析器和预处理：首先MySQL通过关键字将SQL语句进行解析，并生成一棵对应的“解析树”。MySQL解析器将使用MySQL语法规则验证和解析查询，预处理器则根据一些MySQL规则进一步检查解析树是否合法。查询优化器当解析树被认为是合法的了，并且由优化器将其转化成执行计划，一条查询可以有很多种执行方式，最后都返回相同的结果，优化器的作用就是找到这其中最好的执行计划。然后MySQL默认使用的BTREE索引，并且一个大致的方向是：无论怎么折腾SQL，至少在目前来说，MySQL最多只用到表中的一个索引。</li>
</ul>
<h4 id="4-MySQL存储引擎"><a href="#4-MySQL存储引擎" class="headerlink" title="4.MySQL存储引擎"></a>4.MySQL存储引擎</h4><p><strong>MyISAM和InnoDB</strong></p>
<table>
<thead>
<tr>
<th align="center">对比项</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td align="center">外键</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td align="center">事务</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td align="center">行表锁</td>
<td>表锁，即使操作一条记录也会锁住整个表，<br>不适合高并发的操作</td>
<td>行锁，操作时只锁某一行，不对其他行有影响，<br>适合高并发的操作</td>
</tr>
<tr>
<td align="center">缓存</td>
<td>只缓存索引，不缓存真实数据</td>
<td>不仅缓存索引，还要缓存真实数据，对内存要<br>求较高，而且内存大小对性能有决定性的影响</td>
</tr>
<tr>
<td align="center">关注点</td>
<td>读性能</td>
<td>并发写、事务、资源</td>
</tr>
<tr>
<td align="center">默认安装</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td align="center">默认使用</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td align="center">自带系统表使用</td>
<td>Y</td>
<td>N</td>
</tr>
</tbody></table>
<p>查看所有的数据库引擎：<code>show engines</code></p>
<p>查看默认的数据库引擎：<code>show variables like &#39;%storage_engine%&#39;</code></p>
<h3 id="第二章-索引优化分析"><a href="#第二章-索引优化分析" class="headerlink" title="第二章    索引优化分析"></a>第二章    索引优化分析</h3><h4 id="1-SQL性能问题"><a href="#1-SQL性能问题" class="headerlink" title="1.SQL性能问题"></a>1.SQL性能问题</h4><p>性能下降，SQL慢，执行时间长，等待时间长的原因：</p>
<p>①查询语句写的烂</p>
<p>②索引失效</p>
<p>③关联查询太多JOIN（设计缺陷或不得已的需求）</p>
<p>④服务器调优及各个参数设置（缓冲、线程数等）</p>
<h4 id="2-常见通用的JOIN查询"><a href="#2-常见通用的JOIN查询" class="headerlink" title="2.常见通用的JOIN查询"></a>2.常见通用的JOIN查询</h4><h5 id="1-SQL执行顺序"><a href="#1-SQL执行顺序" class="headerlink" title="(1)SQL执行顺序"></a>(1)SQL执行顺序</h5><ul>
<li><p>手写顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT &lt;select_list&gt;</span><br><span class="line">FROM &lt;left_table&gt; </span><br><span class="line">&lt;join_type&gt; JOIN &lt;right_table&gt; </span><br><span class="line">ON &lt;join_condition&gt;</span><br><span class="line">WHERE &lt;where_condition&gt;</span><br><span class="line">GROUP BY &lt;group_by_list&gt;</span><br><span class="line">HAVING &lt;having_condition&gt;</span><br><span class="line">ORDER BY &lt;order_by_condition&gt;</span><br><span class="line">LIMIT &lt;limit_number&gt;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>机读顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;left_table&gt;</span><br><span class="line">ON &lt;join_condition&gt;</span><br><span class="line">&lt;join_type&gt; JOIN &lt;right_table&gt; </span><br><span class="line">WHERE &lt;where_condition&gt;</span><br><span class="line">GROUP BY &lt;group_by_list&gt;</span><br><span class="line">HAVING &lt;having_condition&gt;</span><br><span class="line">SELECT </span><br><span class="line">DISTINCT &lt;select_list&gt;</span><br><span class="line">ORDER BY &lt;order_by_condition&gt;</span><br><span class="line">LIMIT &lt;limit_number&gt;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="2-JOIN图"><a href="#2-JOIN图" class="headerlink" title="(2)JOIN图"></a>(2)JOIN图</h5><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719103811113.png" class="">

<h5 id="3-SQL建表"><a href="#3-SQL建表" class="headerlink" title="(3)SQL建表"></a>(3)SQL建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tbl_dept&#96; (</span><br><span class="line">&#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;deptName&#96; varchar(30) DEFAULT NULL,</span><br><span class="line">&#96;locAdd&#96; varchar(40) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 1 CHARACTER SET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;tbl_emp&#96; (</span><br><span class="line">&#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;name&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">&#96;deptId&#96; int(11) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (&#96;id&#96;) ,</span><br><span class="line">KEY &#96;fk_dept_id&#96;(&#96;deptId&#96;)</span><br><span class="line">)ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 1 CHARACTER SET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_dept(deptName,locAdd) VALUES(&#39;RD&#39;,11);</span><br><span class="line">INSERT INTO tbl_dept(deptName,locAdd) VALUES(&#39;HR&#39;,12);</span><br><span class="line">INSERT INTO tbl_dept(deptName,locAdd) VALUES(&#39;MK&#39;,13);</span><br><span class="line">INSERT INTO tbl_dept(deptName,locAdd) VALUES(&#39;MIS&#39;,14);</span><br><span class="line">INSERT INTO tbl_dept(deptName,locAdd) VALUES(&#39;FD&#39;,15);</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;z3&#39;,1);</span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;z4&#39;,1);</span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;z5&#39;,1);</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;w5&#39;,2);</span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;w6&#39;,2);</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;s7&#39;,3);</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;s8&#39;,4);</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_emp(Name,deptId) VALUES(&#39;s9&#39;,51);</span><br></pre></td></tr></table></figure>

<h5 id="4-7种JOIN演示"><a href="#4-7种JOIN演示" class="headerlink" title="(4)7种JOIN演示"></a>(4)7种JOIN演示</h5><p>①</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113314011.png" class="">

<p>②</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113344286.png" class="">

<p>③</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113405527.png" class="">

<p>④</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113429371.png" class="">

<p>⑤</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113520100.png" class="">

<p>⑥</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113545044.png" class="">

<p>⑦</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719113602686.png" class="">

<p>【注】MySQL中不支持外连接</p>
<h4 id="3-索引简介"><a href="#3-索引简介" class="headerlink" title="3.索引简介"></a>3.索引简介</h4><h5 id="1-概念"><a href="#1-概念" class="headerlink" title="(1)概念"></a>(1)概念</h5><ul>
<li><p>MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。所以索引的本质是数据结构。</p>
</li>
<li><p>可以简单理解为<span style='color:red;'>排好序的</span><span style='color:blue;'>快速查找</span><span style='color:fuchsia;'>数据结构</span>。</p>
</li>
<li><p>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
</li>
<li><p>下图是一种可能的索引方式</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719152443461.png" class="">

<p>左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址，为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在一定的复杂度内获取到相应数据，从而快速的检索出符合条件的记录。</p>
</li>
<li><p>一般来说，索引本身也很大，不可能全部存储在内存中，因此<span style='color:red;'>索引往往以索引文件的形式存储在磁盘上</span>。</p>
</li>
<li><p><span style='color:red;'>我们平常所说的索引，如果没有特别说明，都是指B数（多路搜索树，并不一定是二叉的）结构组织的索引</span>。其中聚集索引，次要索引，覆盖索引，复合索引，前缀索引，唯一索引，默认都是使用B+数索引，统称索引。除了B+树这种类型的索引之外，还有哈希索引（hash index）等。</p>
</li>
</ul>
<h5 id="2-优势"><a href="#2-优势" class="headerlink" title="(2)优势"></a>(2)优势</h5><ul>
<li>类似大学图书馆建书目索引，<span style='color:red;'>提高数据检索的效率，降低数据库的IO成本</span></li>
<li>通过索引列对数据进行排序，<span style='color:red;'>降低数据排序的成本，降低了CPU的消耗</span></li>
</ul>
<h5 id="3-劣势"><a href="#3-劣势" class="headerlink" title="(3)劣势"></a>(3)劣势</h5><ul>
<li>实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，所以<span style='color:red;'>索引列也是要占用空间的</span></li>
<li>虽然索引大大提高了查询速度，但是同时<span style='color:red;'>会降低更新表的速度</span>，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存索引文件每次更新添加了的索引列字段，都会调整因为更新所带来的键值变化后的索引信息</li>
<li>索引至少提高效率的一个因素，如果MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句</li>
</ul>
<h5 id="4-MySQL索引分类"><a href="#4-MySQL索引分类" class="headerlink" title="(4)MySQL索引分类"></a>(4)MySQL索引分类</h5><ul>
<li><p>单值索引：一个索引只包含单个列，一个表可以有多个单列索引</p>
</li>
<li><p>唯一索引：索引列的值必须唯一，但允许有空值</p>
</li>
<li><p>主键索引：设定为主键后数据库会自动建立索引</p>
</li>
<li><p>复合索引：一个索引包含多个列</p>
</li>
<li><p>基本语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#创建</span><br><span class="line">CREATE [UNIQUE] INDEX indexName ON tableName(columnName(length));</span><br><span class="line">（如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定length）</span><br><span class="line">ALTER tableName ADD [UNIQUE] INDEX [indexName] ON (columnName(length));</span><br><span class="line"></span><br><span class="line">#删除</span><br><span class="line">DROP INDEX [indexName] ON tableName;</span><br><span class="line"></span><br><span class="line">#查看</span><br><span class="line">SHOW INDEX FROM tableName;</span><br></pre></td></tr></table></figure>

<p>添加数据表索引的四种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tableName ADD PRIMARY KEY(column_list);</span><br><span class="line">#该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL</span><br><span class="line"></span><br><span class="line">ALTER TABLE tableName ADD UNIQUE index_name(column_list);</span><br><span class="line">#这条数据创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次</span><br><span class="line"></span><br><span class="line">ALTER TABLE tableName ADD INDEX index_name(column_list);</span><br><span class="line">#添加普通索引，索引值可出现多次</span><br><span class="line"></span><br><span class="line">ALTER TABLE tableName ADD FULLTEXT index_name(column_list);</span><br><span class="line">#该语句指定了索引为FULLTEXT，用于全文索引</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="5-MySQL索引结构"><a href="#5-MySQL索引结构" class="headerlink" title="(5)MySQL索引结构"></a>(5)MySQL索引结构</h5><ul>
<li><p>BTree索引</p>
<p>MySQL使用的是BTree索引</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200719171007442.png" class="">

<p>【初始化介绍】</p>
<p>一棵B树，浅蓝色的块称之为磁盘块，每个磁盘块包含几个数据项（深蓝色所示）和指针（黄色所示）。如磁盘块1包含数据项17和35，包含指针P1、P2、P3，P1表示小于17的磁盘块，P2表示在17和35之间的磁盘块，P3表示大于35的磁盘块。</p>
<p><span style='color:red;'>真实的数据存在于叶子节点</span>，即3、5、9、10、13、15、28、29、36、60、75、79、90、99。</p>
<p><span style='color:red;'>非叶子节点不存储真实的数据，只存储指引搜索方向的数据项</span>，如17、35并不真实存在于数据表中。</p>
<p>【查找过程】</p>
<p>如果要查找数据项29，首先会把磁盘块1由磁盘加载到内存，此时发生一次IO。在内存中用二分法查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短（相比磁盘的IO）可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO。29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分法查找找到29，结束查询，总计三次IO。</p>
<p>真实的情况是，3层的B+树可以表示上百万的数据，如果上百万的数据查找只需要三次IO，性能提高将是巨大的，如果没有索引，每个数据项都要发生一次IO，那么总共需要百万次的IO，显然成本非常非常高。</p>
</li>
<li><p>Hash索引</p>
</li>
<li><p>full-text全文索引</p>
</li>
<li><p>R-Tree索引</p>
</li>
</ul>
<h5 id="6-哪些情况需要创建索引"><a href="#6-哪些情况需要创建索引" class="headerlink" title="(6)哪些情况需要创建索引"></a>(6)哪些情况需要创建索引</h5><ul>
<li>主键自动建立唯一索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其它表关联的字段，外键关系建立索引</li>
<li>单键/组合索引的选择问题——在高并发下倾向创建组合索引</li>
<li>查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度（也就是ORDER BY的顺序和索引的顺序一致会更好）</li>
<li>查询中统计或者分组字段</li>
</ul>
<h5 id="7-哪些情况不要创建索引"><a href="#7-哪些情况不要创建索引" class="headerlink" title="(7)哪些情况不要创建索引"></a>(7)哪些情况不要创建索引</h5><ul>
<li>表记录太少</li>
<li>频繁更新的字段不适合创建索引——因为每次更新不单单是更新了记录还会更新索引</li>
<li>WHERE条件里用不到的字段不创建索引</li>
<li>过滤性不好的不适合建索引</li>
</ul>
<p>数据重复且分布平均的表字段，应该只为最经常查询和最经常排序的数据列建立索引。如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
<p><span style='color:red;'>索引的选择性</span>是指索引列中不同值的数目与表中记录数的比。如果一个表中有2000条记录，表索引列有1980个不同的值，那么这个索引的选择性就是1980/2000=0.99。<span style='color:red;'>一个索引的选择性越接近于1，这个索引的效率就越高。</span></p>
<h4 id="4-性能分析"><a href="#4-性能分析" class="headerlink" title="4.性能分析"></a>4.性能分析</h4><h5 id="1-MySQL-Query-Optimizer"><a href="#1-MySQL-Query-Optimizer" class="headerlink" title="(1)MySQL Query Optimizer"></a>(1)MySQL Query Optimizer</h5><ul>
<li>MySQL中有专门负责优化SELECT语句的优化器模块，主要功能是通过计算分析系统中收集到的统计信息，为客户端请求的Query提供它认为的最优执行计划（它认为最优的数据检索方式不见得是DBA认为最优的，这部分最耗费时间）</li>
<li>当客户端向MySQL请求一条Query，命令解析器模块完成请求分类，区别出是SELECT并转发给MySQL Query Optimizer时，MySQL Query Optimizer首先会对整条Query进行优化，处理掉一些常量表达式的预算，直接换算成常量值，并对Query中的查询条件进行简化和转换，如去掉一些无用或显而易见的条件、结构调制等。然后分析Query中的Hint信息（如果有），看显示Hint信息是否可以完全确定该Query的执行计划。如果没有Hint或Hint信息还不足以完全确定执行计划，则会读取所涉及对象的统计信息，根据Query进行写相应的计算分析，然后再得出最后的执行计划。</li>
</ul>
<h5 id="2-MySQL常见瓶颈"><a href="#2-MySQL常见瓶颈" class="headerlink" title="(2)MySQL常见瓶颈"></a>(2)MySQL常见瓶颈</h5><ul>
<li>CPU：CPU在饱和的时候一般发生在数据装入内存或从磁盘上读取数据的时候</li>
<li>IO：磁盘IO瓶颈发生在装入数据远大于内存容量的时候</li>
<li>服务器硬件的性能：top，free，iostat和vmstat来查看系统的性能状态</li>
</ul>
<h5 id="3-Explain"><a href="#3-Explain" class="headerlink" title="(3)Explain"></a>(3)Explain</h5><ul>
<li><p>概念：使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL时如何处理你的SQL语句，分析你的查询语句或是表结构的性能瓶颈。</p>
</li>
<li><p>功能</p>
<p>①表的读取顺序</p>
<p>②数据读取操作的操作类型</p>
<p>③哪些索引可以使用</p>
<p>④哪些索引被实际使用</p>
<p>⑤表之间的引用</p>
<p>⑥每张表有多少行被优化器查询</p>
</li>
<li><p>用法：EXPLAIN + SQL语句</p>
<p>执行后返回的信息：</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720090236151.png" class="">
</li>
<li><p>各字段解释</p>
<p><strong>①id</strong>：SELECT查询的序列号，包含一组数字，表示查询中执行SELECT子句或操作表的顺序</p>
<p>三种情况：</p>
<p>a.id相同，执行顺序由上至下</p>
<p>b.id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行</p>
<p>c.id有相同也有不同——id相同的可以认为是一组，从上往下顺序执行，在所有组中，id值越大，优先级越高，越先执行衍生（DERIVED）</p>
<p>【注】每个id号表示一趟独立的查询，一个SQL查询的趟数越少越好</p>
<p><strong>②select_type</strong>：查询的类型，主要是用于区别普通查询、联合查询、子查询等的复杂查询</p>
<table>
<thead>
<tr>
<th>select_type属性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>SIMPLE</td>
<td>简单的SELECT查询，查询中不包含子查询或者UNION</td>
</tr>
<tr>
<td>PRIMARY</td>
<td>查询中若包含任何复杂的子部分，最外层查询则被标记为PRIMARY</td>
</tr>
<tr>
<td>DERIVED</td>
<td>在FROM列表中包含的子查询被标记为DERIVED（衍生）<br>MySQL会递归执行这些子查询，把结果放在临时表里</td>
</tr>
<tr>
<td>SUBQUERY</td>
<td>在SELECT或WHERE列表中包含了子查询</td>
</tr>
<tr>
<td>DEPENDENT SUBQUERY</td>
<td>在SELECT或WHERE列表中包含了子查询，子查询基于外层</td>
</tr>
<tr>
<td>UNCACHEABLE SUBQUERY</td>
<td>无法使用缓存的子查询</td>
</tr>
<tr>
<td>UNION</td>
<td>若第二个SELECT出现在UNION之后，则被标记为UNION；<br>若UNION包含在FROM子句的子查询中，外层SELECT将被标记为：DERIVED</td>
</tr>
<tr>
<td>UNION RESULT</td>
<td>从UNION表获取结果的SELECT</td>
</tr>
</tbody></table>
<p><strong>③table</strong>：显示这一行的数据是关于哪张表的</p>
<p><strong>④type</strong>：查询的访问类型</p>
<p>从好到差依次是（加粗的表示常见的类型）：</p>
<p><strong>system&gt;const&gt;eq_ref&gt;ref&gt;</strong>[fulltext&gt;ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_subquery&gt;]<strong>range&gt;index&gt;ALL</strong></p>
<p><span style='color:orange;'>一般来说，得保证查询至少达到range级别，最好能达到ref</span></p>
<table>
<thead>
<tr>
<th>type属性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>system</strong></td>
<td>表只有一行记录（等于系统表），是const类型的特例，平时不会出现，可以忽略不计</td>
</tr>
<tr>
<td><strong>const</strong></td>
<td>表示通过索引一次就找到了，const用于比较PRIMARY KEY或者UNIQUE索引，因为只匹配一行数据，所以很快。如将主键置于WHERE列表中，MySQL就能将该查询转换为一个常量</td>
</tr>
<tr>
<td><strong>eq_ref</strong></td>
<td>唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引扫描</td>
</tr>
<tr>
<td><strong>ref</strong></td>
<td>非唯一性索引扫描，返回匹配某个单独值的所有行。本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而它可能会找到多个符合条件的行，所以它应该属于查找和扫描的混合体</td>
</tr>
<tr>
<td><strong>range</strong></td>
<td>只检索给定范围的行，使用一个索引来选择行。key列显示使用了哪个索引一般就是在WHERE语句中出现了BETWEEN、&lt;、&gt;、IN等的查询。这种范围扫描、索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，结束于另一点，不用扫描全部索引</td>
</tr>
<tr>
<td><strong>index</strong></td>
<td>Full Index Scan，出现index是SQL使用了索引但是没通过索引进行过滤，一般是使用了覆盖索引或是利用索引进行了排序分组。index和ALL的区别为：index类型只遍历索引树，这通常比ALL快，因为索引文件通常比数据文件小，也就是说虽然index和ALL都是读全表，但index是从索引中读取的，而ALL是从硬盘中读取的</td>
</tr>
<tr>
<td><strong>ALL</strong></td>
<td>Full Table Scan，将遍历全表以找到匹配的行</td>
</tr>
<tr>
<td>fulltext</td>
<td>全文索引检索。全文索引的优先级很高，若全文索引和普通索引同时存在时，MySQL不管代价优先选择使用全文索引</td>
</tr>
<tr>
<td>ref_or_null</td>
<td>对于某个字段既需要关联条件，又需要NULL值的情况下，查询优化器会选择用ref_or_null连接查询</td>
</tr>
<tr>
<td>index_merge</td>
<td>在查询过程中需要多个索引组合使用，通常出现在有OR关键字的SQL中</td>
</tr>
<tr>
<td>unique_subquery</td>
<td>利用索引来关联子查询，不再全表扫描</td>
</tr>
<tr>
<td>index_subquery</td>
<td>该连接类型类似于index_subquery，子查询中的唯一索引</td>
</tr>
</tbody></table>
<p><strong>⑤possible_keys</strong>：显示可能应用在这张表中的索引（一个或多个）</p>
<p>查询涉及到的字段上若存在索引，则该索引将被列出，<span style='color:orange;'>但不一定被查询实际使用</span></p>
<p><strong>⑥key</strong>：实际使用的索引</p>
<p>如果为NULL，则没有使用索引；<span style='color:blue;'>查询中若使用了覆盖索引，则该索引仅出现在key列表中</span></p>
<p><strong>⑦key_len</strong>：表示索引中使用的字节数</p>
<p>可通过该列计算查询中使用的索引的长度。key_len字段能够帮你检查是否充分的利用上了索引，key_len越长，说明索引使用的越充分，在不损失精确性的情况下，长度越短越好。</p>
<p>key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len时根据表定义计算而得，不是通过表内检索出的。</p>
<p>如何计算key_len：</p>
<p>a.先看索引上字段的类型和长度，比如：int = 4; varchar(20) = 20; char(20) = 20</p>
<p>b.如果是varchar或char这种字符串字段，视字符集要乘不同的值，比如：utf-8要乘3，GBK要乘2</p>
<p>c.varchar这种动态字符串要加2个字节</p>
<p>d.允许为NULL的字段还要加1个字节</p>
<p><strong>⑧ref</strong>：显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值</p>
<p><strong>⑨rows</strong>：根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数，越少越好</p>
<p><strong>⑩Extra</strong>：包含不适合在其他列中显示但十分重要的额外信息</p>
<p>a.<span style='color:orange;'>Using filesort</span>：说明MySQL会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取。MySQL中无法利用索引完成的排序操作称为“文件排序”</p>
<p>b.<span style='color:orange;'>Using temporary</span>：使用了临时表保存中间结果，MySQL在对查询结果排序时使用临时表，常见于排序ORDER BY和分组查询GROUP BY</p>
<p>c.<span style='color:orange;'>Using index</span>：表示相应的SELECT操作中使用了覆盖索引（Covering Index），避免访问了表的数据行，效率好</p>
<p>如果没有同时出现using where，表明索引被用来执行索引键值的查找；如果没有同时出现using where，表明索引用来读取数据而非执行查找动作</p>
<p>覆盖索引</p>
<p>d.Using where：使用了WHERE过滤</p>
<p>e.using join buffer：使用了连接缓存</p>
<p>f.impossible where：WHERE子句的值总是false，不能用来获取任何元组</p>
<p>g.select tables optimized away：在没有GROUP BY子句的情况下，基于索引优化MIN/MAX操作或者对于MyISAM存储引擎优化COUNT(*)操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化</p>
<p>h.distinct：优化DISTINCT操作，在找到第一匹配的元组后即停止找同样值的动作</p>
</li>
</ul>
<h4 id="5-索引优化"><a href="#5-索引优化" class="headerlink" title="5.索引优化"></a>5.索引优化</h4><h5 id="1-索引分析"><a href="#1-索引分析" class="headerlink" title="(1)索引分析"></a>(1)索引分析</h5><ul>
<li><p>单表</p>
<p>建表SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;article&#96;(</span><br><span class="line">&#96;id&#96; INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">&#96;author_id&#96; INT(10) UNSIGNED NOT NULL,</span><br><span class="line">&#96;category_id&#96; INT(10) UNSIGNED NOT NULL, </span><br><span class="line">&#96;views&#96; INT(10) UNSIGNED NOT NULL, </span><br><span class="line">&#96;comments&#96; INT(10) UNSIGNED NOT NULL,</span><br><span class="line">&#96;title&#96; VARBINARY(255) NOT NULL,</span><br><span class="line">&#96;content&#96; TEXT NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;article&#96;(&#96;author_id&#96;,&#96;category_id&#96;,&#96;views&#96;,&#96;comments&#96;,&#96;title&#96;,&#96;content&#96;) VALUES</span><br><span class="line">(1,1,1,1,&#39;1&#39;,&#39;1&#39;),</span><br><span class="line">(2,2,2,2,&#39;2&#39;,&#39;2&#39;),</span><br><span class="line">(1,1,3,3,&#39;3&#39;,&#39;3&#39;);</span><br><span class="line"> </span><br><span class="line">SELECT * FROM article;</span><br></pre></td></tr></table></figure>

<p>案例分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#查询category_id为1且comments大于1的情况下，views最多的article_id</span><br><span class="line">SELECT id,author_id FROM article WHERE category_id &#x3D; 1 AND comments &gt; 1</span><br><span class="line">ORDER BY views DESC LIMIT 1;</span><br><span class="line">#第1次EXPLAIN</span><br><span class="line">EXPLAIN SELECT id,author_id FROM article WHERE category_id &#x3D; 1 AND comments &gt; 1</span><br><span class="line">ORDER BY views DESC LIMIT 1;</span><br><span class="line">#结论：type是ALL，即最坏的情况，Extra中出现了Using filesort，也是最坏的情况，必须优化</span><br><span class="line"></span><br><span class="line">#开始优化</span><br><span class="line">#1.新建索引（两种方式）+EXPLAIN</span><br><span class="line">CREATE INDEX idx_article_ccv ON article(category_id,comments,views);</span><br><span class="line">[ALTER TABLE article ADD INDEX idx_article_ccv (category_id,comments,views);]</span><br><span class="line">#结论：第2次EXPLAIN后，type变成了range，这是可以接受的，但是Extra中是Using filesort是无法接受的</span><br><span class="line">&#x2F;*</span><br><span class="line">为何建立了索引却没有效果？</span><br><span class="line">	这是因为按照BTree索引的原理，先排序category_id，再排序comments，如果遇到相同的comments，则再排序views。</span><br><span class="line">当comments字段在联合索引里处于中间位置时，因为comments&gt;1条件是一个范围值（所谓range），MySQL无法利用索引再对后面的views部分进行检索，即range类型查询字段后面的索引无效。</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">#2.删除索引</span><br><span class="line">DROP INDEX idx_article_ccv ON article;</span><br><span class="line">#第2次新建索引+EXPLAIN</span><br><span class="line">CREATE INDEX idx_article_cv ON article(category_id,views);</span><br><span class="line">[ALTER TABLE article ADD INDEX idx_article_cv (category_id,views);]</span><br><span class="line">#结论：type变成了ref，Extra中的Using filesort也消失了，结果非常理想</span><br><span class="line">DROP INDEX idx_article_cv ON article;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170146447.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170232804.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720170322672.png" class="">
</li>
<li><p>两表</p>
<p>建表SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;class&#96;(</span><br><span class="line">&#96;id&#96; INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;card&#96; INT (10) UNSIGNED NOT NULL,</span><br><span class="line">PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE IF NOT EXISTS &#96;book&#96;(</span><br><span class="line">&#96;bookid&#96; INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;card&#96; INT (10) UNSIGNED NOT NULL,</span><br><span class="line">PRIMARY KEY (&#96;bookid&#96;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO class(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line"> </span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO book(card) VALUES(FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>

<p>案例分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#左连接</span><br><span class="line">#EXPLAIN分析</span><br><span class="line">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card &#x3D; book.card;</span><br><span class="line">#结论：type是ALL，需要优化</span><br><span class="line"></span><br><span class="line">#添加索引优化（加在右表）+EXPLAIN</span><br><span class="line">ALTER TABLE &#96;book&#96; ADD INDEX Y(&#96;card&#96;);</span><br><span class="line">#结论：可以看到第二行的type变成了ref，rows也变了，优化比较明显</span><br><span class="line">&#x2F;*</span><br><span class="line">这是由左连接特性决定的。LEFT JOIN条件用于确定如何从右表搜索行，左边一定都有，所以右边才是我们的关键点，一定需要建立索引</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">#删除旧索引+新建索引（加在左表）+EXPLAIN</span><br><span class="line">DROP INDEX Y ON book;</span><br><span class="line">ALTER TABLE &#96;class&#96; ADD INDEX X(&#96;card&#96;);</span><br><span class="line">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card &#x3D; book.card;</span><br><span class="line">#结论：基本无变化</span><br><span class="line"></span><br><span class="line">#右连接同理</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720174415147.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720174453840.png" class="">
</li>
<li><p>三表</p>
<p>建表SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;phone&#96;(</span><br><span class="line">&#96;phoneid&#96; INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;card&#96; INT (10) UNSIGNED NOT NULL,</span><br><span class="line">PRIMARY KEY(&#96;phoneid&#96;)</span><br><span class="line">)ENGINE &#x3D; INNODB;</span><br><span class="line"></span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br><span class="line">INSERT INTO phone(card) VALUES(FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>

<p>案例分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#删除旧索引</span><br><span class="line">DROP INDEX X ON class;</span><br><span class="line"></span><br><span class="line">#EXPLAIN分析</span><br><span class="line">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card &#x3D; book.card</span><br><span class="line">LEFT JOIN phone ON book.card &#x3D; phone.card;</span><br><span class="line"></span><br><span class="line">#新建索引+EXPLAIN</span><br><span class="line">ALTER TABLE &#96;phone&#96; ADD INDEX Z(&#96;card&#96;);</span><br><span class="line">ALTER TABLE &#96;book&#96; ADD INDEX Y(&#96;card&#96;);</span><br><span class="line"></span><br><span class="line">#结论：后2行的type都是ref且总rows优化很好，效果不错，因此索引最好设置在需要经常查询的字段中。</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">总结：</span><br><span class="line">尽可能减少JOIN语句中的NestedLoop的循环总次数，“永远用小结果集驱动大的结果集”；</span><br><span class="line">优先优化NestedLoop的内层循环；</span><br><span class="line">保证JOIN语句中被驱动表上JOIN条件字段已经被索引；</span><br><span class="line">当无法保证被驱动表的JOIN条件字段被索引且内存资源充足的前提下，不要太吝啬JoinBuffer的设置。</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200720203753017.png" class="">

</li>
</ul>
<h5 id="2-索引失效"><a href="#2-索引失效" class="headerlink" title="(2)索引失效"></a>(2)索引失效</h5><ul>
<li><p>建表SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE staffs(</span><br><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">&#96;name&#96; VARCHAR(24) NOT NULL DEFAULT&#39;&#39; COMMENT&#39;姓名&#39;,</span><br><span class="line">&#96;age&#96; INT NOT NULL DEFAULT 0 COMMENT&#39;年龄&#39;,</span><br><span class="line">&#96;pos&#96; VARCHAR(20) NOT NULL DEFAULT&#39;&#39; COMMENT&#39;职位&#39;,</span><br><span class="line">&#96;add_time&#96; TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT&#39;入职时间&#39;</span><br><span class="line">)CHARSET utf8 COMMENT&#39;员工记录表&#39;;</span><br><span class="line">INSERT INTO staffs(&#96;name&#96;,&#96;age&#96;,&#96;pos&#96;,&#96;add_time&#96;) VALUES(&#39;z3&#39;,22,&#39;manager&#39;,NOW());</span><br><span class="line">INSERT INTO staffs(&#96;name&#96;,&#96;age&#96;,&#96;pos&#96;,&#96;add_time&#96;) VALUES(&#39;July&#39;,23,&#39;dev&#39;,NOW());</span><br><span class="line">INSERT INTO staffs(&#96;name&#96;,&#96;age&#96;,&#96;pos&#96;,&#96;add_time&#96;) VALUES(&#39;2000&#39;,23,&#39;dev&#39;,NOW());</span><br><span class="line"></span><br><span class="line">ALTER TABLE staffs ADD INDEX index_staffs_nameAgePos(&#96;name&#96;,&#96;age&#96;,&#96;pos&#96;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例（索引失效）</p>
<p>①全值匹配</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721095852167.png" class="">

<p>②最佳左前缀法则</p>
<p>​    ——如果索引了多列，要遵守最左前缀法则，指的是查询从索引的最左前列开始并且<span style='color:red;'>不跳过索引中的列</span></p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721100300793.png" class="">

<p>③不在索引列上做任何操作（计算、函数、（自动or手动）类型转换），会导致索引失效而转向全表扫描</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721100532010.png" class="">

<p>④存储引擎不能使用索引中范围条件右边的列</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721101619421.png" class="">

<p>⑤尽量使用覆盖索引（只访问索引的查询（索引列和查询列一致）），减少”SELECT *“</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721102914134.png" class="">

<p>⑥MySQL在使用不等于（!=或者&lt;&gt;）的时候无法使用索引，会导致全表扫描</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721103926563.png" class="">

<p>⑦IS NULL，IS NOT NULL也无法使用索引</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721104312421.png" class="">

<p>⑧LIKE以通配符开头（’%abc’），MySQL索引失效，会变成全表扫描的操作</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721111056758.png" class="">

<p>如何解决<code>LIKE &#39;%字符串%&#39;</code>时索引不被使用的方法？</p>
<p>建表SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tbl_user&#96;(</span><br><span class="line">&#96;id&#96; INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">&#96;name&#96; VARCHAR(20) DEFAULT NULL,</span><br><span class="line">&#96;age&#96;INT(11) DEFAULT NULL,</span><br><span class="line">&#96;email&#96; VARCHAR(20) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY(&#96;id&#96;)</span><br><span class="line">)ENGINE&#x3D;INNODB AUTO_INCREMENT&#x3D;1 DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO tbl_user(&#96;name&#96;,&#96;age&#96;,&#96;email&#96;) VALUES(&#39;1aa1&#39;,21,&#39;b@163.com&#39;);</span><br><span class="line">INSERT INTO tbl_user(&#96;name&#96;,&#96;age&#96;,&#96;email&#96;) VALUES(&#39;2bb2&#39;,222,&#39;a@163.com&#39;);</span><br><span class="line">INSERT INTO tbl_user(&#96;name&#96;,&#96;age&#96;,&#96;email&#96;) VALUES(&#39;3cc3&#39;,265,&#39;c@163.com&#39;);</span><br><span class="line">INSERT INTO tbl_user(&#96;name&#96;,&#96;age&#96;,&#96;email&#96;) VALUES(&#39;4dd4&#39;,21,&#39;d@163.com&#39;);</span><br><span class="line">INSERT INTO tbl_user(&#96;name&#96;,&#96;age&#96;,&#96;email&#96;) VALUES(&#39;aa&#39;,121,&#39;e@163.com&#39;);</span><br></pre></td></tr></table></figure>

<p>建索引前</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721142924442.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143020991.png" class="">

<p>建索引后</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143259926.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721143330869.png" class="">

<p>⑨字符串不加单引号索引会失效</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721144052186.png" class="">

<p>⑩少用OR，用它来连接时索引会失效（使用UNION ALL或者UNION来替代）</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721144435797.png" class="">

<p>【总结】</p>
<p>全职匹配我最爱，最左前缀要遵守；</p>
<p>带头大哥不能死，中间兄弟不能断；</p>
<p>索引列上少计算，范围之后全失效；</p>
<p>LIKE百分写最右，覆盖索引不写*；</p>
<p>不等空值还有OR，索引影响要注意；</p>
<p>VAR引号不可丢，SQL优化有诀窍。</p>
</li>
<li><p>面试题</p>
<p>题目SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test03(</span><br><span class="line">id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">c1 CHAR(10),</span><br><span class="line">c2 CHAR(10),</span><br><span class="line">c3 CHAR(10),</span><br><span class="line">c4 CHAR(10),</span><br><span class="line">c5 CHAR(10)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) VALUES (&#39;a1&#39;,&#39;a2&#39;,&#39;a3&#39;,&#39;a4&#39;,&#39;a5&#39;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) VALUES (&#39;b1&#39;,&#39;b2&#39;,&#39;b3&#39;,&#39;b4&#39;,&#39;b5&#39;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) VALUES (&#39;c1&#39;,&#39;c2&#39;,&#39;c3&#39;,&#39;c4&#39;,&#39;c5&#39;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) VALUES (&#39;d1&#39;,&#39;d2&#39;,&#39;d3&#39;,&#39;d4&#39;,&#39;d5&#39;);</span><br><span class="line">INSERT INTO test03(c1,c2,c3,c4,c5) VALUES (&#39;e1&#39;,&#39;e2&#39;,&#39;e3&#39;,&#39;e4&#39;,&#39;e5&#39;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM test03;</span><br><span class="line"></span><br><span class="line">#创建索引</span><br><span class="line">CREATE INDEX idx_test03_c1234 ON test03(c1,c2,c3,c4);</span><br><span class="line">SHOW INDEX FROM test03;</span><br><span class="line"></span><br><span class="line">#根据创建的复合索引idx_test03_c1234分析以下SQL的索引使用情况</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721191359672.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721192125088.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195829927.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195858961.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200721195932229.png" class="">

<p>定值、范围还是排序，一般ORDER BY是给个范围，GROUP BY基本上都需要进行排序，会有临时表产生</p>
</li>
</ul>
<h5 id="3-一般性建议"><a href="#3-一般性建议" class="headerlink" title="(3)一般性建议"></a>(3)一般性建议</h5><ul>
<li>对于单值索引，尽量选择针对当前query过滤性更好的索引</li>
<li>在选择组合索引的时候，当前query中过滤性最好的字段在索引字段顺序中，位置越靠前越好</li>
<li>在选择组合索引的时候，尽量选择可以能够包含当前query中的WHERE字句中更多字段的索引</li>
<li>尽可能通过分析统计信息和调制query的写法来达到选择合适索引的目的</li>
</ul>
<h3 id="第三章-查询截取分析"><a href="#第三章-查询截取分析" class="headerlink" title="第三章    查询截取分析"></a>第三章    查询截取分析</h3><p>SQL优化在实际生产中的分析步骤：</p>
<p>①观察，至少跑一天，看看生产的慢SQL情况</p>
<p>②开启慢查询日志，设置阈值，比如超过5秒的就是慢SQL，将其抓取出来</p>
<p>③EXPLAIN+慢SQL分析</p>
<p>④Show Profile</p>
<p>⑤运维经理orDBA进行SQL数据库服务器的参数调优</p>
<p>总结：</p>
<p>①慢查询的开启和捕获</p>
<p>②EXPLAIN+慢SQL分析</p>
<p>③Show Profile查询SQL在MySQL服务器里面的执行细节和生命周期情况</p>
<p>④SQL数据库服务器的参数调优</p>
<h4 id="1-查询优化"><a href="#1-查询优化" class="headerlink" title="1.查询优化"></a>1.查询优化</h4><h5 id="1-优化原则"><a href="#1-优化原则" class="headerlink" title="(1)优化原则"></a>(1)优化原则</h5><p><strong><span style='color:red;'>小表驱动大表，即小的数据集驱动大的数据</span></strong>（类似嵌套循环Nested Loop）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#原理</span><br><span class="line">SELECT * FROM A WHERE id IN (SELECT id FROM B);</span><br><span class="line">#等价于：</span><br><span class="line">SELECT id FROM B;</span><br><span class="line">SELECT * FROM A WHERE A.id &#x3D; B.id;</span><br><span class="line">#当B表的数据集必须小于A表的数据集时，用IN优于EXISTS</span><br><span class="line"></span><br><span class="line">SELECT * FROM A WHERE EXISTS (SELECT * FROM B WHERE B.id &#x3D; A.id);</span><br><span class="line">#等价于：</span><br><span class="line">SELECT * FROM B WHERE B.id &#x3D; A.id;</span><br><span class="line">SELECT * FROM A;</span><br><span class="line">#当A表的数据集小于B表的数据集时，用EXISTS优于IN</span><br><span class="line">#注意：A表和B表的id字段应建立索引</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#EXISTS语法</span><br><span class="line">SELECT ... FROM tableName WHERE EXISTS (subquery);</span><br><span class="line">#该语法可以理解为：将主查询的数据放到子查询中做条件验证，根据验证结果（TRUE或FALSE）来决定主查询的数据结果是否得以保留</span><br></pre></td></tr></table></figure>

<p>【提示】</p>
<p>①<span style='color:blue;'>EXISTS(subquery)只返回TRUE或FALSE</span>，因此子查询中的SELECT  *也可以是SELECT 1或SELECT ‘X’这种常量，官方说法是实际执行时会忽略SELECT清单，因此没有区别</p>
<p>②EXISTS子查询的实际执行过程可能经过了优化而不是我们理解上的逐条对比，如果担忧效率问题，可进行实际检验以确定是否有效率问题</p>
<p>③EXISTS子查询往往也可以用条件表达式、其他子查询或JOIN来替代，何种最优需要具体问题具体分析</p>
<h5 id="2-ORDER-BY关键字优化"><a href="#2-ORDER-BY关键字优化" class="headerlink" title="(2)ORDER BY关键字优化"></a>(2)ORDER BY关键字优化</h5><ul>
<li><p>ORDER BY子句，尽量使用Index方式排序，避免使用filesort方式排序</p>
<p>①建表SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table tblA(</span><br><span class="line">#id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">age INT,</span><br><span class="line">birth TIMESTAMP NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tblA(age, birth) VALUES(22, now());</span><br><span class="line">INSERT INTO tblA(age, birth) VALUES(23, now());</span><br><span class="line">INSERT INTO tblA(age, birth) VALUES(24, now());</span><br><span class="line"></span><br><span class="line">CREATE INDEX idx_A_ageBirth ON tblA(age, birth);</span><br><span class="line"></span><br><span class="line">SELECT * FROM tblA;</span><br></pre></td></tr></table></figure>

<p>②CASE</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722100057188.png" class=""><br/>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722100148097.png" class="">

<p>③MySQL支持两种方式的排序，filesort和Index，Index效率高，它指MySQL扫描索引本身完成排序，filesort方式效率较低</p>
<p>④ORDER BY满足两种情况会使用Index方式排序：</p>
<p>​    a.ORDER BY语句使用索引最左前列</p>
<p>​    b.使用WHERE子句与ORDER BY子句条件列组合满足索引最左前列</p>
</li>
<li><p>尽可能在索引列上完成排序操作，遵照索引建的最佳左前缀</p>
</li>
<li><p>如果不在索引列上，filesort有两种算法：MySQL就要启动双路排序和单路排序</p>
<p>①双路排序：</p>
<p>​    MySQL4.1之前是使用双路排序，字面意思就是两次扫描磁盘，最终得到数据。读取行指针和ORDER BY列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出。</p>
<p>​    从磁盘中取排序字段，在BUFFER中进行排序，再从磁盘中取其他字段。</p>
<p>​    取一批数据要对磁盘进行两次扫描，众所周知，I/O是很耗时的，所以在MySQL4.1之后，出现了第二种改进的算法——单路排序。</p>
<p>②单路排序：</p>
<p>​    从磁盘读取查询需要的所有列，按照ORDER BY列在BUFFER对它们进行排序，然后扫描排序后的列表进行输出，它的效率更快一些，避免了第二次读取数据，并且把随机I/O变成了顺序I/O，但是它会使用更多的空间，因为它把每一行都保存在内存中了。</p>
<p>③结论及引申出的问题：</p>
<p>a.由于单路排序是后出的，总体而言好过双路排序。</p>
<p>b.但是单路排序有问题：在sort_buffer中，单路排序要多占用很多空间，因为单路排序是把所有字段都取出，所以有可能去取出的数据的总大小超出了sort_buffer的容量，导致每次只能取sort_buffer容量大小的数据，进行排序（创建tmp文件，多路合并），排完再取sort_buffer容量大小，再排……从而进行多次I/O。本来想省一次I/O操作，反而导致了大量的I/O操作，反而得不偿失。</p>
</li>
<li><p>优化策略</p>
<p>①增大sort_buffer_size参数的设置</p>
<p>②增大max_length_for_sort_data参数的设置</p>
<p>提供ORDER BY的速度：</p>
<p>a.ORDER BY时使用SELECT *是一个大忌，<span style='color:red;'>只query需要的字段</span>这点非常重要，在这里的影响是：</p>
<p>​    a1.当query的字段大小总和小于max_length_for_sort_data，而且排序字段不是TEXT/BLOB类型时，会用改进后的算法——单路排序，否则用老算法——多路排序</p>
<p>​    a2.两种算法的数据都有可能超出sort_buffer的容量，超出之后，会创建tmp文件进行合并排序，导致多次I/O，但是用单路排序算法的风险会更大一些，所以要提高sort_buffer_size</p>
<p>b.尝试提高sort_buffer_size</p>
<p>​    不管用哪种算法，提高这个参数都会提高效率，当然，要根据系统的能力去提高，因为这个参数是针对每个进程的</p>
<p>c.尝试提高max_length_for_sort_data</p>
<p>​    提高这个参数会增加用改进算法的概率，但是如果设的太高，数据总容量超出sort_buffer_size的概率就增大，明显症状是高的磁盘I/O和低的处理器使用率</p>
</li>
<li><p>小结</p>
<p>为排序使用索引</p>
<p>①MySQL两种排序方式：文件排序或扫描有序索引排序</p>
<p>②MySQL能为排序与查询使用相同的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">KEY a_b_c(a,b,c);</span><br><span class="line"></span><br><span class="line">#ORDER BY能使用索引最左前缀</span><br><span class="line">- ORDER BY a;</span><br><span class="line">- ORDER BY a,b;</span><br><span class="line">- ORDER BY a,b,c;</span><br><span class="line">- ORDER BY a DESC,b DESC,c DESC;</span><br><span class="line"></span><br><span class="line">#如果WHERE使用索引的最左前缀定义为常量，则ORDER BY能使用索引</span><br><span class="line">- WHERE a &#x3D; const ORDER BY b,c;</span><br><span class="line">- WHERE a &#x3D; const AND b &#x3D; const ORDER BY c;</span><br><span class="line">- WHERE a &#x3D; const AND b &gt; const ORDER BY b,c;</span><br><span class="line"></span><br><span class="line">#不能使用索引进行排序</span><br><span class="line">- ORDER BY a ASC,b DESC,c DESC;&#x2F;*排序不一致*&#x2F;</span><br><span class="line">- WHERE g &#x3D; const ORDER BY b,c;&#x2F;*丢失a索引*&#x2F;</span><br><span class="line">- WHERE a &#x3D; const ORDER BY c;&#x2F;*丢失b索引*&#x2F;</span><br><span class="line">- WHERE a &#x3D; const ORDER BY a,d;&#x2F;*d不是索引的一部分*&#x2F;</span><br><span class="line">- WHERE a IN (...) ORDER BY b,c;&#x2F;*对于排序来说，多个相等条件也是查询范围★*&#x2F;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="3-GROUP-BY关键字优化"><a href="#3-GROUP-BY关键字优化" class="headerlink" title="(3)GROUP BY关键字优化"></a>(3)GROUP BY关键字优化</h5><p>①GROUP BY实质是先排序后进行分组，遵照索引建的最佳左前缀</p>
<p>②当无法使用索引列时，增大max_length_for_sort_data参数的设置+增大sort_buffer_size参数的设置</p>
<p>③WHERE高于HAVING，能用WHERE限定的条件就不要用HAVING去限定了</p>
<h4 id="2-慢查询日志"><a href="#2-慢查询日志" class="headerlink" title="2.慢查询日志"></a>2.慢查询日志</h4><h5 id="1-概念-1"><a href="#1-概念-1" class="headerlink" title="(1)概念"></a>(1)概念</h5><p>MySQL的慢查询日志是MySQL提供的一种日志记录，它用来记录在MySQL中响应时间超过阈值的语句，具体指运行时间超过long_query_time值的SQL，则会被记录到慢查询日志中。long_query_time的默认值为10，意思是运行时间超过10秒的语句。由慢查询日志查看哪些SQL超出了最大查询时间值，比如一条SQL执行超过5秒钟就算慢SQL，希望能收集超过5秒的SQL，结合之前的EXPLAIN进行全面分析。</p>
<h5 id="2-使用"><a href="#2-使用" class="headerlink" title="(2)使用"></a>(2)使用</h5><ul>
<li><p>说明</p>
<p><span style='color:blue;'>默认情况下，MySQL数据库没有开启慢查询日志</span>，需要手动来设置这个参数。<span style='color:blue;'>如果不是调优需要的话，一般不建议启动该参数</span>，因为开启慢查询日志会或多或少带来一定的性能影响。慢查询日志支持将日志记录写入文件。</p>
</li>
<li><p>查看是否开启及如何开启</p>
<p>默认：<code>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</code></p>
<p>开启：<code>set global slow_query_log = 1;</code></p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722112507313.png" class="">

<p>如果要永久生效，就必须修改配置文件my.cnf（其他系统变量也是如此）。在my.cnf文件的[mysqld]下增加或修改参数如下：</p>
<p><code>slow_query_log = 1</code></p>
<p><code>slow_query_log_file=/usr/local/mysql/data/hadoop1-slow.log</code></p>
<p>然后重启MySQL服务器。</p>
<p>关于慢查询的参数slow_query_log_file，它指定慢查询日志文件的存放路径，默认会给一个缺省的文件host_name-slow.log（如果没有指定参数slow_query_log_file的话）。</p>
</li>
<li><p>开启慢查询日志后，什么样的SQL会被记录到慢查询日志里</p>
<p>这个是由参数long_query_time控制，默认情况下long_query_time的值为10秒</p>
<p>命令：<code>SHOW VARIABLES LIKE &#39;long_query_time%&#39;;</code></p>
<p>可以使用命令修改，也可以在my.cnf的参数中修改。</p>
<p>在MySQL源码里是判断<span style='color:red;'>大于long_query_time</span>，而<span style='color:red;'>不是大于等于</span>。</p>
</li>
<li><p>CASE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#查看当前多少秒算慢</span><br><span class="line">SHOW VARIABLES LIKE &#39;long_query_time%&#39;；</span><br><span class="line"></span><br><span class="line">#设置慢查询的阈值时间</span><br><span class="line">SET GLOBAL long_query_time &#x3D; 3;</span><br><span class="line"></span><br><span class="line">#为什么设置后看不出变化</span><br><span class="line">&#x2F;*需要重新连接或者新开一个会话才能看到修改值*&#x2F;</span><br><span class="line">&#x2F;*或者使用*&#x2F;SHOW GLOBAL VARIABLES LIKE &#39;long_query_time&#39;;</span><br><span class="line"></span><br><span class="line">#记录慢SQL并后续分析（在终端中）</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;</span><br><span class="line">cat hadoop1-slow.log</span><br><span class="line"></span><br><span class="line">#查询当前系统中有多少条慢查询记录</span><br><span class="line">SHOW GLOBAL STATUS LIKE &#39;%Slow_queries%&#39;;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722143510467.png" class="">
</li>
<li><p>配置板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log&#x3D;1;</span><br><span class="line">slow_query_log_file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;hadoop1-slow.log</span><br><span class="line">&#x2F;*上面的路径看SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;的结果，每个人都不一样*&#x2F;</span><br><span class="line">long_query_time&#x3D;3;&#x2F;*时间根据需要设置*&#x2F;</span><br><span class="line">log_output&#x3D;FILE</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="3-日志分析工具mysqldumpslow"><a href="#3-日志分析工具mysqldumpslow" class="headerlink" title="(3)日志分析工具mysqldumpslow"></a>(3)日志分析工具mysqldumpslow</h5><p>在生产环境中，如果要手工分析日志，查找、分析SQL，MySQL提供了日志分析工具mysqldumpslow。</p>
<ul>
<li><p>查看mysqldumpslow的帮助信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow --help</span><br><span class="line"></span><br><span class="line">Usage: mysqldumpslow [ OPTS... ] [ LOGS... ]</span><br><span class="line"></span><br><span class="line">Parse and summarize the MySQL slow query log. Options are</span><br><span class="line"></span><br><span class="line">  --verbose    verbose</span><br><span class="line">  --debug      debug</span><br><span class="line">  --help       write this text to standard output</span><br><span class="line"></span><br><span class="line">  -v           verbose</span><br><span class="line">  -d           debug</span><br><span class="line">  -s ORDER     what to sort by (al, at, ar, c, l, r, t), &#39;at&#39; is default</span><br><span class="line">                al: average lock time</span><br><span class="line">                ar: average rows sent</span><br><span class="line">                at: average query time</span><br><span class="line">                 c: count</span><br><span class="line">                 l: lock time</span><br><span class="line">                 r: rows sent</span><br><span class="line">                 t: query time  </span><br><span class="line">  -r           reverse the sort order (largest last instead of first)</span><br><span class="line">  -t NUM       just show the top n queries</span><br><span class="line">  -a           don&#39;t abstract all numbers to N and strings to &#39;S&#39;</span><br><span class="line">  -n NUM       abstract numbers with at least n digits within names</span><br><span class="line">  -g PATTERN   grep: only consider stmts that include this string</span><br><span class="line">  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),</span><br><span class="line">               default is &#39;*&#39;, i.e. match all</span><br><span class="line">  -i NAME      name of server instance (if using mysql.server startup script)</span><br><span class="line">  -l           don&#39;t subtract lock time from total time</span><br><span class="line"></span><br><span class="line">建议在使用命令时结合|more使用，否则有可能出现爆屏的情况</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-批量数据脚本"><a href="#3-批量数据脚本" class="headerlink" title="3.批量数据脚本"></a>3.批量数据脚本</h4><p>往表李插入1000W数据</p>
<p>①建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#新建数据库</span><br><span class="line">CREATE DATABASE bigData;</span><br><span class="line">USE bigData;</span><br><span class="line"></span><br><span class="line">#建表dept</span><br><span class="line">CREATE TABLE dept(</span><br><span class="line">	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,</span><br><span class="line">	dname VARCHAR(20) NOT NULL DEFAULT &#39;&#39;,</span><br><span class="line">	loc VARCHAR(13) NOT NULL DEFAULT &#39;&#39;</span><br><span class="line">)ENGINE&#x3D;INNODB DEFAULT CHARSET&#x3D;GBK;</span><br><span class="line"></span><br><span class="line">#建表emp</span><br><span class="line">CREATE TABLE emp(</span><br><span class="line">	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	empno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0, &#x2F;*编号*&#x2F;</span><br><span class="line">	enname VARCHAR(20) NOT NULL DEFAULT &#39;&#39;, &#x2F;*名字*&#x2F;</span><br><span class="line">	job VARCHAR(9) NOT NULL DEFAULT &#39;&#39;, &#x2F;*工作*&#x2F;</span><br><span class="line">	mgr MEDIUMINT UNSIGNED NOT NULL DEFAULT 0, &#x2F;*上级编号*&#x2F;</span><br><span class="line">	hiredate DATE NOT NULL, &#x2F;*入职时间*&#x2F;</span><br><span class="line">	sal DECIMAL(7,2) NOT NULL, &#x2F;*薪水*&#x2F;</span><br><span class="line">	comm DECIMAL(7,2) NOT NULL, &#x2F;*红利*&#x2F;</span><br><span class="line">	deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0 &#x2F;*部门编号*&#x2F;</span><br><span class="line">)ENGINE&#x3D;INNODB DEFAULT CHARSET&#x3D;GBK;</span><br></pre></td></tr></table></figure>

<p>②设置参数log_bin_trust_function_creators</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#创建函数，如果报错：This function has none of DETERMINISTIC...</span><br><span class="line">#由于开启过慢查询日志，因为我们开启了bin_log,我们就必须为我们的function指定一个参数</span><br><span class="line">SHOW VARIABLES LIKE &#39;log_bin_trust_function_creators&#39;;</span><br><span class="line">SET GLOBAL log_bin_trust_function_creators&#x3D;1;</span><br><span class="line">#这样添加了参数以后，如果mysqld重启，上述参数又会消失，永久方法：</span><br><span class="line">#Windows下 my.ini [mysqld]加上log_bin_trust_function_creators&#x3D;1</span><br><span class="line">#Linux下 my.cnf [mysqld]加上log_bin_trust_function_creators&#x3D;1</span><br></pre></td></tr></table></figure>

<p>③创建函数，保证每条数据都不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#随机产生字符串</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE chars_set VARCHAR(100) DEFAULT &#39;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#39;;</span><br><span class="line">DECLARE return_str VARCHAR(255) DEFAULT &#39;&#39;;</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">WHILE i &lt; n DO</span><br><span class="line">SET return_str &#x3D; CONCAT(return_str,SUBSTRING(chars_set,FLOOR(1 + RAND()*52),1));</span><br><span class="line">SET i &#x3D; i + 1;</span><br><span class="line">END WHILE;</span><br><span class="line">RETURN return_str;</span><br><span class="line">END	$$</span><br><span class="line"></span><br><span class="line">#随机产生部门编号</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_num() RETURNS INT(5)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET i &#x3D; FLOOR(100 + RAND()*10);</span><br><span class="line">RETURN i;</span><br><span class="line">END $$</span><br><span class="line"></span><br><span class="line">#假如要删除</span><br><span class="line">DROP FUNCTION function_name;</span><br></pre></td></tr></table></figure>

<p>④创建存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#创建往emp表中插入数据的存储过程</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_emp(IN START INT(10), IN max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET autocommit &#x3D; 0;</span><br><span class="line">REPEAT</span><br><span class="line">SET i &#x3D; i + 1;</span><br><span class="line">INSERT INTO emp(empno, enname, job, mgr, hiredate, sal, comm, deptno) VALUES((START + i),rand_string(6),&#39;SALESMAN&#39;,0001,CURDATE(),2000,400,rand_num());</span><br><span class="line">UNTIL i &#x3D; max_num  </span><br><span class="line">END REPEAT;</span><br><span class="line">COMMIT;</span><br><span class="line">END $$</span><br><span class="line"> </span><br><span class="line">#创建往dept表中插入数据的存储过程</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_dept(IN START INT(10), IN max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET autocommit &#x3D; 0;</span><br><span class="line">REPEAT</span><br><span class="line">SET i &#x3D; i + 1;</span><br><span class="line">INSERT INTO dept(deptno,dname,loc) VALUES((START + i),rand_string(10),rand_string(8));</span><br><span class="line">UNTIL i &#x3D; max_num  </span><br><span class="line">END REPEAT;</span><br><span class="line">COMMIT;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<p>⑤调用存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#往dept表插入数据</span><br><span class="line">DELIMITER ;</span><br><span class="line">CALL insert_dept(100,10);</span><br><span class="line"></span><br><span class="line">#往emp表添加50W条数据</span><br><span class="line">DELIMITER ;</span><br><span class="line">CALL insert_emp(100001,500000);</span><br><span class="line"></span><br><span class="line">#查看刚刚插入emp表的数据</span><br><span class="line">SELECT * FROM emp;</span><br></pre></td></tr></table></figure>

<h4 id="4-Show-Profile"><a href="#4-Show-Profile" class="headerlink" title="4.Show Profile"></a>4.Show Profile</h4><ul>
<li><p>概念：MySQL提供可以用来分析当前会话中语句执行的资源消耗情况，可以用于SQL的调优测量。</p>
</li>
<li><p>默认情况下，参数处于关闭状态，并保存最近15次的运行结果</p>
</li>
<li><p>分析步骤</p>
<p>①查看当前MySQL版本是否支持</p>
<p><code>SHOW VARIABLES LIKE &#39;profiling&#39;;</code></p>
<p>默认是关闭的，使用前需要开启</p>
<p>②开启功能</p>
<p><code>SET profiling=on;</code></p>
<p>③运行SQL</p>
<p>④查看结果</p>
<p><code>show profiles;</code></p>
<p>⑤诊断SQL</p>
<p><code>show profile cpu,block io for query Query_ID;</code></p>
<p>参数类型：</p>
<p>ALL：显示所有的开销信息</p>
<p>BLOCK IO：显示块IO相关的开销信息</p>
<p>CONTEXT SWITCHES：上下文切换相关的开销信息</p>
<p>CPU：显示CPU相关开销的信息</p>
<p>IPC：显示发送和接收相关的开销信息</p>
<p>MEMORY：显示内存相关的开销信息</p>
<p>PAGE FAULTS：显示页面错误相关的开销信息</p>
<p>SOURCE：显示和Source_function，Source_file，Source_line相关的开销信息</p>
<p>SWAPS：显示交换次数相关的开销信息</p>
<p>⑥日常开发需要注意的结论</p>
<p>a.converting HEAP to MyISAM：查询结果太大，内存都不够用了，往磁盘上搬了</p>
<p>b.Creating tmp table：创建临时表——拷贝数据到临时表，用完再删除</p>
<p>c.Copying to tmp table on disk：把内存中的临时表复制到磁盘（危险）</p>
<p>d.locked</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722171207411.png" class="">

</li>
</ul>
<h4 id="5-全局查询日志"><a href="#5-全局查询日志" class="headerlink" title="5.全局查询日志"></a>5.全局查询日志</h4><ul>
<li><p>配置启用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#在mysql的my.cnf中，设置如下：</span><br><span class="line">#开启</span><br><span class="line">general_log&#x3D;1</span><br><span class="line">#记录日志文件的路径</span><br><span class="line">general_log_file&#x3D;&#x2F;path&#x2F;logfile</span><br><span class="line">#输出格式</span><br><span class="line">log_output&#x3D;FILE</span><br></pre></td></tr></table></figure>
</li>
<li><p>编码启用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#命令</span><br><span class="line">set global general_log&#x3D;1;</span><br><span class="line">set global log_output&#x3D;&#39;TABLE&#39;;</span><br><span class="line">#此后所编写的SQL语句，将会记录到mysql库里的general_log表，可以用下面的命令查看</span><br><span class="line">select * from mysql.general_log;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722172155448.png" class="">

</li>
</ul>
<p><span style='color:red;'>永远不要在生产环境开启这个功能</span></p>
<h3 id="第四章-MySQL锁机制"><a href="#第四章-MySQL锁机制" class="headerlink" title="第四章    MySQL锁机制"></a>第四章    MySQL锁机制</h3><h4 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1.概述"></a>1.概述</h4><ul>
<li><p>定义</p>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制。</p>
<p>在数据库中，除传统的计算资源（如CPU、RAM、I/O等）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
</li>
<li><p>锁的分类</p>
<p>从对数据操作的类型（读/写）分：</p>
<p>①读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响</p>
<p>②写锁（排它锁）：当前写操作没有完成前，它会阻断其他写锁和读锁</p>
<p>从对数据操作的粒度分：</p>
<p>①表锁</p>
<p>②行锁</p>
</li>
</ul>
<h4 id="2-三锁"><a href="#2-三锁" class="headerlink" title="2.三锁"></a>2.三锁</h4><h5 id="1-表锁-偏读"><a href="#1-表锁-偏读" class="headerlink" title="(1)表锁(偏读)"></a>(1)表锁(偏读)</h5><ul>
<li><p>特点：偏向MyISAM存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。</p>
</li>
<li><p>案例分析</p>
<p>①建表SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE mylock (</span><br><span class="line">id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">name VARCHAR(20) DEFAULT &#39;&#39;</span><br><span class="line">) ENGINE myisam;</span><br><span class="line"></span><br><span class="line">INSERT INTO mylock(name) VALUES(&#39;a&#39;);</span><br><span class="line">INSERT INTO mylock(name) VALUES(&#39;b&#39;);</span><br><span class="line">INSERT INTO mylock(name) VALUES(&#39;c&#39;);</span><br><span class="line">INSERT INTO mylock(name) VALUES(&#39;d&#39;);</span><br><span class="line">INSERT INTO mylock(name) VALUES(&#39;e&#39;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM mylock;</span><br></pre></td></tr></table></figure>

<p>②加读锁</p>
<table>
<thead>
<tr>
<th align="center">session_1</th>
<th align="center">session_2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">获得表mylock的READ锁定<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200722302.png" class=""></td>
<td align="center">连接终端</td>
</tr>
<tr>
<td align="center">session_1可以查询该表记录<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200758738.png" class=""></td>
<td align="center">session_2也可以查询该表记录<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200845638.png" class=""></td>
</tr>
<tr>
<td align="center">session_1不能查询其它<span style='color:blue;'>未锁定的表</span><br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722200953934.png" class=""></td>
<td align="center">session_2可以查询或者更新<span style='color:blue;'>未锁定的表</span><br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201209582.png" class=""></td>
</tr>
<tr>
<td align="center">session_1中插入或者更新<span style='color:blue;'>锁定表</span>都会提示错误<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201700817.png" class=""></td>
<td align="center">session_2插入或更新<span style='color:blue;'>锁定表</span>会<span style='color:red;'>一直等待获得锁</span><br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201810839.png" class=""></td>
</tr>
<tr>
<td align="center">释放锁<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722201951185.png" class=""></td>
<td align="center">session_1获得锁，插入操作完成<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200722202017690.png" class=""></td>
</tr>
</tbody></table>
<p>③加写锁</p>
<table>
<thead>
<tr>
<th align="center">session_1</th>
<th align="center">session_2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">获得表mylock的WRITE锁定<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723092905973.png" class=""></td>
<td align="center">待session_1开启写锁后，session_2再连接终端<br/></td>
</tr>
<tr>
<td align="center">session_1对锁定表的查询+更新+插入操作都可以执行<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093305458.png" class=""></td>
<td align="center">session_2对锁定表的查询被阻塞，需要等待锁被释放<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093443722.png" class=""></td>
</tr>
<tr>
<td align="center">释放锁<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093623235.png" class=""></td>
<td align="center">session_2获得锁，查询返回<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723093736405.png" class=""></td>
</tr>
</tbody></table>
</li>
<li><p>案例结论</p>
<p>MyISAM在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行增删改操作前，会自动给涉及的表加写锁。</p>
<p>MySQL的表级锁有两种模式：表共享读锁（Table Read Lock）、表独占写锁（Table Write Lock）</p>
<p>【结论】</p>
<p>①对MyISAM表的读操作（加读锁），不会阻塞其它进程对同一表的读请求，但会阻塞对同一表的写请求，只有当读锁释放后才会执行其它进程的写操作</p>
<p>②对MyISAM表的写操作（加写锁），会阻塞其它进程对同一表的读和写操作，只有当写锁释放后，才会执行其它进程的读写操作</p>
<p>简而言之：<span style='color:red;'>读锁会阻塞写，但是不会阻塞读，而写锁则会把读和写都阻塞</span></p>
</li>
<li><p>表锁分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查看哪些表被加锁</span><br><span class="line">show open tables;</span><br><span class="line"></span><br><span class="line">#如何分析表锁定</span><br><span class="line">show status like &#39;table%&#39;;</span><br><span class="line">#通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723101100109.png" class="">

<p>table_locks_immediate：产生表级锁定的次数，表示可以立即获取锁的查询次数，每次立即获取锁值就加1</p>
<p>table_locks_waited：出现表级锁定争用而发生等待的次数（不能立即获取锁的次数，每等待一次锁值就加1），此值高则说明存在着较为严重的表级锁争用情况</p>
<p><span style='color:red;'>MyISAM的读写锁调度是写优先，这也是MyISAM不适合做写为主表的引擎，因为加写锁后，其它线程不能做任何操作，大量的更新会使查询很难得到锁，从而造成永远阻塞。</span></p>
</li>
</ul>
<h5 id="2-行锁-偏写"><a href="#2-行锁-偏写" class="headerlink" title="(2)行锁(偏写)"></a>(2)行锁(偏写)</h5><ul>
<li><p>特点</p>
<p>偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度最高</p>
<p>InnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION），二是采用了行级锁</p>
</li>
<li><p>知识点回顾</p>
<p>①事务（Transaction）及其ACID属性：原子性、一致性、隔离性、持久性</p>
<p>②并发事务处理带来的问题：更新丢失、脏读、不可重复读、幻读</p>
<p>③事务隔离级别：未提交读、已提交读、可重复读、可序列化</p>
<p>​    查看当前数据库的事务隔离级别：<code>show variables like &#39;tx_isolation&#39;;</code></p>
</li>
<li><p>案例分析</p>
<p>①建表SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_innodb_lock (a INT(11),b VARCHAR(16))ENGINE&#x3D;INNODB;</span><br><span class="line"></span><br><span class="line">INSERT INTO test_innodb_lock VALUES(1,&#39;b2&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(3,&#39;3&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(4,&#39;4000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(5,&#39;5000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(6,&#39;6000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(7,&#39;7000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(8,&#39;8000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(9,&#39;9000&#39;);</span><br><span class="line">INSERT INTO test_innodb_lock VALUES(1,&#39;b1&#39;);</span><br><span class="line"></span><br><span class="line">CREATE INDEX test_innodb_a_ind ON test_innodb_lock(a);</span><br><span class="line">CREATE INDEX test_innodb_lock_b_ind ON test_innodb_lock(b);</span><br><span class="line"></span><br><span class="line">SELECT * FROM test_innodb_lock;</span><br></pre></td></tr></table></figure>

<p>②行锁定基本演示</p>
<table>
<thead>
<tr>
<th align="center">session_1</th>
<th align="center">session_2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">取消自动提交<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142027717.png" class=""></td>
<td align="center">取消自动提交<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142108459.png" class=""></td>
</tr>
<tr>
<td align="center">更新但是不提交，没有手写commit<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142208796.png" class=""></td>
<td align="center">session_2被阻塞，只能等待<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142543868.png" class=""></td>
</tr>
<tr>
<td align="center">提交更新<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142252568.png" class=""></td>
<td align="center">解除阻塞，更新正常进行<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723142619236.png" class=""></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">执行commit命令</td>
</tr>
<tr>
<td align="center">session_1更新a=4<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723143034424.png" class=""></td>
<td align="center">session_2更新a=9<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723143101859.png" class=""></td>
</tr>
</tbody></table>
<p>③无索引行锁升级为表锁</p>
<table>
<thead>
<tr>
<th align="center">session_1</th>
<th align="center">session_2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">session_1更新b=’4000’<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144016111.png" class=""></td>
<td align="center">session_2更新a=9<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144057701.png" class=""></td>
</tr>
<tr>
<td align="center">session_1更新b=’4000’，但是b是VARCHAR类型未加’ ‘<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144316148.png" class=""></td>
<td align="center">session_2再次更新a=9，被阻塞<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144357729.png" class=""></td>
</tr>
<tr>
<td align="center">提交更新</td>
<td align="center">解除阻塞<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723144523550.png" class=""></td>
</tr>
</tbody></table>
<p>④间隙锁的危害</p>
<table>
<thead>
<tr>
<th align="center">session_1</th>
<th align="center">session_2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">session_1更新1&lt;a&lt;6<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145205136.png" class=""></td>
<td align="center">session_2插入a=2，被阻塞<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145245123.png" class=""></td>
</tr>
<tr>
<td align="center">提交更新</td>
<td align="center">解除阻塞<br/><img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723145402418.png" class=""></td>
</tr>
</tbody></table>
<p>【间隙锁】当我们<span style='color:blue;'>用范围条件</span>而不是相等条件<span style='color:blue;'>检索数据</span>，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于<span style='color:blue;'>键值在条件范围内但不存在的记录</span>，叫做“间隙（GAP）”。InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁（Next-Key锁）</p>
<p>【危害】因为<span style='color:orange;'>query执行过程中通过范围查找的话，会锁定整个范围内所有的索引键值，即使这个键值并不存在</span>，间隙锁有一个比较致命的弱点就是当锁定一个范围键值之后，即使某些不存在的键值也会被无辜的锁定，而造成在锁定的时候无法插入锁定键值范围内的任何数据，在某些场景下这可能会对性能造成很大的危害。</p>
<p>【面试题】如何锁定一行</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723151818787.png" class="">

<p>mysql命令行下清屏的快捷键是：CTRL+L</p>
</li>
<li><p>案例结论</p>
<p>InnoDB存储引擎由于实现了行级锁定，虽然在锁定机制的实现方面所带来的性能损耗可能比表级锁定要更高一些，但是在整体并发处理能力方面要远远优于MyISAM的表级锁定。当系统并发量较高时，InnoDB的整体性能和MyISAM相比就会有比较明显的优势了。但是InnoDB的行级锁定同样也有其脆弱的一面，当我们使用不当的时候，可能会让InnoDB的整体性能表现不仅不能比MyISAM高，甚至可能会更差。</p>
</li>
<li><p>行锁分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#通过检查innodb_row_lock状态变量来分析系统上的行锁的争夺情况</span><br><span class="line">show status like &#39;innodb_row_lock%&#39;;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/image-20200723153252670.png" class="">

<p>Innodb_row_lock_current_waits：当前正在等待锁定的数量</p>
<p><span style='color:red;'>Innodb_row_lock_time</span>：从系统启动到现在锁定总时间长度</p>
<p><span style='color:red;'>Innodb_row_lock_time_avg</span>：每次等待所花的平均时间</p>
<p>Innodb_row_lock_time_max：从系统启动到现在等待时间最长的一次所花的时间</p>
<p><span style='color:red;'>Innodb_row_lock_waits</span>：从系统启动到现在总共等待的次数</p>
<p>这5个状态变量中，比较重要的是Innodb_row_lock_time，Innodb_row_lock_time_avg，Innodb_row_lock_waits。</p>
<p>当等待次数很高，而且每次等待时长也不小的时候，就需要分析系统中为什么会有如此多的等待，然后根据分析结果着手指定优化计划（Show Profile）。</p>
</li>
<li><p>优化建议</p>
<p>①尽可能让所有数据检索都通过索引来完成，避免无索引行锁升级为表锁</p>
<p>②合理设计索引，尽量缩小锁的范围</p>
<p>③尽可能减少检索条件，避免间隙锁</p>
<p>④尽量控制事务大小，减少锁定资源量和时间长度</p>
<p>⑤尽可能低级别事务隔离</p>
</li>
</ul>
<h5 id="3-页锁"><a href="#3-页锁" class="headerlink" title="(3)页锁"></a>(3)页锁</h5><ul>
<li>特点：开销和加锁时间介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般。（了解即可）</li>
</ul>
<h3 id="第五章-主从复制"><a href="#第五章-主从复制" class="headerlink" title="第五章    主从复制"></a>第五章    主从复制</h3><h4 id="1-复制的基本原理"><a href="#1-复制的基本原理" class="headerlink" title="1.复制的基本原理"></a>1.复制的基本原理</h4><ul>
<li><p>slave会从master读取binlog来进行数据同步</p>
</li>
<li><p>原理图+三步骤</p>
<img src="/2020/07/17/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7/20180313225542529.png" class="">

<p>MySQL复制过程分成三步：</p>
<p>①master将改变记录到二进制日志（binary log），这些记录过程叫做二进制日志事件，binary log events</p>
<p>②slave将master的binary log events拷贝到它的中继日志（relay log）</p>
<p>③slave重做中继日志中的事件，将改变应用到自己的数据库中</p>
<p>MySQL复制时异步且串行化的</p>
</li>
</ul>
<h4 id="2-复制的基本原则"><a href="#2-复制的基本原则" class="headerlink" title="2.复制的基本原则"></a>2.复制的基本原则</h4><p>①每个slave只有一个master</p>
<p>②每个slave只能有一个唯一的服务器ID</p>
<p>③每个master可以有多个slave</p>
<h4 id="3-复制的最大问题"><a href="#3-复制的最大问题" class="headerlink" title="3.复制的最大问题"></a>3.复制的最大问题</h4><p>延时</p>
<h4 id="4-一主一从常见配置"><a href="#4-一主一从常见配置" class="headerlink" title="4.一主一从常见配置"></a>4.一主一从常见配置</h4><ul>
<li><p>MySQL版本一致且后台以服务运行</p>
</li>
<li><p>主从都配置在[mysqld]节点下，都是小写</p>
</li>
<li><p>主机修改my.ini配置文件</p>
<p>①<span style='color:red;'>[必须]</span>主服务器唯一ID：server-id=1</p>
<p>②<span style='color:red;'>[必须]</span>启用二进制日志：log-bin=自己的本地路径/mysqlbin</p>
<p>③[可选]启用错误日志：log-err=自己的本地路径/mysqlerr</p>
<p>④[可选]根目录：basedir=”自己的本地路径”</p>
<p>⑤[可选]临时目录：tmpdir=”自己的本地路径”</p>
<p>⑥[可选]数据目录：datadir=”自己的本地路径/Data/“</p>
<p>⑦read-only=0——主机，读写都可以</p>
<p>⑧[可选]设置不要复制的数据库：binlog-ignore-db=mysql</p>
<p>⑨[可选]设置需要复制的数据库：binlog-do-db=需要复制的主数据库名字</p>
</li>
<li><p>从机修改my.cnf配置文件</p>
<p>①[必须]从服务器唯一ID</p>
<p>②[可选]启用二进制日志</p>
</li>
<li><p>因为修改过配置文件，主机和从机都要重启后台mysql服务</p>
<p>Linux：<code>service mysql stop</code>、<code>service mysql start</code></p>
</li>
<li><p>主机从机都关闭防火墙</p>
<p>Windows手动关闭</p>
<p>关闭虚拟机Linux防火墙：<code>service iptable stop</code></p>
</li>
<li><p>在Windows主机上建立账户并授权slave</p>
<p><code>GRANT REPLICATION SLAVE ON *.* TO &#39;zhangsan&#39;@&#39;从机数据库IP&#39; IDENTIFIED BY &#39;123456&#39;;</code></p>
<p><code>flush privileges;</code></p>
<p>查询master的状态：<code>show master status;</code>，记录下File和Position的值</p>
<p>执行完此步骤后不要再操作主服务器MySQL，防止主服务器状态值变化</p>
</li>
<li><p>在Linux从机上配置需要复制的主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;主机IP&#39;, MASTER_USER&#x3D;&#39;zhangsan&#39;, MASTER_PASSWORD&#x3D;&#39;123456&#39;, MASTER_LOG_FILE&#x3D;&#39;File名字&#39;, MASTER_LOG_POS&#x3D;Position数字;</span><br></pre></td></tr></table></figure>

<p>启动从服务器复制功能：<code>start slave;</code></p>
<p><code>show  slave status\G</code>：下面两个参数都是Yes则说明主从配置成功（Slave_IO_Running:Yes，Slave_SQL_Running:Yes）</p>
</li>
<li><p>主机新建库、新建表、insert记录、从机复制</p>
</li>
<li><p>如何停止从服务复制功能</p>
<p><code>stop slave;</code></p>
</li>
</ul>
<blockquote>
<p>【说明】&copy;本文为学习笔记，参考自视频<a href="https://www.bilibili.com/video/BV1KW411u7vy" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1KW411u7vy</a>，如有侵权，请联系我删除。</p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/12/Linux%E5%85%A5%E9%97%A8/" rel="prev" title="Linux入门">
      <i class="fa fa-chevron-left"></i> Linux入门
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/24/Spring/" rel="next" title="Spring">
      Spring <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一章-MySQL的架构介绍"><span class="nav-number">1.</span> <span class="nav-text">第一章    MySQL的架构介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-MySQL简介"><span class="nav-number">1.1.</span> <span class="nav-text">1.MySQL简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概述"><span class="nav-number">1.1.1.</span> <span class="nav-text">(1)概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-高级MySQL"><span class="nav-number">1.1.2.</span> <span class="nav-text">(2)高级MySQL</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MySQL的Linux版安装"><span class="nav-number">1.2.</span> <span class="nav-text">2.MySQL的Linux版安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-准备工作"><span class="nav-number">1.2.1.</span> <span class="nav-text">(1)准备工作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-安装MySQL"><span class="nav-number">1.2.2.</span> <span class="nav-text">(2)安装MySQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-MySQL的安装路径及说明"><span class="nav-number">1.2.3.</span> <span class="nav-text">(3)MySQL的安装路径及说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-修改字符集"><span class="nav-number">1.2.4.</span> <span class="nav-text">(4)修改字符集</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-MySQL逻辑架构"><span class="nav-number">1.3.</span> <span class="nav-text">3.MySQL逻辑架构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-整体架构"><span class="nav-number">1.3.1.</span> <span class="nav-text">(1)整体架构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-SQL执行周期"><span class="nav-number">1.3.2.</span> <span class="nav-text">(2)SQL执行周期</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-MySQL的查询流程"><span class="nav-number">1.3.3.</span> <span class="nav-text">(3)MySQL的查询流程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-MySQL存储引擎"><span class="nav-number">1.4.</span> <span class="nav-text">4.MySQL存储引擎</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二章-索引优化分析"><span class="nav-number">2.</span> <span class="nav-text">第二章    索引优化分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-SQL性能问题"><span class="nav-number">2.1.</span> <span class="nav-text">1.SQL性能问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-常见通用的JOIN查询"><span class="nav-number">2.2.</span> <span class="nav-text">2.常见通用的JOIN查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-SQL执行顺序"><span class="nav-number">2.2.1.</span> <span class="nav-text">(1)SQL执行顺序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-JOIN图"><span class="nav-number">2.2.2.</span> <span class="nav-text">(2)JOIN图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-SQL建表"><span class="nav-number">2.2.3.</span> <span class="nav-text">(3)SQL建表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-7种JOIN演示"><span class="nav-number">2.2.4.</span> <span class="nav-text">(4)7种JOIN演示</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-索引简介"><span class="nav-number">2.3.</span> <span class="nav-text">3.索引简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概念"><span class="nav-number">2.3.1.</span> <span class="nav-text">(1)概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-优势"><span class="nav-number">2.3.2.</span> <span class="nav-text">(2)优势</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-劣势"><span class="nav-number">2.3.3.</span> <span class="nav-text">(3)劣势</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-MySQL索引分类"><span class="nav-number">2.3.4.</span> <span class="nav-text">(4)MySQL索引分类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-MySQL索引结构"><span class="nav-number">2.3.5.</span> <span class="nav-text">(5)MySQL索引结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-哪些情况需要创建索引"><span class="nav-number">2.3.6.</span> <span class="nav-text">(6)哪些情况需要创建索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-哪些情况不要创建索引"><span class="nav-number">2.3.7.</span> <span class="nav-text">(7)哪些情况不要创建索引</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-性能分析"><span class="nav-number">2.4.</span> <span class="nav-text">4.性能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-MySQL-Query-Optimizer"><span class="nav-number">2.4.1.</span> <span class="nav-text">(1)MySQL Query Optimizer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-MySQL常见瓶颈"><span class="nav-number">2.4.2.</span> <span class="nav-text">(2)MySQL常见瓶颈</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Explain"><span class="nav-number">2.4.3.</span> <span class="nav-text">(3)Explain</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-索引优化"><span class="nav-number">2.5.</span> <span class="nav-text">5.索引优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-索引分析"><span class="nav-number">2.5.1.</span> <span class="nav-text">(1)索引分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-索引失效"><span class="nav-number">2.5.2.</span> <span class="nav-text">(2)索引失效</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-一般性建议"><span class="nav-number">2.5.3.</span> <span class="nav-text">(3)一般性建议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三章-查询截取分析"><span class="nav-number">3.</span> <span class="nav-text">第三章    查询截取分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-查询优化"><span class="nav-number">3.1.</span> <span class="nav-text">1.查询优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-优化原则"><span class="nav-number">3.1.1.</span> <span class="nav-text">(1)优化原则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-ORDER-BY关键字优化"><span class="nav-number">3.1.2.</span> <span class="nav-text">(2)ORDER BY关键字优化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-GROUP-BY关键字优化"><span class="nav-number">3.1.3.</span> <span class="nav-text">(3)GROUP BY关键字优化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-慢查询日志"><span class="nav-number">3.2.</span> <span class="nav-text">2.慢查询日志</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概念-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">(1)概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-使用"><span class="nav-number">3.2.2.</span> <span class="nav-text">(2)使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-日志分析工具mysqldumpslow"><span class="nav-number">3.2.3.</span> <span class="nav-text">(3)日志分析工具mysqldumpslow</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-批量数据脚本"><span class="nav-number">3.3.</span> <span class="nav-text">3.批量数据脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Show-Profile"><span class="nav-number">3.4.</span> <span class="nav-text">4.Show Profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-全局查询日志"><span class="nav-number">3.5.</span> <span class="nav-text">5.全局查询日志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第四章-MySQL锁机制"><span class="nav-number">4.</span> <span class="nav-text">第四章    MySQL锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-概述-1"><span class="nav-number">4.1.</span> <span class="nav-text">1.概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-三锁"><span class="nav-number">4.2.</span> <span class="nav-text">2.三锁</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-表锁-偏读"><span class="nav-number">4.2.1.</span> <span class="nav-text">(1)表锁(偏读)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-行锁-偏写"><span class="nav-number">4.2.2.</span> <span class="nav-text">(2)行锁(偏写)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-页锁"><span class="nav-number">4.2.3.</span> <span class="nav-text">(3)页锁</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第五章-主从复制"><span class="nav-number">5.</span> <span class="nav-text">第五章    主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-复制的基本原理"><span class="nav-number">5.1.</span> <span class="nav-text">1.复制的基本原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-复制的基本原则"><span class="nav-number">5.2.</span> <span class="nav-text">2.复制的基本原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-复制的最大问题"><span class="nav-number">5.3.</span> <span class="nav-text">3.复制的最大问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-一主一从常见配置"><span class="nav-number">5.4.</span> <span class="nav-text">4.一主一从常见配置</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo-Fang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Leo-Fang</p>
  <div class="site-description" itemprop="description">记录学习笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Leo-Fang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Leo-Fang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lefang0530@gmail.com" title="E-Mail → mailto:lefang0530@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo-Fang</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共134.8k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'V6ESupTFrlogGO5niagnkvsh-gzGzoHsz',
      appKey     : 'aA5SS2K4SpyjvaSTnAUoxupj',
      placeholder: "ฅ՞•ﻌ•՞ฅ来唠唠嗑呗~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
