<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一、MyBatis简介1.MyBatis介绍 MyBatis是支持定制化SQL、存储过程以及高级映射的优秀的持久层框架 MyBatis避免了几乎所有的JDBC代码和手动设置参数以及获取结果集 MyBatis可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（Plain Old Java Objects，普通的Java对象）映射成数据库中的记录">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis">
<meta property="og:url" content="http://yoursite.com/2020/08/17/MyBatis/index.html">
<meta property="og:site_name" content="Ale&#39;s Blog">
<meta property="og:description" content="一、MyBatis简介1.MyBatis介绍 MyBatis是支持定制化SQL、存储过程以及高级映射的优秀的持久层框架 MyBatis避免了几乎所有的JDBC代码和手动设置参数以及获取结果集 MyBatis可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（Plain Old Java Objects，普通的Java对象）映射成数据库中的记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200817105949328.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200817142717026.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200817143349448.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200817143807682.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200820110922527.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200820192313994.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200820201805518.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200821160350698.png">
<meta property="og:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200822153435045.png">
<meta property="article:published_time" content="2020-08-17T02:17:46.016Z">
<meta property="article:modified_time" content="2020-08-23T07:57:53.136Z">
<meta property="article:author" content="Leo-Fang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/08/17/MyBatis/image-20200817105949328.png">

<link rel="canonical" href="http://yoursite.com/2020/08/17/MyBatis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MyBatis | Ale's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ale's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/MyBatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo-Fang">
      <meta itemprop="description" content="记录学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ale's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MyBatis
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-17 10:17:46" itemprop="dateCreated datePublished" datetime="2020-08-17T10:17:46+08:00">2020-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-23 15:57:53" itemprop="dateModified" datetime="2020-08-23T15:57:53+08:00">2020-08-23</time>
              </span>

          
            <span id="/2020/08/17/MyBatis/" class="post-meta-item leancloud_visitors" data-flag-title="MyBatis" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/08/17/MyBatis/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/08/17/MyBatis/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="一、MyBatis简介"><a href="#一、MyBatis简介" class="headerlink" title="一、MyBatis简介"></a>一、MyBatis简介</h3><h4 id="1-MyBatis介绍"><a href="#1-MyBatis介绍" class="headerlink" title="1.MyBatis介绍"></a>1.MyBatis介绍</h4><ul>
<li>MyBatis是支持定制化SQL、存储过程以及高级映射的优秀的持久层框架</li>
<li>MyBatis避免了几乎所有的JDBC代码和手动设置参数以及获取结果集</li>
<li>MyBatis可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（Plain Old Java Objects，普通的Java对象）映射成数据库中的记录</li>
</ul>
<a id="more"></a>

<h4 id="2-MyBatis历史"><a href="#2-MyBatis历史" class="headerlink" title="2.MyBatis历史"></a>2.MyBatis历史</h4><ul>
<li>MyBatis原本是apache的一个开源项目iBatis，2010年6月这个项目由Apache Software Foundation迁移到了Google Code，随着开发团队转投Google Code旗下，iBatis3.x正式更名为MyBatis，代码与2013年11月迁移到GitHub</li>
<li>iBatis一词源于“Internet”和“abatis”的组合，是一个基于Java的持久层框架。iBatis提供的持久层框架包括SQL Maps和Data Access Objects（DAO）</li>
</ul>
<h4 id="3-为什么要使用MyBatis"><a href="#3-为什么要使用MyBatis" class="headerlink" title="3.为什么要使用MyBatis"></a>3.为什么要使用MyBatis</h4><ul>
<li><p>MyBatis是一个半自动化的持久化层结构</p>
</li>
<li><p>JDBC</p>
<p>①SQL夹在Java代码块里，耦合度高导致硬编码内伤</p>
<p>②维护不易且实际开发需求中sql是有变化，频繁修改的情况多见</p>
</li>
<li><p>Hibernate和JPA</p>
<p>①长难复杂SQL对于Hibernate而言处理也不容易</p>
<p>②内部自动生产的SQL不容易做特殊优化</p>
<p>③基于全映射的全自动框架，大量字段的POJO进行部分映射时比较困难，导致数据库性能下降</p>
</li>
<li><p>对开发人员而言，核心sql还是需要自己优化</p>
</li>
<li><p><span style='color:red;'>sql和Java编码分开，功能边界清晰，一个专注业务，一个专注数据</span></p>
</li>
</ul>
<h4 id="4-MyBatis下载"><a href="#4-MyBatis下载" class="headerlink" title="4.MyBatis下载"></a>4.MyBatis下载</h4><ul>
<li><p>下载地址：<a href="https://github.com/mybatis/mybatis-3" target="_blank" rel="noopener">https://github.com/mybatis/mybatis-3</a></p>
<img src="/2020/08/17/MyBatis/image-20200817105949328.png" class="">



</li>
</ul>
<h3 id="二、MyBatis—HelloWorld"><a href="#二、MyBatis—HelloWorld" class="headerlink" title="二、MyBatis—HelloWorld"></a>二、MyBatis—HelloWorld</h3><h4 id="1-HelloWorld简单版"><a href="#1-HelloWorld简单版" class="headerlink" title="1.HelloWorld简单版"></a>1.HelloWorld简单版</h4><ul>
<li><p>创建一张测试表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &#96;mybatis&#96;; </span><br><span class="line">USE &#96;mybatis&#96;; </span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;tbl_employee&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;last_name&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  &#96;gender&#96; char(1) DEFAULT NULL,</span><br><span class="line">  &#96;email&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;2 DEFAULT CHARSET&#x3D;latin1</span><br><span class="line"></span><br><span class="line">UPDATE &#96;tbl_employee&#96; SET &#96;last_name&#96; &#x3D; &#39;tom&#39; , &#96;gender&#96; &#x3D; &#39;0&#39; , &#96;email&#96; &#x3D; &#39;tom@guigu.com&#39; WHERE &#96;id&#96; &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建对应的JavaBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastname;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> lastname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastname</span><span class="params">(String lastname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.lastname = lastname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Employee [id="</span> + id + <span class="string">", lastname="</span> + lastname + <span class="string">", email="</span> + email + <span class="string">", gender="</span> + gender + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建mybatis配置文件，sql映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"****"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 将写好的sql映射文件注册到全局配置文件中 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"EmployeeMapper.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.EmployeeMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		namespace：名称空间</span></span><br><span class="line"><span class="comment">		id：唯一标识</span></span><br><span class="line"><span class="comment">		resultType：返回值类型</span></span><br><span class="line"><span class="comment">		#&#123;id&#125;：</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectEmp"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 步骤：</span></span><br><span class="line"><span class="comment">	 * 1.根据xml配置文件（全局配置文件）创建一个SqlSessionFactory对象（有数据源的一些运行环境信息）</span></span><br><span class="line"><span class="comment">	 * 2.sql映射文件；配置了每一个sql，以及sql的封装规则等</span></span><br><span class="line"><span class="comment">	 * 3.将sql映射文件注册在全局配置文件中</span></span><br><span class="line"><span class="comment">	 * 4.写代码：</span></span><br><span class="line"><span class="comment">	 * 	1)根据全局配置文件得到SqlSessionFactory</span></span><br><span class="line"><span class="comment">	 * 	2)使用SqlSessionFactory获取到SqlSession对象，使用它来执行增删改查</span></span><br><span class="line"><span class="comment">	 * 		一个SqlSession代表和数据库的一次会话，用完关闭</span></span><br><span class="line"><span class="comment">	 * 	3)使用sql的唯一标识来告诉MyBatis执行哪个sql，sql都是保存在sql映射文件中的</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		String resource = <span class="string">"mybatis-config.xml"</span>; InputStream inputStream =</span><br><span class="line">		Resources.getResourceAsStream(resource); </span><br><span class="line">		SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);	</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取SqlSession实例，能直接执行已经映射的sql语句</span></span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">				 * selectOne  Parameters:</span></span><br><span class="line"><span class="comment">				 * statement: Unique identifier matching the statement to use.sql的唯一标识</span></span><br><span class="line"><span class="comment">				 * parameter: A parameter object to pass to the statement.执行sql要用的参数</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">			Employee employee = openSession.selectOne(<span class="string">"com.atguigu.mybatis.dao.EmployeeMapper.getEmpById"</span>, <span class="number">1</span>);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-MyBatis操作数据库"><a href="#2-MyBatis操作数据库" class="headerlink" title="2.MyBatis操作数据库"></a>2.MyBatis操作数据库</h4><ul>
<li><p>创建MyBatis全局配置文件</p>
<p>MyBatis的全局配置文件包含了影响MyBatis行为甚深的设置（settings）和属性（properties）信息，如数据库连接池信息等，指导着MyBatis进行工作。可以参照官方文件的配置示例进行配置。</p>
</li>
<li><p>创建SQL映射文件</p>
<p>映射文件的作用相当于是定义Dao接口的实现类如何工作。这也是使用MyBatis时编写的最多的文件。</p>
</li>
</ul>
<h4 id="3-HelloWorld-接口式编程"><a href="#3-HelloWorld-接口式编程" class="headerlink" title="3.HelloWorld-接口式编程"></a>3.HelloWorld-接口式编程</h4><ul>
<li><p>创建一个Dao接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改Mapper文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		namespace：名称空间。指定为接口的全类名</span></span><br><span class="line"><span class="comment">		id：唯一标识</span></span><br><span class="line"><span class="comment">		resultType：返回值类型</span></span><br><span class="line"><span class="comment">		#&#123;id&#125;：</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.dao.EmployeeMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.接口式编程</span></span><br><span class="line"><span class="comment"> * 		原生：		Dao		====&gt;	DaoImpl</span></span><br><span class="line"><span class="comment"> * 		MyBatis：	Mapper	====&gt;	xxMapper.xml</span></span><br><span class="line"><span class="comment"> * 2.SqlSession代表和数据库的一次会话，用完必须关闭</span></span><br><span class="line"><span class="comment"> * 3.SqlSession和connection一样都是非线程安全，每次使用都应该去获取新的对象</span></span><br><span class="line"><span class="comment"> * 4.mapper接口没有实现类，但是MyBatis会为这个接口生成一个代理对象（将接口和xml进行绑定）</span></span><br><span class="line"><span class="comment"> * 		EmployeeMapper empMapper = sqlSession.getMapper(EmployeeMapper.class);</span></span><br><span class="line"><span class="comment"> * 5.两个重要的配置文件：</span></span><br><span class="line"><span class="comment"> * 		mybatis的全局配置文件：包含数据库连接池信息，事务管理器信息等——系统运行环境信息</span></span><br><span class="line"><span class="comment"> * 		sql映射文件：保存了每一个sql语句的映射信息。将sql抽取出来。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Fang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//提取方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">		InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 步骤：</span></span><br><span class="line"><span class="comment">	 * 1.根据xml配置文件（全局配置文件）创建一个SqlSessionFactory对象（有数据源的一些运行环境信息）</span></span><br><span class="line"><span class="comment">	 * 2.sql映射文件；配置了每一个sql，以及sql的封装规则等</span></span><br><span class="line"><span class="comment">	 * 3.将sql映射文件注册在全局配置文件中</span></span><br><span class="line"><span class="comment">	 * 4.写代码：</span></span><br><span class="line"><span class="comment">	 * 	1)根据全局配置文件得到SqlSessionFactory</span></span><br><span class="line"><span class="comment">	 * 	2)使用SqlSessionFactory获取到SqlSession对象，使用它来执行增删改查</span></span><br><span class="line"><span class="comment">	 * 		一个SqlSession代表和数据库的一次会话，用完关闭</span></span><br><span class="line"><span class="comment">	 * 	3)使用sql的唯一标识来告诉MyBatis执行哪个sql，sql都是保存在sql映射文件中的</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * String resource = "mybatis-config.xml"; </span></span><br><span class="line"><span class="comment">		 * InputStream inputStream = Resources.getResourceAsStream(resource); </span></span><br><span class="line"><span class="comment">		 * SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();	</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取SqlSession实例，能直接执行已经映射的sql语句</span></span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">				 * selectOne  Parameters:</span></span><br><span class="line"><span class="comment">				 * statement: Unique identifier matching the statement to use.sql的唯一标识</span></span><br><span class="line"><span class="comment">				 * parameter: A parameter object to pass to the statement.执行sql要用的参数</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">			Employee employee = openSession.selectOne(<span class="string">"com.atguigu.mybatis.dao.EmployeeMapper.getEmpById"</span>, <span class="number">1</span>);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">//1.获取SqlSessionFactory对象</span></span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.获取SqlSession对象</span></span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//3.获取接口的实现类对象</span></span><br><span class="line">			<span class="comment">//MyBatis会为接口自动创建一个代理对象，代理对象去执行增删改查方法</span></span><br><span class="line">			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			System.out.println(mapper.getClass());</span><br><span class="line">			Employee employee = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-SqlSession"><a href="#4-SqlSession" class="headerlink" title="4.SqlSession"></a>4.SqlSession</h4><ul>
<li>SqlSession的实例不是线程安全的，因此是不能被共享的</li>
<li>SqlSession每次使用完成后需要正确关闭，这个关闭操作是必须的</li>
<li>SqlSession可以直接调用方法的id进行数据库操作，但是一般还是推荐使用SqlSession获取到Dao接口的代理类，执行代理对象的方法，可以更安全的进行类型检查操作</li>
</ul>
<h3 id="三、MyBatis—全局配置文件"><a href="#三、MyBatis—全局配置文件" class="headerlink" title="三、MyBatis—全局配置文件"></a>三、MyBatis—全局配置文件</h3><p>MyBatis的全局配置文件包含了影响MyBatis行为甚深的设置（settings）和属性（properties）信息。文档的顶层结构如下：</p>
<p>configuration（配置）</p>
<ul>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#properties" target="_blank" rel="noopener">properties（属性）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#settings" target="_blank" rel="noopener">settings（设置）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases" target="_blank" rel="noopener">typeAliases（类型别名）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers" target="_blank" rel="noopener">typeHandlers（类型处理器）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory" target="_blank" rel="noopener">objectFactory（对象工厂）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins" target="_blank" rel="noopener">plugins（插件）</a></li>
<li>environments（环境配置）<ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider" target="_blank" rel="noopener">databaseIdProvider（数据库厂商标识）</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#mappers" target="_blank" rel="noopener">mappers（映射器）</a></li>
</ul>
<h4 id="0-dtd约束文件"><a href="#0-dtd约束文件" class="headerlink" title="0.dtd约束文件"></a>0.dtd约束文件</h4><p>在Eclipse中引入XML的dtd约束文件，方便编写XML的时候有提示。有两种方式：</p>
<p>连网情况下：</p>
<img src="/2020/08/17/MyBatis/image-20200817142717026.png" class="">

<p>手动配置：</p>
<p>①用解压软件打开下载的“mybatis-3.5.5“包，从中找到”mybatis-3-config.dtd“和”mybatis-3-mapper.dtd“文件，将它们单独解压出来</p>
<img src="/2020/08/17/MyBatis/image-20200817143349448.png" class="">

<p>②在Eclipse中，点击【Window】→【Preference】→【XML Catalog】，然后进行如下配置。配置完成后需要重新打开XML文件才能生效</p>
<img src="/2020/08/17/MyBatis/image-20200817143807682.png" class="">

<h4 id="1-属性（properties）"><a href="#1-属性（properties）" class="headerlink" title="1.属性（properties）"></a>1.属性（properties）</h4><p>如果属性在不只一个地方进行了配置，那么MyBatis将按照下面的顺序来加载：</p>
<p>①在properties元素体内指定的属性首先被读取</p>
<p>②然后根据properties元素中的resource属性读取类路径下属性文件或根据url属性指定的路径读取属性文件，并覆盖已读取的同名属性</p>
<p>③最后读取作为方法参数传递的属性，并覆盖已读取的同名属性</p>
<p>示例：</p>
<p>在类路径下创建一个properties文件”dbconfig.properties“</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">****</span></span><br></pre></td></tr></table></figure>

<p>在”mybatis-config.xml“文件中引入properties配置文件中的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 1.properties：mybatis可以使用properties来引入外部properties配置文件的内容</span></span><br><span class="line"><span class="comment">			resource：引入类路径下的资源</span></span><br><span class="line"><span class="comment">			url：引入网路路径或者磁盘路径下的资源</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"dbconfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 将写好的sql映射文件注册到全局配置文件中 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"EmployeeMapper.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-设置（settings）"><a href="#2-设置（settings）" class="headerlink" title="2.设置（settings）"></a>2.设置（settings）</h4><p>MyBatis中极为重要的调整设置，会改变MyBatis的运行时行为</p>
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>cacheEnabled</td>
<td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>useColumnLabel</td>
<td>使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>defaultStatementTimeout</td>
<td>设置超时时间，它决定数据库驱动等待数据库响应的秒数。</td>
<td>任意正整数</td>
<td>未设置 (null)</td>
</tr>
<tr>
<td>mapUnderscoreToCamelCase</td>
<td>是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td>
<td>true | false</td>
<td>False</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.settings包含很多重要的设置项</span></span><br><span class="line"><span class="comment">		setting：用来设置每一个设置项</span></span><br><span class="line"><span class="comment">			name：设置项名称</span></span><br><span class="line"><span class="comment">			value：设置项取值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span><span class="comment">&lt;!-- 驼峰命名自动映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-类型别名（typeAliases）"><a href="#3-类型别名（typeAliases）" class="headerlink" title="3.类型别名（typeAliases）"></a>3.类型别名（typeAliases）</h4><p>类型别名是为Java类型设置一个短的名字，方便应用某个类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.typeAliases：别名处理器，可以为Java类型起别名——别名不区分大小写！！！</span></span><br><span class="line"><span class="comment">		typeAlias：为某个java类型起别名</span></span><br><span class="line"><span class="comment">			type：指定要起别名的类型全类名；默认别名就是类名小写，如下例中默认就是employee</span></span><br><span class="line"><span class="comment">			alias：指定新的别名</span></span><br><span class="line"><span class="comment">		package：为某个包下的所有类批量起别名</span></span><br><span class="line"><span class="comment">			name：指定包名，为当前包以及下面所有的后代包的每一个类都起一个默认别名（类名小写）</span></span><br><span class="line"><span class="comment">			批量起别名的情况下，使用@Alias注解为某个类型指定新的别名</span></span><br><span class="line"><span class="comment">		（建议还是在返回类型中写类型的全类名）</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;typeAlias type="com.atguigu.mybatis.bean.Employee" alias="emp"/&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.atguigu.mybatis.bean"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyBatis已经为许多常见的Java类型内建了相应的类型别名，它们都是大小写不敏感的，在起别名的时候千万不要占用已有的别名</p>
<h4 id="4-类型处理器（typeHandles）"><a href="#4-类型处理器（typeHandles）" class="headerlink" title="4.类型处理器（typeHandles）"></a>4.类型处理器（typeHandles）</h4><p>无论是MyBatis在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时，都会用类型处理器将获取的值以合适的方式转换成Java类型</p>
<table>
<thead>
<tr>
<th align="left">类型处理器</th>
<th align="left">Java 类型</th>
<th align="left">JDBC 类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BooleanTypeHandler</td>
<td align="left">java.lang.Boolean, boolean</td>
<td align="left">数据库兼容的 BOOLEAN</td>
</tr>
<tr>
<td align="left">ByteTypeHandler</td>
<td align="left">java.lang.Byte, byte</td>
<td align="left">数据库兼容的 NUMERIC 或 BYTE</td>
</tr>
<tr>
<td align="left">ShortTypeHandler</td>
<td align="left">java.lang.Short, short</td>
<td align="left">数据库兼容的 NUMERIC 或 SMALLINT</td>
</tr>
<tr>
<td align="left">IntegerTypeHandler</td>
<td align="left">java.lang.Integer, int</td>
<td align="left">数据库兼容的 NUMERIC 或 INTEGER</td>
</tr>
<tr>
<td align="left">LongTypeHandler</td>
<td align="left">java.lang.Long, long</td>
<td align="left">数据库兼容的 NUMERIC 或 BIGINT</td>
</tr>
<tr>
<td align="left">FloatTypeHandler</td>
<td align="left">java.lang.Float, float</td>
<td align="left">数据库兼容的 NUMERIC 或 FLOAT</td>
</tr>
<tr>
<td align="left">DoubleTypeHandler</td>
<td align="left">java.lang.Double, double</td>
<td align="left">数据库兼容的 NUMERIC 或 DOUBLE</td>
</tr>
<tr>
<td align="left">BigDecimalTypeHandler</td>
<td align="left">java.math.BigDecimal</td>
<td align="left">数据库兼容的 NUMERIC 或 DECIMAL</td>
</tr>
<tr>
<td align="left">StringTypeHandler</td>
<td align="left">java.lang.String</td>
<td align="left">CHAR, VARCHAR</td>
</tr>
</tbody></table>
<ul>
<li><p>日期类型的处理：</p>
<p>①日期和时间的处理，JDK1.8以前一直是个头疼的问题。通常使用JSR310规范领导者Stephen Colebourne创建的的Joda-Time来操作。1.8已经实现了全部的JSR310规范了。</p>
<p>②日期时间处理上，可以使用MyBatis基于JSR310（Date and Time API）编写的各种日期时间类型处理器。</p>
<p>③MyBatis3.4以前的版本需要手动注册这些处理器，以后的版本都是自动注册的。</p>
</li>
<li><p>自定义类型处理器：</p>
<p>我们可以重写类型处理器或创建自己的类型处理器来处理不支持的或非标准的类型</p>
<p>步骤：</p>
<p>①实现org.apache.ibatis.type.TypeHandler接口或者继承org.apache.ibatis.type.BaseTypeHandler</p>
<p>②指定其映射某个JDBC类型（可选操作）</p>
<p>③在mybatis全局配置文件中注册</p>
</li>
</ul>
<h4 id="5-插件（plugins）"><a href="#5-插件（plugins）" class="headerlink" title="5.插件（plugins）"></a>5.插件（plugins）</h4><p>插件是MyBatis提供的一个非常强大的机制，可以通过插件来修改MyBatis的一些核心行为。插件通过动态代理机制，可以介入四大对象的任何一个方法的执行。</p>
<p>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</p>
<p>ParameterHandler (getParameterObject, setParameters)</p>
<p>ResultSetHandler (handleResultSets, handleOutputParameters)</p>
<p>StatementHandler (prepare, parameterize, batch, update, query)</p>
<h4 id="6-环境配置（environments）"><a href="#6-环境配置（environments）" class="headerlink" title="6.环境配置（environments）"></a>6.环境配置（environments）</h4><p>MyBatis可以配置多种环境，比如开发、测试和生产环境，需要有不同的配置，每种环境使用一个environment标签进行配置并指定唯一标识符，通过environments标签中的default属性指定一个环境的标识符来实现快速切换环境</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 4.environments：MyBatis可以配置多种环境 </span></span><br><span class="line"><span class="comment">		default：指定使用某种环境，可以实现快速切换环境</span></span><br><span class="line"><span class="comment">		environment：配置一个具体的环境信息，必须有transactionManager和dataSource两个标签</span></span><br><span class="line"><span class="comment">			id：指定当前环境的唯一标识</span></span><br><span class="line"><span class="comment">			transactionManager：事务管理器</span></span><br><span class="line"><span class="comment">				type：事务管理器的类型，JDBC（JdbcTransactionFactory）、MANAGED（ManagedTransactionFactory）、自定义事务管理器（实现TransactionFactory接口，type指定为全类名）</span></span><br><span class="line"><span class="comment">			dataSource：数据源，</span></span><br><span class="line"><span class="comment">				type：数据源类型，有UNPOOLED（UnpooledDataSourceFactory）、POOLED（PooledDataSourceFactory）、JNDI（JndiDataSourceFactory）、自定义数据源（实现DataSourceFactory接口，type是全类名）</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>transactionManager：事务管理器</p>
<ul>
<li><p>type：</p>
<p>JDBC：使用了JDBC的提交和回滚设置，依赖于从数据源得到的连接来管理事务范围（是JdbcTransactionFactory的别名）</p>
<p>MANAGED：不提交或回滚一个连接、让容器来管理事务的整个生命周期（比如JEE应用服务器的上下文）（ManagedTransactionFactory）</p>
<p>自定义：实现TransactionFactory接口，type=全类名/别名</p>
</li>
</ul>
<p>dataSource：数据源</p>
<ul>
<li><p>type：</p>
<p>UNPOOLED：不适应连接池（UnpooledDataSourceFactory）</p>
<p>POOLED：使用连接池（PooledDataSourceFactory）</p>
<p>JNDI：在EJB或应用服务器这类容器中查找指定的数据源（JndiDataSourceFactory）</p>
<p>自定义：实现DataSourceFactory接口，type是全类名，定义数据源的获取方式</p>
</li>
</ul>
<h4 id="7-数据库厂商标识（databaseIdProvider）"><a href="#7-数据库厂商标识（databaseIdProvider）" class="headerlink" title="7.数据库厂商标识（databaseIdProvider）"></a>7.数据库厂商标识（databaseIdProvider）</h4><p>MyBatis可以根据不同的数据库厂商执行不同的语句</p>
<p>MyBatis匹配规则如下：</p>
<p>①如果没有配置databaseIdProvider标签，那么databaseId=null</p>
<p>②如果配置了databaseIdProvider，使用标签配置的name去匹配数据库信息，匹配上要设置databaseId=配置指定的值，否则依旧为null</p>
<p>③如果databaseId不为null，它只会找到配置databaseId的sql语句</p>
<p>④<span style='color:red;'>MyBatis会加载不带databaseId属性和带有匹配当前数据库databaseId属性的所有语句，如果同时找到带有databaseId和不带databaseId的相同语句，则后者会被舍弃</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 5.databaseIdProvider：支持多数据库厂商</span></span><br><span class="line"><span class="comment">		type：DB-VENDOR(VendorDatabaseIdProvider)</span></span><br><span class="line"><span class="comment">		 作用就是得到数据库厂商的标识（驱动getDatabaseProductName()），MyBatis就能根据数据库厂商的标识来执行不同的sql</span></span><br><span class="line"><span class="comment">		MySQL，Oracle，SQL Server，……</span></span><br><span class="line"><span class="comment">			name：数据库厂商标识</span></span><br><span class="line"><span class="comment">			value：为标识起一个别名，方便SQL语句使用databaseId属性引用</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">"DB-VENDOR"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 为不同的数据库厂商起别名 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"MySQL"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"Oracle"</span> <span class="attr">value</span>=<span class="string">"oracle"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"SQL server"</span> <span class="attr">value</span>=<span class="string">"sqlserver"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在“EmployeeMapper.xml”的select标签中加入”databaseId“</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">databaseId</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">	select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="8-映射器（mappers）"><a href="#8-映射器（mappers）" class="headerlink" title="8.映射器（mappers）"></a>8.映射器（mappers）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 6.mappers：将sql映射注册到全局配置中</span></span><br><span class="line"><span class="comment">		mapper：注册一个sql映射</span></span><br><span class="line"><span class="comment">			注册配置文件：</span></span><br><span class="line"><span class="comment">			resource：引用类路径下的sql映射文件</span></span><br><span class="line"><span class="comment">			url：引用网络路径或者磁盘路径下的sql映射文件</span></span><br><span class="line"><span class="comment">			注册接口：</span></span><br><span class="line"><span class="comment">			class：引用（注册）接口</span></span><br><span class="line"><span class="comment">				(1)有sql映射文件，映射文件名必须和接口同名，并且放在与接口同一目录下</span></span><br><span class="line"><span class="comment">				(2)没有sql映射文件，所有的sql都是利用注解写在接口上 </span></span><br><span class="line"><span class="comment">			推荐：</span></span><br><span class="line"><span class="comment">				比较重要的、复杂的Dao接口使用sql映射文件</span></span><br><span class="line"><span class="comment">				不重要的、简单的Dao接口为了开发快速可以使用注解</span></span><br><span class="line"><span class="comment">		package：批量注册</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;mapper resource="mybatis/mapper/EmployeeMapper.xml" /&gt; --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;mapper url="" /&gt; --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;mapper class="com.atguigu.mybatis.dao.EmployeeMapper" /&gt; --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;mapper class="com.atguigu.mybatis.dao.EmployeeMapperAnnotation" /&gt; --&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.atguigu.mybatis.dao"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用class属性，没有sql映射文件时，使用注解的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapperAnnotation</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from tbl_employee where id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">	SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		EmployeeMapperAnnotation mapper = openSession.getMapper(EmployeeMapperAnnotation<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		Employee employee = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-注意事项"><a href="#9-注意事项" class="headerlink" title="9.注意事项"></a>9.注意事项</h4><p>在全局配置文件中，编写各个标签时有一定的顺序，如果顺序错了也会报错。</p>
<p>顺序从上到下为：properties，settings，typeAliases，typeHandlers，objectFactory，plugins，environments，databaseIdProvider，mappers</p>
<h3 id="四、MyBatis—映射文件"><a href="#四、MyBatis—映射文件" class="headerlink" title="四、MyBatis—映射文件"></a>四、MyBatis—映射文件</h3><p>映射文件指导着MyBatis如何进行数据库增删改查，有着非常重要的意义。</p>
<p>SQL 映射文件只有很少的几个顶级元素（按照应被定义的顺序列出）：</p>
<ul>
<li>cache – 该命名空间的缓存配置</li>
<li>cache-ref – 引用其它命名空间的缓存配置</li>
<li>resultMap – 描述如何从数据库结果集中加载对象，是最复杂也是最强大的元素</li>
<li>parameterMap – 老式风格的参数映射。此元素已被废弃，并可能在将来被移除！请使用行内参数映射</li>
<li>sql – 可被其它语句引用的可重用语句块</li>
<li>insert – 映射插入语句</li>
<li>update – 映射更新语句</li>
<li>delete – 映射删除语句</li>
<li>select – 映射查询语句</li>
</ul>
<h4 id="1-insert，-update-和-delete"><a href="#1-insert，-update-和-delete" class="headerlink" title="1.insert， update 和 delete"></a>1.insert， update 和 delete</h4><ul>
<li><p>Insert， Update， Delete元素的属性</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：（对 insert、update 和 delete 语句）true。</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td align="left">useGeneratedKeys</td>
<td align="left">（仅适用于 insert 和 update）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系型数据库管理系统的自动递增字段），默认值：false。</td>
</tr>
<tr>
<td align="left">keyProperty</td>
<td align="left">（仅适用于 insert 和 update）指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（unset）。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td align="left">keyColumn</td>
<td align="left">（仅适用于 insert 和 update）设置生成键值在表中的列名，在某些数据库（像 PostgreSQL）中，当主键列不是表中的第一列的时候，是必须设置的。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td align="left">databaseId</td>
<td align="left">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
</tbody></table>
</li>
<li><p>主键的生成方式</p>
<p>①若数据库支持自动生成主键的字段（如MySQL和SQL Server），则可以设置useGeneratedKeys=”true”，然后再把keyProperty设置到目标属性上</p>
<p>②对于不支持自增型主键的数据库（如Oracle），则可以使用selectKey子元素：selectKey元素将会首先运行，id会被设置，然后插入语句会被调用</p>
<p>selectKey元素的属性</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>keyProperty</code></td>
<td align="left"><code>selectKey</code> 语句结果应该被设置到的目标属性。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td align="left"><code>keyColumn</code></td>
<td align="left">返回结果集中生成列属性的列名。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td align="left"><code>resultType</code></td>
<td align="left">结果的类型。通常 MyBatis 可以推断出来，但是为了更加准确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果生成列不止一个，则可以使用包含期望属性的 Object 或 Map。</td>
</tr>
<tr>
<td align="left"><code>order</code></td>
<td align="left">可以设置为 <code>BEFORE</code> 或 <code>AFTER</code>。如果设置为 <code>BEFORE</code>，那么它首先会生成主键，设置 <code>keyProperty</code> 再执行插入语句。如果设置为 <code>AFTER</code>，那么先执行插入语句，然后是 <code>selectKey</code> 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。</td>
</tr>
<tr>
<td align="left"><code>statementType</code></td>
<td align="left">和前面一样，MyBatis 支持 <code>STATEMENT</code>，<code>PREPARED</code> 和 <code>CALLABLE</code> 类型的映射语句，分别代表 <code>Statement</code>, <code>PreparedStatement</code> 和 <code>CallableStatement</code> 类型。</td>
</tr>
</tbody></table>
</li>
<li><p>代码演示</p>
<p>在”Employee.java“中添加构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(Integer id, String lastName, String email, String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> lastName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastname</span><span class="params">(String lastname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Employee [id="</span> + id + <span class="string">", lastname="</span> + lastName + <span class="string">", email="</span> + email + <span class="string">", gender="</span> + gender + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Dao接口类中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmp</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateEmp</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在“EmployeeMapper.xml”文件中添加对应的标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		namespace：名称空间。指定为接口的全类名</span></span><br><span class="line"><span class="comment">		id：唯一标识</span></span><br><span class="line"><span class="comment">		resultType：返回值类型</span></span><br><span class="line"><span class="comment">		#&#123;id&#125;：</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">databaseId</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			parameterType可以省略</span></span><br><span class="line"><span class="comment">		获取自增主键的值：</span></span><br><span class="line"><span class="comment">			MySQL支持自增主键，mybatis也是利用statement.getGeneratedKeys();</span></span><br><span class="line"><span class="comment">			useGeneratedKeys="true"：使用自增主键获取主键值策略 </span></span><br><span class="line"><span class="comment">			keyProperty：指定对应的主键属性，也就是mybatis获取到主键值以后，将这个值封装给JavaBean的哪个属性</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmp"</span> <span class="attr">parameterType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">		insert into tbl_employee(last_name,email,gender) </span><br><span class="line">		values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- Oracle不支持自增，使用序列来模拟自增，每次插入的数据的主键是从序列中拿到的值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmp"</span> <span class="attr">databaseId</span>=<span class="string">"oracle"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">			keyProperty：查出的主键值封装给JavaBean的哪个属性</span></span><br><span class="line"><span class="comment">			order="BEFORE"：当前sql在插入sql之前运行</span></span><br><span class="line"><span class="comment">					"AFTER"：当前sql在插入sql之后运行</span></span><br><span class="line"><span class="comment">			resultType：查出数据的返回值类型</span></span><br><span class="line"><span class="comment">			BEFORE运行顺序：</span></span><br><span class="line"><span class="comment">				先运行selectKey查询id的sql，查出id值封装给JavaBean的id属性</span></span><br><span class="line"><span class="comment">				再运行插入的sql，取出id属性对应的值</span></span><br><span class="line"><span class="comment">			AFTER运行顺序：</span></span><br><span class="line"><span class="comment">				先运行插入的sql，从序列中取出新值作为id</span></span><br><span class="line"><span class="comment">				再运行selectKey查询id的sql，查出id值封装给JavaBean的id属性</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">			编写查询主键sql语句</span><br><span class="line">			select EMPLOYEES_SEQ.nextval from dual</span><br><span class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">		插入时的主键是从序列中拿到的</span><br><span class="line">		insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span><br><span class="line">		values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email&#125;)</span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- &lt;selectKey keyProperty="id" order="AFTER" resultType="Integer"&gt;</span></span><br><span class="line"><span class="comment">			编写查询主键sql语句</span></span><br><span class="line"><span class="comment">			select EMPLOYEES_SEQ.currval from dual</span></span><br><span class="line"><span class="comment">		&lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">		插入时的主键是从序列中拿到的</span></span><br><span class="line"><span class="comment">		insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span></span><br><span class="line"><span class="comment">		values(#&#123;employees_seq.nextval&#125;,#&#123;lastName&#125;,#&#123;email&#125;) --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void updateEmp(Employee employee); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateEmp"</span>&gt;</span></span><br><span class="line">		update tbl_employee </span><br><span class="line">		set last_name = #&#123;lastName&#125;,email = #&#123;email&#125;,gender = #&#123;gender&#125; </span><br><span class="line">		where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void deleteEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteEmpById"</span>&gt;</span></span><br><span class="line">		delete from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 测试增删改</span></span><br><span class="line"><span class="comment">	 * 1.MyBatis允许增删改直接定义以下类型的返回值</span></span><br><span class="line"><span class="comment">	 * 		Integer、Long、Boolean、void</span></span><br><span class="line"><span class="comment">	 * 2.需要手动提交数据</span></span><br><span class="line"><span class="comment">	 * 		sqlSessionFactory.openSession();===&gt;手动提交</span></span><br><span class="line"><span class="comment">	 * 	自动提交数据</span></span><br><span class="line"><span class="comment">	 * 		sqlSessionFactory.openSession(true);</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">		<span class="comment">//1.获取到的SqlSession不会自动提交数据</span></span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			<span class="comment">//测试添加</span></span><br><span class="line">			Employee employee = <span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="string">"jerry"</span>, <span class="string">"jerry@atguigu.com"</span>, <span class="string">"1"</span>);</span><br><span class="line">			mapper.addEmp(employee);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//测试修改</span></span><br><span class="line"><span class="comment">//			Employee employee = new Employee(1, "tom", "jerry@atguigu.com", "0");</span></span><br><span class="line"><span class="comment">//			boolean updateEmp = mapper.updateEmp(employee);</span></span><br><span class="line"><span class="comment">//			System.out.println(updateEmp);</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">//测试删除</span></span><br><span class="line"><span class="comment">//			mapper.deleteEmpById(2);</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">//2.手动提交数据</span></span><br><span class="line">			openSession.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-参数"><a href="#2-参数" class="headerlink" title="2.参数"></a>2.参数</h4><ul>
<li><p>单个参数</p>
<p>可以接受基本类型、对象类型、集合类型的值。这种情况MyBatis可以直接使用这个参数，不需要经过任何处理。#{}中可以写任意名称，相当于占位符。</p>
</li>
<li><p>多个参数</p>
<p>任意多个参数，都会被MyBatis重新包装成一个Map传入。Map的key是param1,…,paramN或者参数的索引0,1,…,N，value是参数的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(Integer id, String lastName)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdAndLastName"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;param1&#125; and last_name = #&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee employee = mapper.getEmpByIdAndLastName(<span class="number">1</span>, <span class="string">"tom"</span>);</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>命名参数</p>
<p>为参数使用@Param(“xx”)起一个名字，MyBatis就会将这些参数封装进map中，key是指定的名字，value是参数的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id, @<span class="title">Param</span><span class="params">(<span class="string">"lastName"</span>)</span>String lastName)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdAndLastName"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125; and last_name = #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>POJO</p>
<p>如果多个参数正好是业务逻辑的数据模型，可以直接传递POJO</p>
</li>
<li><p>Map</p>
<p>如果多个参数不是业务逻辑的数据模型，没有对应的POJO且不经常使用，为了方便可以封装多个参数为map，直接传递</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByMap"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125; and last_name = #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test05</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        map.put(<span class="string">"id"</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">"lastName"</span>, <span class="string">"tom"</span>);</span><br><span class="line">        Employee employee = mapper.getEmpByMap(map);</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>TO</p>
<p>如果多个参数不是业务模型中的数据，但是要经常使用，推荐编写TO（Transfer Object）数据传输对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Page&#123;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>思考</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id, @<span class="title">Param</span><span class="params">(<span class="string">"lastName"</span>)</span>String lastName)</span>;</span><br><span class="line">取值：id ==&gt; #&#123;id/param1&#125;	lastName ==&gt; #&#123;param2&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(Integer id, @Param(<span class="string">"e"</span>)</span>Employee emp)</span>;</span><br><span class="line">取值：id ==&gt; #&#123;param1&#125;	lastName ==&gt; #&#123;param2.lastName/e.lastName&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//特别注意：如果是Collection（List、Set）类型或者是数组，也会特殊处理，即把传入的list或者数组封装在map中</span></span><br><span class="line"><span class="comment">//key：Collection（collection），List（list），数组（array）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">取出第一个id的值：id ==&gt; #&#123;list[0]&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>源码分析</p>
<p>mybatis怎么处理参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方法：</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id, @<span class="title">Param</span><span class="params">(<span class="string">"lastName"</span>)</span>String lastName)</span>;</span><br><span class="line"><span class="comment">//测试：</span></span><br><span class="line">Employee employee = mapper.getEmpByIdAndLastName(<span class="number">1</span>, <span class="string">"tom"</span>);</span><br><span class="line"><span class="comment">//ParamNameResolver解析参数封装map的：</span></span><br><span class="line"><span class="comment">/*	确定流程：</span></span><br><span class="line"><span class="comment">	1.names：&#123;0=id， 1=lastName&#125;；构造器的时候就确定好了</span></span><br><span class="line"><span class="comment">		1.1 获取每个标了param注解的参数的@Param的值：id，lastName，赋值给name</span></span><br><span class="line"><span class="comment">		1.2 每次解析一个参数给map中保存信息（key：参数索引，value：name的值）</span></span><br><span class="line"><span class="comment">			name的值：</span></span><br><span class="line"><span class="comment">				标注了param注解：注解的值</span></span><br><span class="line"><span class="comment">				没有标注：</span></span><br><span class="line"><span class="comment">					全局配置：useActualParamName（jdk1.8）：name=参数名</span></span><br><span class="line"><span class="comment">					没有全局配置：name=map.size()，相当于当前元素的索引</span></span><br><span class="line"><span class="comment">*/</span>		</span><br><span class="line"></span><br><span class="line"><span class="comment">//args[1,"tom"]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getNamedParams</span><span class="params">(Object[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> paramCount = names.size();</span><br><span class="line">    <span class="comment">//1.参数为null直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (args == <span class="keyword">null</span> || paramCount == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//2.如果只有一个元素，并且没有@Param注解，则names.firstKey()=0，即返回args[0]：单个参数直接返回</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!hasParamAnnotation &amp;&amp; paramCount == <span class="number">1</span>) &#123;</span><br><span class="line">      Object value = args[names.firstKey()];</span><br><span class="line">      <span class="keyword">return</span> wrapToMapIfCollection(value, useActualParamName ? names.get(<span class="number">0</span>) : <span class="keyword">null</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//3.多个元素或有@Param标注</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> ParamMap&lt;&gt;();</span><br><span class="line">      <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//4.遍历names集合&#123;0=id, 1=lastName&#125;</span></span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) &#123;</span><br><span class="line">        <span class="comment">//names集合的value作为key，names集合的key作为取值的参考</span></span><br><span class="line">        <span class="comment">//&#123;id=args[0]:1, lastName=args[1]:tom&#125;</span></span><br><span class="line">        param.put(entry.getValue(), args[entry.getKey()]);</span><br><span class="line">        <span class="comment">// add generic param names (param1, param2, ...)</span></span><br><span class="line">        <span class="comment">//额外的将每一个参数也保存到map中，使用新的key：param1, ..., paramN</span></span><br><span class="line">        <span class="comment">//效果：有Param注解可以#&#123;指定的key&#125;，或者#&#123;param1&#125;</span></span><br><span class="line">        <span class="keyword">final</span> String genericParamName = GENERIC_NAME_PREFIX + (i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// ensure not to overwrite parameter named with @Param</span></span><br><span class="line">        <span class="keyword">if</span> (!names.containsValue(genericParamName)) &#123;</span><br><span class="line">          param.put(genericParamName, args[entry.getKey()]);</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//总结：参数多时会封装map，为了不混乱，我们可以使用@Param来指定封装时使用的key，#&#123;key&#125;就可以取出map中的值</span></span><br></pre></td></tr></table></figure>

<p>参数值的获取</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#125;：可以获取map中的值或者pojo对象属性的值；</span><br><span class="line">$&#123;&#125;：可以获取map中的值或者pojo对象属性的值；</span><br><span class="line"></span><br><span class="line">select * from tbl_employee where id=$&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line">Preparing: select * from tbl_employee where id=2 and last_name=?</span><br><span class="line"></span><br><span class="line">区别：</span><br><span class="line">    #&#123;&#125;:是以预编译的形式，将参数设置到sql语句中；PreparedStatement；防止sql注入</span><br><span class="line">    $&#123;&#125;:取出的值直接拼装在sql语句中；会有安全问题；</span><br><span class="line">    大多情况下，我们去参数的值都应该去使用#&#123;&#125;；</span><br><span class="line"></span><br><span class="line">    原生jdbc不支持占位符的地方我们就可以使用$&#123;&#125;进行取值</span><br><span class="line">    比如分表、排序...（按照年份分表拆分）</span><br><span class="line">        select * from $&#123;year&#125;_salary where xxx;</span><br><span class="line">        select * from tbl_employee order by $&#123;f_name&#125; $&#123;order&#125;</span><br><span class="line"></span><br><span class="line">#&#123;&#125;更丰富的用法：</span><br><span class="line">	规定参数的一些规则：</span><br><span class="line">	javaType、jdbcType、mode（存储过程）、numericScale、</span><br><span class="line">	resultMap、typeHandler、jdbcTypeName、expression（未来准备支持的功能）</span><br><span class="line"></span><br><span class="line">	jdbcType通常需要在某种特定的条件下被设置：</span><br><span class="line">		在数据为null的时候，有些数据库可能不能识别mybatis对null的默认处理，比如Oracle（报错）</span><br><span class="line">		</span><br><span class="line">		JdbcType OTHER：无效的类型；因为mybatis对所有的null映射的是原生Jdbc的OTHER类型，oracle不能正确处理</span><br><span class="line">		</span><br><span class="line">		由于全局配置中：jdbcTypeForNull=OTHER；oracle不支持；</span><br><span class="line">		两种办法：</span><br><span class="line">		1、#&#123;email,jdbcType=OTHER&#125;;</span><br><span class="line">		2、jdbcTypeForNull=NULL</span><br><span class="line">			<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"NULL"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-select"><a href="#3-select" class="headerlink" title="3.select"></a>3.select</h4><p>select元素来定义查询操作：</p>
<ul>
<li><p>id：唯一标识符。用来引用这条语句，需要和接口的方法名一致</p>
</li>
<li><p>parameterType：参数类型。可以不传，MyBatis会根据TypeHandler自动推断</p>
</li>
<li><p>resultType：返回值类型。别名或者全类名，如果返回的是集合，定义集合中元素的类型，不能和resultMap同时使用</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td align="left">parameterMap</td>
<td align="left">用于引用外部 parameterMap 的属性，目前已被废弃。请使用行内参数映射和 parameterType 属性。</td>
</tr>
<tr>
<td align="left">resultType</td>
<td align="left">期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td align="left">resultMap</td>
<td align="left">对外部 resultMap 的命名引用。结果映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂的映射问题都能迎刃而解。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：false。</td>
</tr>
<tr>
<td align="left">useCache</td>
<td align="left">将其设置为 true 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 true。</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td align="left">fetchSize</td>
<td align="left">这是一个给驱动的建议值，尝试让驱动程序每次批量返回的结果行数等于这个设置值。 默认值为未设置（unset）（依赖驱动）。</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td align="left">resultSetType</td>
<td align="left">FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖数据库驱动）。</td>
</tr>
<tr>
<td align="left">databaseId</td>
<td align="left">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
<tr>
<td align="left">resultOrdered</td>
<td align="left">这个设置仅针对嵌套结果 select 语句：如果为 true，将会假设包含了嵌套结果集或是分组，当返回一个主结果行时，就不会产生对前面结果集的引用。 这就使得在获取嵌套结果集的时候不至于内存不够用。默认值：false。</td>
</tr>
<tr>
<td align="left">resultSets</td>
<td align="left">这个设置仅适用于多结果集的情况。它将列出语句执行后返回的结果集并赋予每个结果集一个名称，多个名称之间以逗号分隔。</td>
</tr>
</tbody></table>
</li>
</ul>
<p>resultType：</p>
<ul>
<li><p>返回List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByLastNameLike</span><span class="params">(String lastName)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByLastNameLike(String lastName); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultType：如果返回的是一个集合，要写集合中元素的类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByLastNameLike"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where last_name like #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test06</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        List&lt;Employee&gt; like = mapper.getEmpsByLastNameLike(<span class="string">"%e%"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : like) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>记录封装map</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回一条记录的map，key是这条记录的主键，value是记录封装后的JavaBean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getEmpByIdReturnMap</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//多条记录封装一个map，key是列名，value是对应的值</span></span><br><span class="line"><span class="meta">@MapKey</span>(<span class="string">"id"</span>)<span class="comment">//告诉mybatis封装这个map时使用哪个属性作为map的key</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;Integer, Employee&gt; <span class="title">getEmpByLastNameLikeReturnMap</span><span class="params">(String lastName)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public Map&lt;String, Object&gt; getEmpByIdReturnMap(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdReturnMap"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- public Map&lt;Integer, Employee&gt; getEmpByLastNameLikeReturnMap(String lastName); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByLastNameLikeReturnMap"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where last_name like #&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test07</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Map&lt;String, Object&gt; map1 = mapper.getEmpByIdReturnMap(<span class="number">1</span>);</span><br><span class="line">        System.out.println(map1);</span><br><span class="line">        Map&lt;Integer, Employee&gt; map2 = mapper.getEmpByLastNameLikeReturnMap(<span class="string">"%r%"</span>);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;gender=<span class="number">0</span>, last_name=tom, id=<span class="number">1</span>, email=jerry<span class="meta">@atguigu</span>.com&#125;</span><br><span class="line">&#123;<span class="number">3</span>=Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>], <span class="number">4</span>=Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>resultMap：</p>
<ul>
<li><p>id&amp;result</p>
<p>id 和 result 元素都将一个列的值映射到一个简单数据类型（String, int, double, Date 等）的属性或字段。</p>
<p>这两者之间的唯一不同是，id 元素对应的属性会被标记为对象的标识符，在比较对象实例时使用。 这样可以提高整体的性能，尤其是进行缓存和嵌套结果映射（也就是连接映射）的时候。</p>
<p>两个元素都有一些属性：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">property</td>
<td align="left">映射到列结果的字段或属性。如果 JavaBean 有这个名字的属性（property），会先使用该属性。否则 MyBatis 将会寻找给定名称的字段（field）。 无论是哪一种情形，你都可以使用常见的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</td>
</tr>
<tr>
<td align="left">column</td>
<td align="left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 resultSet.getString(columnName) 方法的参数一样。</td>
</tr>
<tr>
<td align="left">javaType</td>
<td align="left">一个 Java 类的全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td align="left">jdbcType</td>
<td align="left">JDBC 类型，所支持的 JDBC 类型参见这个表格之后的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可以为空值的列指定这个类型。</td>
</tr>
<tr>
<td align="left">typeHandler</td>
<td align="left">我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的全限定名，或者是类型别名。</td>
</tr>
</tbody></table>
</li>
<li><p>自定义resultMap，实现高级结果集映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapperPlus</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapperPlus"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 自定义某个JavaBean的封装规则： </span></span><br><span class="line"><span class="comment">		type：自定义规则的Java类型</span></span><br><span class="line"><span class="comment">		id：唯一标识</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">id</span>=<span class="string">"MyEmp"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定主键列的封装规则</span></span><br><span class="line"><span class="comment">			id定义主键底层会有优化 </span></span><br><span class="line"><span class="comment">				column：指定哪一列</span></span><br><span class="line"><span class="comment">				property：指定对应的JavaBean属性</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义普通列封装规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 其它不指定的列会自动封装，只要写resultMap就把全部的映射规则都写上 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- resultMap：自定义结果集映射规则： --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Employee getEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultMap</span>=<span class="string">"MyEmp"</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test08</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperPlus mapper = openSession.getMapper(EmployeeMapperPlus<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee empById = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(empById);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——级联属性封装结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tbl_dept&#96; ( </span><br><span class="line">    &#96;id&#96; INT(11) NOT NULL AUTO_INCREMENT, </span><br><span class="line">    &#96;dept_name&#96; VARCHAR(255), </span><br><span class="line">    PRIMARY KEY (&#96;id&#96;) </span><br><span class="line">) ENGINE&#x3D;INNODB CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;tbl_dept&#96; (&#96;id&#96;, &#96;dept_name&#96;) VALUES (&#39;1&#39;, &#39;开发部&#39;); </span><br><span class="line">INSERT INTO &#96;tbl_dept&#96; (&#96;id&#96;, &#96;dept_name&#96;) VALUES (&#39;2&#39;, &#39;测试部&#39;);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.bean;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">private</span> Integer id;</span><br><span class="line">  	<span class="keyword">private</span> String departmentName;</span><br><span class="line">  	</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">return</span> id;</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">this</span>.id = id;</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> String <span class="title">getDepartmentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">return</span> departmentName;</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepartmentName</span><span class="params">(String departmentName)</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">this</span>.departmentName = departmentName;</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="meta">@Override</span></span><br><span class="line">  	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">return</span> <span class="string">"Department [id="</span> + id + <span class="string">", departmentName="</span> + departmentName + <span class="string">"]"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpAndDept</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    场景一：</span></span><br><span class="line"><span class="comment">        查询Employee的同时查询员工对应的部门</span></span><br><span class="line"><span class="comment">        Employee===Department</span></span><br><span class="line"><span class="comment">        一个员工有与之对应的部门信息:</span></span><br><span class="line"><span class="comment">        id  last_name  gender  d_id  did  dept_name</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 联合查询：级联属性封装结果集 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">id</span>=<span class="string">"MyDifEmp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"did"</span> <span class="attr">property</span>=<span class="string">"dept.id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"dept.departmentName"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Employee getEmpAndDept(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpAndDept"</span> <span class="attr">resultMap</span>=<span class="string">"MyDifEmp"</span>&gt;</span></span><br><span class="line">    SELECT e.id id,e.last_name last_name,e.gender gender,e.d_id d_id,d.id did,d.dept_name dept_name</span><br><span class="line">    FROM tbl_employee e,tbl_dept d</span><br><span class="line">    WHERE e.d_id = d.id AND e.id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test09</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperPlus mapper = openSession.getMapper(EmployeeMapperPlus<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee empAndDept = mapper.getEmpAndDept(<span class="number">1</span>);</span><br><span class="line">        System.out.println(empAndDept);</span><br><span class="line">        System.out.println(empAndDept.getDept());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=<span class="keyword">null</span>, gender=<span class="number">0</span>]</span><br><span class="line">Department [id=<span class="number">1</span>, departmentName=开发部]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——association定义关联对象封装规则</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用association定义关联的单个对象的封装规则 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">id</span>=<span class="string">"MyDifEmp2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- association可以指定联合的JavaBean对象 </span></span><br><span class="line"><span class="comment">            property：指定哪个属性是联合的对象</span></span><br><span class="line"><span class="comment">            javaType：指定属性对象的类型【不能省略】</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">javaType</span>=<span class="string">"com.atguigu.mybatis.bean.Department"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"did"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——association分步查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Department;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DepartmentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.DepartmentMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public Department getDeptById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptById"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Department"</span>&gt;</span></span><br><span class="line">		select id,dept_name departmentName from tbl_dept where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdStep</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用association进行分步查询 </span></span><br><span class="line"><span class="comment">        1.先按照员工id查询员工信息</span></span><br><span class="line"><span class="comment">        2.根据查询员工信息中的d_id值去部门表查出部门信息</span></span><br><span class="line"><span class="comment">        3.部门设置到员工中</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- id  last_name  gender  email  d_id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">id</span>=<span class="string">"MyEmpByStep"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- association定义关联对象的封装规则 </span></span><br><span class="line"><span class="comment">            select：表明当前属性是调用select指定的方法查出的结果</span></span><br><span class="line"><span class="comment">            column：指定将哪一列的值传给这个方法</span></span><br><span class="line"><span class="comment">        流程：使用select指定的方法（传入column指定的这列参数的值）查出对象，并封装给property指定的属性</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">select</span>=<span class="string">"com.atguigu.mybatis.dao.DepartmentMapper.getDeptById"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">column</span>=<span class="string">"d_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Employee getEmpByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyEmpByStep"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperPlus mapper = openSession.getMapper(EmployeeMapperPlus<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee employee = mapper.getEmpByIdStep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">        System.out.println(employee.getDept());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)</span><br><span class="line">Preparing: select id,dept_name departmentName from tbl_dept where id = ?</span><br><span class="line">Parameters: <span class="number">1</span>(Integer)</span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Department [id=<span class="number">1</span>, departmentName=开发部]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——分步查询&amp;延迟加载</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 延迟加载： </span></span><br><span class="line"><span class="comment">        Employee==&gt;Department</span></span><br><span class="line"><span class="comment">        每次查询Employee对象的时候，都一起查询出来，部门信息在使用的时候再去查询	</span></span><br><span class="line"><span class="comment">        在分段查询的基础之上加上两个配置</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p>mybaits-config.xml中的setting标签中添加“lazyLoadingEnabled”和“aggressiveLazyLoading”属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span><span class="comment">&lt;!-- 驼峰命名自动映射 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 显式的指定每个需要更改的配置的值，即使是默认的，防止版本更新带来的问题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">tom</span><br><span class="line">Preparing: select id,dept_name departmentName from tbl_dept where id = ?</span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Department [id=<span class="number">1</span>, departmentName=开发部]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——collection定义关联集合封装规则</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    场景二：</span></span><br><span class="line"><span class="comment">        查询部门的时候将部门对应的所有员工信息也查询出来：注释在DepartmentMapper.xml中</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- collection嵌套结果集的方式，定义关联的集合类型元素的封装规则 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    public class Department &#123;</span></span><br><span class="line"><span class="comment">        private Integer id;</span></span><br><span class="line"><span class="comment">        private String departmentName;</span></span><br><span class="line"><span class="comment">        private List&lt;Employee&gt; emps;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    did  dept_name  eid  last_name  email  gender</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Department"</span> <span class="attr">id</span>=<span class="string">"MyDept"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"did"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">        collection：定义关联集合类型的属性的封装规则</span></span><br><span class="line"><span class="comment">        ofType：指定集合里面元素的类型</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"emps"</span> <span class="attr">ofType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义集合中元素的封装规则 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"eid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdPlus(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdPlus"</span> <span class="attr">resultMap</span>=<span class="string">"MyDept"</span>&gt;</span></span><br><span class="line">    SELECT d.id did,d.dept_name dept_name,</span><br><span class="line">    e.id eid,e.last_name last_name,e.email email,e.gender gender</span><br><span class="line">    FROM tbl_dept d</span><br><span class="line">    LEFT JOIN tbl_employee e</span><br><span class="line">    ON d.id = e.d_id</span><br><span class="line">    WHERE d.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Department <span class="title">getDeptByIdPlus</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test11</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        DepartmentMapper mapper = openSession.getMapper(DepartmentMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Department department = mapper.getDeptByIdPlus(<span class="number">1</span>);</span><br><span class="line">        System.out.println(department);</span><br><span class="line">        System.out.println(department.getEmps());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: SELECT d.id did,d.dept_name dept_name, e.id eid,e.last_name last_name,e.email email,e.gender gender FROM tbl_dept d LEFT JOIN tbl_employee e ON d.id = e.d_id WHERE d.id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Department [id=<span class="number">1</span>, departmentName=开发部]</span><br><span class="line">[Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>], Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联查询——collection分步查询&amp;延迟加载</p>
<p>DepartmentMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Department <span class="title">getDeptByIdStep</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByDeptId</span><span class="params">(Integer deptId)</span></span>;</span><br></pre></td></tr></table></figure>

<p>DepartmentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- collection：分段查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Department"</span> <span class="attr">id</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"emps"</span> <span class="attr">select</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapperPlus.getEmpsByDeptId"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    select id,dept_name from tbl_dept where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>EmployeeMapperPlus</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdStep</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>EmployeeMapperPlus.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByDeptId(Integer deptId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByDeptId"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where d_id = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test12</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        DepartmentMapper mapper = openSession.getMapper(DepartmentMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Department deptByIdStep = mapper.getDeptByIdStep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(deptByIdStep);</span><br><span class="line">        System.out.println(deptByIdStep.getEmps());</span><br><span class="line">        System.out.println(deptByIdStep.getDepartmentName());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select id,dept_name from tbl_dept where id = ?</span><br><span class="line">Parameters: <span class="number">1</span>(Integer)</span><br><span class="line">Preparing: select * from tbl_employee where d_id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Department [id=<span class="number">1</span>, departmentName=开发部]</span><br><span class="line">[Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>], Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]]</span><br><span class="line">开发部</span><br></pre></td></tr></table></figure>
</li>
<li><p>分步查询传递多列值&amp;fetchType</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 扩展：传递多列的值</span></span><br><span class="line"><span class="comment">         将多列的值封装map传递</span></span><br><span class="line"><span class="comment">        column="&#123;key1=column1,key2=column2&#125;"</span></span><br><span class="line"><span class="comment">        fetchType="lazy"：延迟加载</span></span><br><span class="line"><span class="comment">        fetchType="eager"：立即加载</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- collection：分段查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Department"</span> <span class="attr">id</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"emps"</span> <span class="attr">select</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapperPlus.getEmpsByDeptId"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">column</span>=<span class="string">"&#123;deptId=id&#125;"</span> <span class="attr">fetchType</span>=<span class="string">"lazy"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    select id,dept_name from tbl_dept where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>discriminator鉴别器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;discriminator javaType=""&gt;&lt;/discriminator&gt; </span></span><br><span class="line"><span class="comment">        鉴别器：mybatis可以使用discriminator判断某列的值，然后根据某列的值改变封装行为</span></span><br><span class="line"><span class="comment">        封装Employee:</span></span><br><span class="line"><span class="comment">            如果查出的是女生，就把部门信息查询出来，否则不查询</span></span><br><span class="line"><span class="comment">            如果查出的是男生，就把last_name这一列的值赋给email</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span> <span class="attr">id</span>=<span class="string">"MyEmpDis"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">            column：指定判断的列名</span></span><br><span class="line"><span class="comment">            javaType：列值对应的java类型</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">"string"</span> <span class="attr">column</span>=<span class="string">"gender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- resultType：指定封装的结果类型。不能缺少 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span><span class="comment">&lt;!-- 女生 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">select</span>=<span class="string">"com.atguigu.mybatis.dao.DepartmentMapper.getDeptById"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">"d_id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span><span class="comment">&lt;!-- 男生 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"lastName"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- public Employee getEmpByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyEmpDis"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperPlus mapper = openSession.getMapper(EmployeeMapperPlus<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee employee = mapper.getEmpByIdStep(<span class="number">3</span>);</span><br><span class="line">        System.out.println(employee.getLastname());</span><br><span class="line">        System.out.println(employee.getDept());</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">3</span>(Integer) </span><br><span class="line">jerry</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry, gender=<span class="number">1</span>]</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="五、MyBatis—动态SQL"><a href="#五、MyBatis—动态SQL" class="headerlink" title="五、MyBatis—动态SQL"></a>五、MyBatis—动态SQL</h3><p>动态 SQL 是 MyBatis 的强大特性之一，极大的简化了拼接 SQL 语句的操作。</p>
<p>动态 SQL元素和使用 JSTL 或任何基于类 XML 语言的文本处理器相似。</p>
<p>MyBatis 采用功能强大的基于 OGNL 的表达式来简化操作。</p>
<ul>
<li>if：判断</li>
<li>choose (when, otherwise)：分支选择（带了break的switch-case）</li>
<li>trim (where（封装查询条件）, set（封装修改条件）)：字符串截取</li>
<li>foreach</li>
</ul>
<h4 id="1-if"><a href="#1-if" class="headerlink" title="1.if"></a>1.if</h4><ul>
<li><p>判断&amp;OGNL</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapperDynamicSQL</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//携带了哪个字段查询条件就带上这个字段的值</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByConditionIf</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapperDynamicSQL"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- if：</span></span><br><span class="line"><span class="comment">		查询员工，要求：携带了哪个字段查询条件就带上这个字段的值 </span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionIf(Employee employee); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByConditionIf"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">		select * from tbl_employee</span><br><span class="line">		where </span><br><span class="line">		<span class="comment">&lt;!-- test：判断表达式（OGNL） </span></span><br><span class="line"><span class="comment">				从参数中取值进行判断</span></span><br><span class="line"><span class="comment">				遇见特殊字符应该去写转义字符：</span></span><br><span class="line"><span class="comment">					&amp;&amp;：&amp;amp;&amp;amp;</span></span><br><span class="line"><span class="comment">					""：&amp;quot;&amp;quot;</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">			id = #&#123;id&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 相当于：test="lastName!=null and lastName!=''" --&gt;</span></span><br><span class="line">			and last_name like #&#123;lastName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">			and email = #&#123;email&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- OGNL会进行字符串与数字的转换判断："0"==0,"1"==1 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender==0 or gender==1"</span>&gt;</span></span><br><span class="line">			and gender = #&#123;gender&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span>	 </span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//测试if-where</span></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee(<span class="number">4</span>, <span class="string">"%e%"</span>, <span class="string">"jerry@atguigu.com"</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmpsByConditionIf(employee);</span><br><span class="line">        <span class="keyword">for</span> (Employee emp : emps) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/08/17/MyBatis/image-20200820110922527.png" class="">
</li>
<li><p>where——查询条件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByConditionIf"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee</span><br><span class="line">    <span class="comment">&lt;!--  						</span></span><br><span class="line"><span class="comment">        查询的时候如果某些条件没带可能sql拼装会有问题，解决方法：</span></span><br><span class="line"><span class="comment">        1.给where后面加上1=1，后面的条件都用 and xxx</span></span><br><span class="line"><span class="comment">        2.使用where标签将所有的查询条件包括在内，MyBatis就会将where标签中拼接的sql语句中多出来的and或or去掉</span></span><br><span class="line"><span class="comment">            where标签只会去掉第一个多出来的and或or，所以要注意书写规范</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- where 1=1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- test：判断表达式（OGNL） </span></span><br><span class="line"><span class="comment">                从参数中取值进行判断</span></span><br><span class="line"><span class="comment">                遇见特殊字符应该去写转义字符：</span></span><br><span class="line"><span class="comment">                    &amp;&amp;：&amp;amp;&amp;amp;</span></span><br><span class="line"><span class="comment">                    ""：&amp;quot;&amp;quot;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 相当于：test="lastName!=null and lastName!=''" --&gt;</span></span><br><span class="line">            and last_name like #&#123;lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">            and email = #&#123;email&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- OGNL会进行字符串与数字的转换判断："0"==0,"1"==1 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender==0 or gender==1"</span>&gt;</span></span><br><span class="line">            and gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span>		 </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">"jerry@atguigu.com"</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmpsByConditionIf(employee);</span><br><span class="line">        <span class="keyword">for</span> (Employee emp : emps) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>set与if结合的动态更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateEmp</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public void updateEmp(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateEmp"</span>&gt;</span></span><br><span class="line">    update tbl_employee </span><br><span class="line">    <span class="comment">&lt;!-- set标签的使用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"lastName!=null"</span>&gt;</span></span><br><span class="line">            last_name = #&#123;lastName&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null"</span>&gt;</span></span><br><span class="line">            email = #&#123;email&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender!=null"</span>&gt;</span></span><br><span class="line">            gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- trim更新拼串： --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- &lt;trim prefix="set" suffixOverrides=","&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="lastName!=null"&gt;</span></span><br><span class="line"><span class="comment">            last_name = #&#123;lastName&#125;,</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="email!=null"&gt;</span></span><br><span class="line"><span class="comment">            email = #&#123;email&#125;,</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="gender!=null"&gt;</span></span><br><span class="line"><span class="comment">            gender = #&#123;gender&#125;</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">    &lt;/trim&gt; --&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql04</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//测试set标签</span></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee(<span class="number">1</span>, <span class="string">"admin"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        mapper.updateEmp(employee);</span><br><span class="line">        openSession.commit();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: update tbl_employee set last_name = ? where id = ?  </span><br><span class="line">Parameters: admin(String), <span class="number">1</span>(Integer)  </span><br><span class="line">Updates: <span class="number">1</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-trim"><a href="#2-trim" class="headerlink" title="2.trim"></a>2.trim</h4><ul>
<li><p>自定义字符串截取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByConditionTrim</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionTrim(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByConditionTrim"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee</span><br><span class="line">    <span class="comment">&lt;!-- 后面多出的and或or，where标签不能解决 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义字符串的截取规则 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- trim: trim标签体中是整个字符串拼串后的结果</span></span><br><span class="line"><span class="comment">            prefix：前缀。给拼串后的整个整个字符串加一个前缀</span></span><br><span class="line"><span class="comment">            prefixOverrides：前缀覆盖。去掉整个字符串前面多余的字符</span></span><br><span class="line"><span class="comment">            suffix：后缀。给拼串后的整个整个字符串加一个后缀</span></span><br><span class="line"><span class="comment">            suffixOverrides：后缀覆盖。去掉整个字符串后面多余的字符</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">suffixOverrides</span>=<span class="string">"and"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">            id = #&#123;id&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">            last_name like #&#123;lastName&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>"</span>&gt;</span></span><br><span class="line">            email = #&#123;email&#125; and </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender==0 or gender==1"</span>&gt;</span></span><br><span class="line">            gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql02</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//测试trim</span></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">"jerry@atguigu.com"</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmpsByConditionTrim(employee);</span><br><span class="line">        <span class="keyword">for</span> (Employee emp : emps) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where email = ? </span><br><span class="line">Parameters: jerry<span class="meta">@atguigu</span>.com(String)</span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=tom, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-choose"><a href="#3-choose" class="headerlink" title="3.choose"></a>3.choose</h4><ul>
<li><p>分支选择</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByConditionChoose</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionChoose(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByConditionChoose"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果带来id就用id查，如果带了lastName就用lastName查，只会进入其中一个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">                id = #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"lastName!=null"</span>&gt;</span></span><br><span class="line">                last_name like #&#123;lastName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"email!=null"</span>&gt;</span></span><br><span class="line">                email like #&#123;email&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                gender = 0</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql03</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//测试choose</span></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="string">"%e%"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmpsByConditionChoose(employee);</span><br><span class="line">        <span class="keyword">for</span> (Employee emp : emps) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee WHERE last_name like ?  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">Parameters: %e%(String)  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-foreach"><a href="#4-foreach" class="headerlink" title="4.foreach"></a>4.foreach</h4><ul>
<li><p>遍历集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByConditionForeach</span><span class="params">(@Param(<span class="string">"ids"</span>)</span>List&lt;Integer&gt; ids)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionForeach(@Param("ids")List&lt;Integer&gt; ids); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByConditionForeach"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tbl_employee </span><br><span class="line">    <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">        collection：指定要遍历的集合</span></span><br><span class="line"><span class="comment">        item：将当前遍历出的元素赋值给指定的变量</span></span><br><span class="line"><span class="comment">        separator：每个元素之间的分隔符</span></span><br><span class="line"><span class="comment">        open：遍历出所有结果拼接一个开始的字符</span></span><br><span class="line"><span class="comment">        close：遍历出所有结果拼接一个结束的字符</span></span><br><span class="line"><span class="comment">        index：索引。遍历list的时候index是索引，item是当前值；</span></span><br><span class="line"><span class="comment">                    遍历map的时候index表示的是map的key，item是map的value</span></span><br><span class="line"><span class="comment">        #&#123;变量名&#125;就能取出变量的值也就是当前遍历出的元素</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"item_id"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">open</span>=<span class="string">"where id in("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;item_id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicSql05</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//测试foreach</span></span><br><span class="line">        List&lt;Employee&gt; list = mapper.getEmpsByConditionForeach(Arrays.asList(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">for</span> (Employee emp : list) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MySQL下foreach批量插入的两种方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmps</span><span class="params">(@Param(<span class="string">"emps"</span>)</span>List&lt;Employee&gt; employees)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 批量保存 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public void addEmps(@Param("emps")List&lt;Employee&gt; employees); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.MySQL下批量保存：可以foreach遍历   MySQL支持values(),(),()语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmps"</span>&gt;</span></span><br><span class="line">    insert into tbl_employee(last_name,email,gender,d_id)</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"emps"</span> <span class="attr">item</span>=<span class="string">"emp"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        (#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2.这种方式需要数据库连接属性allowMultiQueries=true --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;insert id="addEmps"&gt;</span></span><br><span class="line"><span class="comment">    &lt;foreach collection="emps" item="emp" separator=";"&gt;</span></span><br><span class="line"><span class="comment">        insert into tbl_employee(last_name,email,gender,d_id)</span></span><br><span class="line"><span class="comment">        values(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)	</span></span><br><span class="line"><span class="comment">    &lt;/foreach&gt;</span></span><br><span class="line"><span class="comment">&lt;/insert&gt; --&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改“dbconfig.properties”中的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?allowMultiQueries&#x3D;true</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchSave</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        List&lt;Employee&gt; emps = <span class="keyword">new</span> ArrayList&lt;Employee&gt;();</span><br><span class="line">        emps.add(<span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="string">"smith"</span>, <span class="string">"smith@atguigu.com"</span>, <span class="string">"1"</span>, <span class="keyword">new</span> Department(<span class="number">1</span>)));</span><br><span class="line">        emps.add(<span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="string">"allen"</span>, <span class="string">"allen@atguigu.com"</span>, <span class="string">"0"</span>, <span class="keyword">new</span> Department(<span class="number">2</span>)));</span><br><span class="line">        mapper.addEmps(emps);</span><br><span class="line">        openSession.commit();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: <span class="function">insert into <span class="title">tbl_employee</span><span class="params">(last_name,email,gender,d_id)</span> <span class="title">values</span><span class="params">(?,?,?,?)</span> </span>; <span class="function">insert into <span class="title">tbl_employee</span><span class="params">(last_name,email,gender,d_id)</span> <span class="title">values</span><span class="params">(?,?,?,?)</span> </span></span><br><span class="line"><span class="function">Parameters: <span class="title">smith</span><span class="params">(String)</span>, smith@atguigu.<span class="title">com</span><span class="params">(String)</span>, 1<span class="params">(String)</span>, 1<span class="params">(Integer)</span>, <span class="title">allen</span><span class="params">(String)</span>, allen@atguigu.<span class="title">com</span><span class="params">(String)</span>, 0<span class="params">(String)</span>, 2<span class="params">(Integer)</span> </span></span><br><span class="line"><span class="function">Updates: 2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Oracle下批量插入的两种方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Oracle数据库批量保存：（Oracle不支持values(),(),()） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Oracle支持的批量方式</span></span><br><span class="line"><span class="comment">        1、多个insert放在begin - end里面</span></span><br><span class="line"><span class="comment">        begin</span></span><br><span class="line"><span class="comment">            insert into employees(employee_id,last_name,email) </span></span><br><span class="line"><span class="comment">            values(employees_seq.nextval,'test_001','test_001@atguigu.com');</span></span><br><span class="line"><span class="comment">            insert into employees(employee_id,last_name,email) </span></span><br><span class="line"><span class="comment">            values(employees_seq.nextval,'test_002','test_002@atguigu.com');</span></span><br><span class="line"><span class="comment">        end;</span></span><br><span class="line"><span class="comment">        2、利用中间表：</span></span><br><span class="line"><span class="comment">        insert into employees(employee_id,last_name,email)</span></span><br><span class="line"><span class="comment">           select employees_seq.nextval,lastName,email from(</span></span><br><span class="line"><span class="comment">                  select 'test_a_01' lastName,'test_a_e01' email from dual</span></span><br><span class="line"><span class="comment">                  union</span></span><br><span class="line"><span class="comment">                  select 'test_a_02' lastName,'test_a_e02' email from dual</span></span><br><span class="line"><span class="comment">                  union</span></span><br><span class="line"><span class="comment">                  select 'test_a_03' lastName,'test_a_e03' email from dual</span></span><br><span class="line"><span class="comment">           )	</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmps"</span> <span class="attr">databaseId</span>=<span class="string">"oracle"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- oracle第一种批量方式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;foreach collection="emps" item="emp" open="begin" close="end;"&gt;</span></span><br><span class="line"><span class="comment">        insert into employees(employee_id,last_name,email) </span></span><br><span class="line"><span class="comment">            values(employees_seq.nextval,#&#123;emp.lastName&#125;,#&#123;emp.email&#125;);</span></span><br><span class="line"><span class="comment">    &lt;/foreach&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- oracle第二种批量方式  --&gt;</span></span><br><span class="line">    insert into employees(employee_id,last_name,email)</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"emps"</span> <span class="attr">item</span>=<span class="string">"emp"</span> <span class="attr">separator</span>=<span class="string">"union"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">open</span>=<span class="string">"select employees_seq.nextval,lastName,email from("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">            select #&#123;emp.lastName&#125; lastName,#&#123;emp.email&#125; email from dual</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="5-内置参数"><a href="#5-内置参数" class="headerlink" title="5.内置参数"></a>5.内置参数</h4><ul>
<li><p>parameter&amp;databaseId</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsTestInnerParameter</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 两个内置参数： </span></span><br><span class="line"><span class="comment">    不只是方法传递过来的参数可以被用来判断、取值...mybatis默认还有两个内置参数：</span></span><br><span class="line"><span class="comment">    _parameter：代表整个参数</span></span><br><span class="line"><span class="comment">        单个参数：_parameter代表这个参数</span></span><br><span class="line"><span class="comment">        多个参数：参数会被封装为一个map，_parameter代表这个map</span></span><br><span class="line"><span class="comment">    _databaseId：如果配置了databaseIdProvider标签，_databaseId代表当前数据库的别名</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee); --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsTestInnerParameter"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='mysql'"</span>&gt;</span></span><br><span class="line">        select * from tbl_employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_parameter!=null"</span>&gt;</span></span><br><span class="line">            where last_name = #&#123;_parameter.lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='oracle'"</span>&gt;</span></span><br><span class="line">        select * from employees</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_parameter!=null"</span>&gt;</span></span><br><span class="line">            where last_name = #&#123;_parameter.lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInnerParam</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        List&lt;Employee&gt; list = mapper.getEmpsTestInnerParameter(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : list) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee </span><br><span class="line">Parameters:  </span><br><span class="line">Total: <span class="number">11</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">5</span>, lastname=tom, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">6</span>, lastname=frank, email=frank<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">7</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">8</span>, lastname=allen, email=allen<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">9</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">10</span>, lastname=allen, email=allen<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">11</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">12</span>, lastname=allen, email=allen<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>bind——绑定</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee); --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsTestInnerParameter"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bind：可以将OGNL表达式的值绑定到一个变量中，方便后面引用这个变量的值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"_lastName"</span> <span class="attr">value</span>=<span class="string">"'_'+lastName+'%'"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='mysql'"</span>&gt;</span></span><br><span class="line">        select * from tbl_employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_parameter!=null"</span>&gt;</span></span><br><span class="line">            where last_name like #&#123;_lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='oracle'"</span>&gt;</span></span><br><span class="line">        select * from employees</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_parameter!=null"</span>&gt;</span></span><br><span class="line">            where last_name like #&#123;_lastName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInnerParam</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">        <span class="comment">//测试bind</span></span><br><span class="line">        emp.setLastname(<span class="string">"e"</span>);</span><br><span class="line">        List&lt;Employee&gt; list = mapper.getEmpsTestInnerParameter(emp);</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : list) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where last_name like ? </span><br><span class="line">Parameters: _e%(String)  </span><br><span class="line">Total: <span class="number">2</span> </span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">Employee [id=<span class="number">4</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-sql"><a href="#6-sql" class="headerlink" title="6.sql"></a>6.sql</h4><ul>
<li><p>抽取可重用的sql片段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 抽取可重用的sql片段，方便后面引用 </span></span><br><span class="line"><span class="comment">        1.sql抽取：经常将要查询的列名或者插入用的列名抽取出来方便引用</span></span><br><span class="line"><span class="comment">        2.include引用已经抽取的sql</span></span><br><span class="line"><span class="comment">        3.include还可以自定义一些property，sql标签内部就能使用自定义的属性</span></span><br><span class="line"><span class="comment">            include-property取值的正确方式：$&#123;prop&#125;</span></span><br><span class="line"><span class="comment">            不能使用：#&#123; &#125;</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"insertColumn"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='mysql'"</span>&gt;</span></span><br><span class="line">        last_name,email,gender,d_id	 	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId=='oracle'"</span>&gt;</span></span><br><span class="line">        employee_id,last_name,email</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmps"</span>&gt;</span></span><br><span class="line">    insert into tbl_employee(</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"insertColumn"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"emps"</span> <span class="attr">item</span>=<span class="string">"emp"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        (#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="六、MyBatis—缓存机制"><a href="#六、MyBatis—缓存机制" class="headerlink" title="六、MyBatis—缓存机制"></a>六、MyBatis—缓存机制</h3><p>MyBatis包含一个非常强大的查询缓存特性，它可以非常方便地配置和定制，缓存可以极大的提升查询效率。</p>
<p>MyBatis系统中默认定义了两级缓存。</p>
<p>一级缓存和二级缓存：</p>
<ul>
<li><p>默认情况下，只有一级缓存（SqlSession级别的缓存，也称为本地缓存）开启</p>
</li>
<li><p>二级缓存需要手动开启和配置，它是基于namespace级别的缓存</p>
</li>
<li><p>为了提高扩展性，MyBatis定义了缓存接口Cache，可以通过实现Cache接口来自定义二级缓存</p>
</li>
</ul>
<h4 id="1-一级缓存"><a href="#1-一级缓存" class="headerlink" title="1.一级缓存"></a>1.一级缓存</h4><p>一级缓存（local cache），即本地缓存，<span style='color:blue;'>作用域默认为SqlSession</span>。当Session flush或close后，该Session中的所有cache将被清空。</p>
<p><span style='color:red;'>本地缓存不能被关闭，但是可以调用clearCache()来清空本地缓存，或者改变缓存的作用域。</span></p>
<p>在mybatis3.1之后，可以配置本地缓存的作用域。在mybatis.xml中配置</p>
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>localCacheScope</td>
<td>MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</td>
<td>SESSION | STATEMENT</td>
<td>SESSION</td>
</tr>
</tbody></table>
<ul>
<li><p>一级缓存演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line"></span><br><span class="line">        Employee emp02 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp01 == emp02);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ?  </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)</span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line"><span class="keyword">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>一级缓存失效的四种情况</p>
<p>①不同的SqlSession对应不同的一级缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession openSession2 = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line"></span><br><span class="line">        EmployeeMapper mapper2 = openSession2.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp02 = mapper2.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp01 == emp02);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">        openSession2.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Preparing: select * from tbl_employee where id = ?  </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>②同一个SqlSession但是查询条件不同（当前一级缓存中还没有这个数据）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line"></span><br><span class="line">        Employee emp02 = mapper.getEmpById(<span class="number">3</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp01 == emp02);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Preparing: select * from tbl_employee where id = ?   </span><br><span class="line">Parameters: <span class="number">3</span>(Integer)  </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">3</span>, lastname=jerry, email=jerry<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>③同一个SqlSession两次查询期间执行了任何一次增删改操作（这次增删改可能对当前数据有影响）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line"></span><br><span class="line">        mapper.addEmp(<span class="keyword">new</span> Employee(<span class="keyword">null</span>, <span class="string">"testCache"</span>, <span class="string">"cache@atguigu.com"</span>, <span class="string">"1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"数据添加成功"</span>);</span><br><span class="line"></span><br><span class="line">        Employee emp02 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp01 == emp02);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  </span><br><span class="line">Total: <span class="number">1</span>  </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Preparing: <span class="function">insert into <span class="title">tbl_employee</span><span class="params">(last_name,email,gender)</span> <span class="title">values</span><span class="params">(?,?,?)</span> </span></span><br><span class="line"><span class="function">Parameters: <span class="title">testCache</span><span class="params">(String)</span>, cache@atguigu.<span class="title">com</span><span class="params">(String)</span>, 1<span class="params">(String)</span>  </span></span><br><span class="line"><span class="function">Updates: 1  </span></span><br><span class="line"><span class="function">数据添加成功</span></span><br><span class="line"><span class="function">Preparing: select * from tbl_employee where id </span>= ?  </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)   </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>④同一个SqlSession两次查询期间手动清空了缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line"></span><br><span class="line">        openSession.clearCache();</span><br><span class="line"></span><br><span class="line">        Employee emp02 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp01 == emp02);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select * from tbl_employee where id = ?  </span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  </span><br><span class="line">Total: <span class="number">1</span>  </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Preparing: select * from tbl_employee where id = ? </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Total: <span class="number">1</span> </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-二级缓存"><a href="#2-二级缓存" class="headerlink" title="2.二级缓存"></a>2.二级缓存</h4><p>二级缓存（second level cache），全局作用域缓存</p>
<p>二级缓存默认不开启，需要手动配置</p>
<p>MyBatis提供二级缓存的接口以及实现，缓存实现要求POJO实现Serializable接口</p>
<p><span style='color:red;'>二级缓存在SqlSession关闭或提交之后才会生效</span></p>
<ul>
<li><p>二级缓存的使用&amp;细节</p>
<p>①开启全局二级缓存配置：在“mybatis-config.xml”的“settings”标签中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>②去mapper.xml中配置使用二级缓存</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">"FIFO"</span> <span class="attr">flushInterval</span>=<span class="string">"6000"</span> <span class="attr">readOnly</span>=<span class="string">"false"</span> <span class="attr">size</span>=<span class="string">"1024"</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- cache: </span></span><br><span class="line"><span class="comment">        eviction：缓存的回收策略，默认的是 LRU</span></span><br><span class="line"><span class="comment">            • LRU – 最近最少使用的：移除最长时间不被使用的对象。</span></span><br><span class="line"><span class="comment">            • FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</span></span><br><span class="line"><span class="comment">            • SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</span></span><br><span class="line"><span class="comment">            • WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</span></span><br><span class="line"><span class="comment">        flushInterval：缓存刷新间隔</span></span><br><span class="line"><span class="comment">            缓存多长时间清空一次，默认不清空，设置一个毫秒值</span></span><br><span class="line"><span class="comment">        readOnly：是否只读</span></span><br><span class="line"><span class="comment">            true：只读。mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据</span></span><br><span class="line"><span class="comment">                        mybatis为了加快获取速度，就会直接将数据在缓存中的引用交给用户。不安全，速度快</span></span><br><span class="line"><span class="comment">            false：非只读。mybatis觉得获取的数据可能会被修改，</span></span><br><span class="line"><span class="comment">                        会利用序列化&amp;反序列化的技术克隆一份新的数据给用户。安全，速度慢</span></span><br><span class="line"><span class="comment">        size：缓存存放多少个元素</span></span><br><span class="line"><span class="comment">        type：指定自定义缓存的全类名</span></span><br><span class="line"><span class="comment">                实现Cache接口即可</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p>③POJO需要实现序列化接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSecondLevelCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession openSession2 = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        EmployeeMapper mapper2 = openSession2.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        Employee emp01 = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp01);</span><br><span class="line">        openSession.close();</span><br><span class="line"></span><br><span class="line">        Employee emp02 = mapper2.getEmpById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp02);</span><br><span class="line">        openSession2.close();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cache Hit Ratio [com.atguigu.mybatis.dao.EmployeeMapper]: <span class="number">0.0</span>  </span><br><span class="line">Preparing: select * from tbl_employee where id = ?  </span><br><span class="line">Parameters: <span class="number">1</span>(Integer) </span><br><span class="line">Total: <span class="number">1</span>  </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Cache Hit Ratio [com.atguigu.mybatis.dao.EmployeeMapper]: <span class="number">0.5</span>  </span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">两级缓存： </span><br><span class="line">一级缓存（本地缓存）： SqlSession级别的缓存。一级缓存是一直开启的</span><br><span class="line">与数据库同一次会话期间查询到的数据会放在本地缓存中，以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库</span><br><span class="line"></span><br><span class="line">	一级缓存失效情况（没有使用到当前一级缓存的情况，效果就是，还需要再向数据库发出查询）：</span><br><span class="line"> 		1、sqlSession不同。</span><br><span class="line"> 		2、sqlSession相同，查询条件不同.(当前一级缓存中还没有这个数据)</span><br><span class="line"> 		3、sqlSession相同，两次查询之间执行了增删改操作(这次增删改可能对当前数据有影响)</span><br><span class="line"> 		4、sqlSession相同，手动清除了一级缓存（缓存清空）</span><br><span class="line"> </span><br><span class="line">二级缓存（全局缓存）：基于namespace级别的缓存：一个namespace对应一个二级缓存：</span><br><span class="line">		工作机制：</span><br><span class="line">		1、一个会话，查询一条数据，这个数据就会被放在当前会话的一级缓存中；</span><br><span class="line"> 		2、如果会话关闭；一级缓存中的数据会被保存到二级缓存中；新的会话查询信息，就可以参照二级缓存中的内容；</span><br><span class="line"> 		3、sqlSession&#x3D;&#x3D;&gt;EmployeeMapper&#x3D;&#x3D;&gt;Employee</span><br><span class="line"> 						DepartmentMapper&#x3D;&#x3D;&#x3D;&gt;Department</span><br><span class="line"> 			不同namespace查出的数据会放在自己对应的缓存中（map）</span><br><span class="line"> 			效果：数据会从二级缓存中获取</span><br><span class="line"> 			查出的数据都会被默认先放在一级缓存中，只有会话提交或者关闭以后，一级缓存中的数据才会转移到二级缓存中</span><br><span class="line"> 		使用：</span><br><span class="line"> 			1）开启全局二级缓存配置：&lt;setting name&#x3D;&quot;cacheEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line"> 			2）去mapper.xml中配置使用二级缓存：&lt;cache&gt;&lt;&#x2F;cache&gt;</span><br><span class="line">			3）我们的POJO需要实现序列化接口</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-缓存有关的设置以及属性"><a href="#3-缓存有关的设置以及属性" class="headerlink" title="3.缓存有关的设置以及属性"></a>3.缓存有关的设置以及属性</h4><ul>
<li><p>cacheEnabled</p>
<p>true：默认</p>
<p>false：关闭缓存（二级缓存关闭，一级缓存一直可用的）</p>
</li>
<li><p>select标签：useCache</p>
<p>true：开启。默认</p>
<p>false：不使用缓存（一级缓存依然使用，二级缓存不使用）</p>
</li>
<li><p>增删改标签的：flushCache  ★</p>
<p>true：增删改执行完成后就会清楚缓存一级二级都会清除（默认）</p>
<p>测试：flushCache=”true”：一级缓存就清空了；二级也会被清除；</p>
<p>查询标签的：flushCache=”false”：默认</p>
<p>如果查询标签中flushCache=true，则每次查询之后都会清空缓存，缓存是没有被使用的</p>
</li>
<li><p>sqlSession.clearCache();只是清空当前session的一级缓存；</p>
</li>
<li><p>localCacheScope：本地缓存作用域：</p>
<p>SESSION：一级缓存（默认），当前会话的所有数据保存在会话缓存中；</p>
<p>STATEMENT：可以禁用一级缓存；</p>
</li>
</ul>
<h4 id="4-缓存原理图示"><a href="#4-缓存原理图示" class="headerlink" title="4.缓存原理图示"></a>4.缓存原理图示</h4><img src="/2020/08/17/MyBatis/image-20200820192313994.png" class="">

<h4 id="5-第三方缓存整合"><a href="#5-第三方缓存整合" class="headerlink" title="5.第三方缓存整合"></a>5.第三方缓存整合</h4><ul>
<li><p>EnCache是一个纯Java的进程内缓存框架，具有快速、精干等特点，是Hibernate中默认的CacheProvider</p>
</li>
<li><p>MyBatis定义了Cache接口方便进行自定义扩展</p>
</li>
<li><p>步骤：</p>
<p>①导入ehcache包、整合包、日志包</p>
<img src="/2020/08/17/MyBatis/image-20200820201805518.png" class="">

<p>②编写ehcache.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ehcache.org/ehcache.xsd"</span>&gt;</span><span class="comment">&lt;!-- 这里做了修改 --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 磁盘保存路径 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"D:\MyBatis\ehcache"</span> /&gt;</span><span class="comment">&lt;!-- 自己选择 --&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">defaultCache</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsOnDisk</span>=<span class="string">"10000000"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">eternal</span>=<span class="string">"false"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">overflowToDisk</span>=<span class="string">"true"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">属性说明：</span></span><br><span class="line"><span class="comment">l diskStore：指定数据在磁盘中的存储位置。</span></span><br><span class="line"><span class="comment">l defaultCache：当借助CacheManager.add("demoCache")创建Cache时，EhCache便会采用&lt;defalutCache/&gt;指定的的管理策略</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下属性是必须的：</span></span><br><span class="line"><span class="comment">l maxElementsInMemory - 在内存中缓存的element的最大数目 </span></span><br><span class="line"><span class="comment">l maxElementsOnDisk - 在磁盘上缓存的element的最大数目，若是0表示无穷大</span></span><br><span class="line"><span class="comment">l eternal - 设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断</span></span><br><span class="line"><span class="comment">l overflowToDisk - 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下属性是可选的：</span></span><br><span class="line"><span class="comment">l timeToIdleSeconds - 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时，这些数据便会删除，默认值是0,也就是可闲置时间无穷大</span></span><br><span class="line"><span class="comment">l timeToLiveSeconds - 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</span></span><br><span class="line"><span class="comment"> diskSpoolBufferSizeMB 这个参数设置DiskStore(磁盘缓存)的缓存区大小.默认是30MB.每个Cache都应该有自己的一个缓冲区.</span></span><br><span class="line"><span class="comment">l diskPersistent - 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false。</span></span><br><span class="line"><span class="comment">l diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s，相应的线程会进行一次EhCache中数据的清理工作</span></span><br><span class="line"><span class="comment">l memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出）</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure>

<p>③在mapper.xml中配置cache标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"org.mybatis.caches.ehcache.EhcacheCache"</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="七、MyBatis—Spring整合"><a href="#七、MyBatis—Spring整合" class="headerlink" title="七、MyBatis—Spring整合"></a>七、MyBatis—Spring整合</h3><ul>
<li><p>导包</p>
<img src="/2020/08/17/MyBatis/image-20200821160350698.png" class="">
</li>
<li><p>整合关键配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmps</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.dao.EmployeeMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmps</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">		<span class="comment">//EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);</span></span><br><span class="line">		<span class="keyword">return</span> employeeMapper.getEmps();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.service.EmployeeService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	EmployeeService employeeService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/getemps"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">emps</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">		List&lt;Employee&gt; emps = employeeService.getEmps();</span><br><span class="line">		map.put(<span class="string">"allEmps"</span>, emps);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"list"</span>; </span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EmployeeMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.atguigu.mybatis.dao.EmployeeMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public Employee getEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">		select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public List&lt;Employee&gt; getEmps(); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmps"</span> <span class="attr">resultType</span>=<span class="string">"com.atguigu.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">		select * from tbl_employee</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mybatis-spring</span>=<span class="string">"http://mybatis.org/schema/mybatis-spring"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring-1.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Spring希望管理所有的业务逻辑组件等 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.mybatis"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 引入数据库的配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Spring用来控制业务逻辑：数据源、事务控制、aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceTransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启基于注解的事务 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"dataSourceTransactionManager"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 整合mybatis </span></span><br><span class="line"><span class="comment">		目的：1.spring管理所有组件，mapper的实现类</span></span><br><span class="line"><span class="comment">				service==&gt;Dao	@Autowired：自动注入mapper</span></span><br><span class="line"><span class="comment">			2.spring用来管理事务，spring声明式事务</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 创建出SqlSessionFactory对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactoryBean"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- configLocation指定配置文件的位置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- mapperLocations：指定mapper文件的位置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/mapper/*.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSession"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionTemplate"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactoryBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"executorType"</span> <span class="attr">value</span>=<span class="string">"BATCH"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 扫描所有的mapper接口的实现，让这些mapper能够自动注入 </span></span><br><span class="line"><span class="comment">			base-package：指定mapper接口的包名</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mybatis-spring:scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.mybatis.dao"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name="basePackage" value="com.atguigu.mybatis.dao"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- SpringMVC只是控制网站跳转逻辑 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 只扫描控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.mybatis"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>MyBatis_06_ssm<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!--Spring配置： needed for ContextLoaderListener --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Bootstraps the root web application context before servlet initialization --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- SpringMVC配置 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>list.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset="</span>UTF-<span class="number">8</span><span class="string">"&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;员工列表&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">	&lt;table&gt;</span></span><br><span class="line"><span class="string">			&lt;tr&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;id&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;lastName&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;email&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;gender&lt;/td&gt;</span></span><br><span class="line"><span class="string">			&lt;/tr&gt;</span></span><br><span class="line"><span class="string">		&lt;c:forEach items="</span>$&#123;allEmps &#125;<span class="string">" var="</span>emp<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;tr&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;$&#123;emp.id &#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;$&#123;emp.lastName &#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;$&#123;emp.email &#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">				&lt;td&gt;$&#123;emp.gender &#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">			&lt;/tr&gt;</span></span><br><span class="line"><span class="string">		&lt;/c:forEach&gt;</span></span><br><span class="line"><span class="string">	&lt;/table&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href="getemps"&gt;查询所有员工&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="八、MyBatis—逆向工程"><a href="#八、MyBatis—逆向工程" class="headerlink" title="八、MyBatis—逆向工程"></a>八、MyBatis—逆向工程</h3><h4 id="1-MyBatis-Generator"><a href="#1-MyBatis-Generator" class="headerlink" title="1.MyBatis Generator"></a>1.MyBatis Generator</h4><p>简称MBG，是一个专门为MyBatis框架使用者定制的代码生成器，可以快速的根据表生成对应的映射文件、接口以及bean类。支持基本的增删改查和QBC风格的条件查询。但是表连接、存储过程等这些复杂sql的定义需要手工编写。</p>
<p>官方文档地址：<a href="http://mybatis.org/generator/" target="_blank" rel="noopener">http://mybatis.org/generator/</a></p>
<p>官方工程地址：<a href="https://github.com/mybatis/generator/releases" target="_blank" rel="noopener">https://github.com/mybatis/generator/releases</a></p>
<h4 id="2-MBG的使用"><a href="#2-MBG的使用" class="headerlink" title="2.MBG的使用"></a>2.MBG的使用</h4><p>使用步骤：</p>
<ul>
<li><p>编写MBG的配置文件（几处重要的配置说明）</p>
<p>①jdbcConnection：配置数据库连接信息</p>
<p>②javaModelGenerator：配置javaBean的生成策略</p>
<p>③sqlMapGenerator：配置sql映射文件的生成策略</p>
<p>④javaClientGenerator：配置Mapper接口的生成策略</p>
<p>⑤table：配置要逆向解析的数据表</p>
</li>
<li><p>运行代码生成器生成代码</p>
</li>
<li><p>注意：</p>
<p>context标签：</p>
<p>targetRuntime=”MyBatis3Simple”：可以生成带条件的增删改查<br>targetRuntime=”MyBatis3”：可以生成基本的增删改查。如果再次生成，建议将之前生成的数据删除，避免xml向后追加内容出现问题</p>
</li>
<li><p>代码演示：</p>
<p>mbg.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">		targetRuntime="MyBatis3Simple"：生成简单版的CRUD</span></span><br><span class="line"><span class="comment">		targetRuntime="MyBatis3"：豪华版</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"DB2Tables"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- jdbcConnection：指定如何连接到目标数据库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?allowMultiQueries=true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">userId</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">password</span>=<span class="string">"0530"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaModelGenerator：指定javaBean的生成策略 </span></span><br><span class="line"><span class="comment">			targetPackage：目标包名</span></span><br><span class="line"><span class="comment">			targetProject：目标工程</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.atguigu.mybatis.bean"</span> <span class="attr">targetProject</span>=<span class="string">".\src"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- sqlMapGenerator：sql映射生成策略 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.atguigu.mybatis.dao"</span>  <span class="attr">targetProject</span>=<span class="string">".\conf"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaClientGenerator：指定mapper接口所在的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span> <span class="attr">targetPackage</span>=<span class="string">"com.atguigu.mybatis.dao"</span>  <span class="attr">targetProject</span>=<span class="string">".\src"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 指定要逆向分析哪些表，根据表要创建javaBean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"tbl_dept"</span> <span class="attr">domainObjectName</span>=<span class="string">"Department"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"tbl_employee"</span> <span class="attr">domainObjectName</span>=<span class="string">"Employee"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.EmployeeExample;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.EmployeeExample.Criteria;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.dao.EmployeeMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.atguigu.mybatis.bean.Employee;</span></span><br><span class="line"><span class="comment">//import com.atguigu.mybatis.dao.EmployeeMapper;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 提取方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">		InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//生成器代码</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMbg</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">		File configFile = <span class="keyword">new</span> File(<span class="string">"mbg.xml"</span>);</span><br><span class="line">		ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">		Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">		DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">		MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">		myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyBatis3Simple</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			List&lt;Employee&gt; list = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">			<span class="keyword">for</span> (Employee employee : list) &#123;</span><br><span class="line">				System.out.print(employee.getId() + <span class="string">" "</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyBatis3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			<span class="comment">//1.查询所有</span></span><br><span class="line">			<span class="comment">//xxxExample是封装查询条件的</span></span><br><span class="line">			List&lt;Employee&gt; list = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">			<span class="keyword">for</span> (Employee employee : list) &#123;</span><br><span class="line">				System.out.print(employee.getId() + <span class="string">" "</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println();</span><br><span class="line">			<span class="comment">//2.查询员工名字中有e字母的和员工性别是1的</span></span><br><span class="line">			<span class="comment">//封装员工查询条件的example</span></span><br><span class="line">			EmployeeExample example = <span class="keyword">new</span> EmployeeExample();</span><br><span class="line">			<span class="comment">//创建一个Criteria，拼装查询条件</span></span><br><span class="line">			Criteria criteria = example.createCriteria();</span><br><span class="line">			criteria.andLastNameLike(<span class="string">"%e%"</span>);</span><br><span class="line">			criteria.andGenderEqualTo(<span class="string">"1"</span>);</span><br><span class="line">			<span class="comment">//select id, last_name, gender, email, d_id from tbl_employee WHERE ( last_name like ? and gender = ? )</span></span><br><span class="line">			</span><br><span class="line">			Criteria criteria2 = example.createCriteria();</span><br><span class="line">			criteria2.andEmailLike(<span class="string">"%e%"</span>);</span><br><span class="line">			</span><br><span class="line">			example.or(criteria2);</span><br><span class="line">			</span><br><span class="line">			List&lt;Employee&gt; list2 = mapper.selectByExample(example);</span><br><span class="line">			<span class="keyword">for</span> (Employee employee : list2) &#123;</span><br><span class="line">				System.out.print(employee.getId() + <span class="string">" "</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Preparing: select id, last_name, gender, email, d_id from tbl_employee  </span><br><span class="line">Parameters:  </span><br><span class="line">Total: <span class="number">13</span> </span><br><span class="line"><span class="number">1</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> </span><br><span class="line">Preparing: select id, last_name, gender, email, <span class="function">d_id from tbl_employee <span class="title">WHERE</span> <span class="params">( last_name like ? and gender = ? )</span> <span class="title">or</span><span class="params">( email like ? )</span> </span></span><br><span class="line"><span class="function">Parameters: %e%<span class="params">(String)</span>, 1<span class="params">(String)</span>, %e%<span class="params">(String)</span>   </span></span><br><span class="line"><span class="function">Total: 6  </span></span><br><span class="line"><span class="function">3 4 8 10 12 14</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="九、MyBatis—工作原理"><a href="#九、MyBatis—工作原理" class="headerlink" title="九、MyBatis—工作原理"></a>九、MyBatis—工作原理</h3><p> 1.获取sqlSessionFactory对象：</p>
<p>解析文件的每一个信息保存在Configuration中，返回包含Configuration的DefaultSqlSession</p>
<p>注意：【MappedStatement】：代表一个增删改查的详细信息</p>
<p> 2.获取sqlSession对象：</p>
<p>返回一个DefaultSQlSession对象，包含Executor和Configuration。这一步会创建Executor对象</p>
<p> 3.获取接口的代理对象（MapperProxy）</p>
<p>getMapper，使用MapperProxyFactory创建一个MapperProxy的代理对象，代理对象里面包含了DefaultSqlSession（Executor）</p>
<p>4.执行增删改查方法</p>
<img src="/2020/08/17/MyBatis/image-20200822153435045.png" class="">

<p> 总结：</p>
<p>1.根据配置文件（全局，sql映射）初始化出Configuration对象</p>
<p>2.创建一个DefaultSqlSession对象，其中包含Configuration以及Executor（根据全局配置文件中的defaultExecutorType创建出对应的Executor）</p>
<p>3.DefaultSqlSession.getMapper()：拿到Mapper接口对应的MapperProxy</p>
<p>4.MapperProxy里面有（DefaultSqlSession）</p>
<p>5.执行增删改查方法：</p>
<p>①调用DefaultSqlSession的增删改查（Executor）</p>
<p>②创建一个StatementHandler对象（同时也会创建出ParameterHandler和ResultSetHandler）</p>
<p>③调用StatementHandler预编译参数以及设置参数值，使用ParameterHandler来给sql设置参数</p>
<p>④调用StatementHandler的增删改查方法</p>
<p>⑤ResultSetHandler封装结果</p>
<p>注意：</p>
<p>四大对象每个创建的时候都有一个interceptorChain.pluginAll(parameterHandler);</p>
<h3 id="十、MyBatis—插件开发"><a href="#十、MyBatis—插件开发" class="headerlink" title="十、MyBatis—插件开发"></a>十、MyBatis—插件开发</h3><p>MyBatis在四大对象的创建过程中，都会有插件进行介入。插件可以利用动态代理机制一层层的包装目标对象，实现在目标对象执行目标方法之前进行拦截的效果。</p>
<p>MyBatis允许在已映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis允许使用插件来拦截的方法调用包括：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>ParameterHandler (getParameterObject, setParameters)</li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
<li>StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<h4 id="1-插件原理"><a href="#1-插件原理" class="headerlink" title="1.插件原理"></a>1.插件原理</h4><p>在四大对象创建的时候：</p>
<p>1.每个创建出来的对象不是直接返回的，而是调用interceptorChain.pluginAll(parameterHandler);</p>
<p>2.pluginAll获取到所有的Interceptor（拦截器）（插件需要实现的接口），调用interceptor.plugin(target);返回target包装后的对象</p>
<p>3.插件机制，可以使用插件为目标对象创建一个代理对象，类似于AOP机制（面向切面）。插件可以为四大对象创建出代理对象，代理对象九可以拦截到四大对象的每一个执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">pluginAll</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">      	target = interceptor.plugin(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-插件编写"><a href="#2-插件编写" class="headerlink" title="2.插件编写"></a>2.插件编写</h4><p>1.编写Interceptor的实现类</p>
<p>2.使用@Intercepts注解完成插件签名</p>
<p>3.将写好的插件注册到全局配置文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Plugin;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成插件签名，告诉MyBatis当前插件用来拦截哪个对象的哪个方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">	<span class="meta">@Signature</span>(type = StatementHandler<span class="class">.<span class="keyword">class</span>, <span class="title">method</span> </span>= <span class="string">"parameterize"</span>, args = java.sql.Statement<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * intercept：拦截</span></span><br><span class="line"><span class="comment">	 * 		拦截目标对象的目标方法的执行</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFirstPlugin...intercept:"</span> + invocation.getMethod());</span><br><span class="line">		<span class="comment">//执行目标方法</span></span><br><span class="line">		Object proceed = invocation.proceed();</span><br><span class="line">		<span class="comment">//返回执行后的返回值</span></span><br><span class="line">		<span class="keyword">return</span> proceed;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * plugin：</span></span><br><span class="line"><span class="comment">	 * 		包装目标对象（包装：为目标对象创建一个代理对象）</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFirstPlugin...plugin:mybatis将要包装的对象"</span> + target);</span><br><span class="line">		<span class="comment">//可以借助Plugin类的wrap方法来使用当前Interceptor包装目标对象</span></span><br><span class="line">		Object wrap = Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">//返回为当前target创建的动态代理</span></span><br><span class="line">		<span class="keyword">return</span> wrap;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * setProperties：</span></span><br><span class="line"><span class="comment">	 * 		将插件注册时的property属性设置进来</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"插件配置信息："</span> + properties);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在“mybatis-config.xml”中添加plugins标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- plugins：注册插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.atguigu.mybatis.dao.MyFirstPlugin"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"0530"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.mybatis.dao.EmployeeMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//提取方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">		InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">		SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">			Employee employee = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(mapper);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">插件配置信息：&#123;password=<span class="number">0530</span>, username=root&#125;</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.CachingExecutor@<span class="number">3</span>a5ecce3</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.scripting.defaults.DefaultParameterHandler@<span class="number">5</span>dcd8c7a</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.resultset.DefaultResultSetHandler@<span class="number">8</span>dbfffb</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.statement.RoutingStatementHandler<span class="meta">@f</span>316aeb</span><br><span class="line">Preparing: select id,last_name lastName,email,gender from tbl_employee where id = ? </span><br><span class="line">MyFirstPlugin...intercept:<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) <span class="keyword">throws</span> java.sql.SQLException</span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">Total: <span class="number">1</span>  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">org.apache.ibatis.binding.MapperProxy@<span class="number">48</span>c40605</span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-多个插件运行流程"><a href="#3-多个插件运行流程" class="headerlink" title="3.多个插件运行流程"></a>3.多个插件运行流程</h4><p>多个插件会产生多层代理</p>
<p>创建动态代理的时候，是按照插件配置顺序创建层次代理对象，执行目标方法之后，按照逆向顺序执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Plugin;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">	<span class="meta">@Signature</span>(type = StatementHandler<span class="class">.<span class="keyword">class</span>, <span class="title">method</span> </span>= <span class="string">"parameterize"</span>, args = java.sql.Statement<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MySecondPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MySecondPlugin...intercept"</span> + invocation.getMethod());</span><br><span class="line">		<span class="keyword">return</span> invocation.proceed();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MySecondPlugin...plugin"</span> + target);</span><br><span class="line">		<span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.atguigu.mybatis.dao.MySecondPlugin"</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">插件配置信息：&#123;password=<span class="number">0530</span>, username=root&#125;</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.CachingExecutor@<span class="number">561868</span>a0</span><br><span class="line">MySecondPlugin...pluginorg.apache.ibatis.executor.CachingExecutor@<span class="number">561868</span>a0</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.scripting.defaults.DefaultParameterHandler@<span class="number">2250</span>b9f2</span><br><span class="line">MySecondPlugin...pluginorg.apache.ibatis.scripting.defaults.DefaultParameterHandler@<span class="number">2250</span>b9f2</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.resultset.DefaultResultSetHandler<span class="meta">@f</span>316aeb</span><br><span class="line">MySecondPlugin...pluginorg.apache.ibatis.executor.resultset.DefaultResultSetHandler<span class="meta">@f</span>316aeb</span><br><span class="line">MyFirstPlugin...plugin:mybatis将要包装的对象org.apache.ibatis.executor.statement.RoutingStatementHandler@<span class="number">6</span>aa3a905</span><br><span class="line">MySecondPlugin...pluginorg.apache.ibatis.executor.statement.RoutingStatementHandler@<span class="number">6</span>aa3a905</span><br><span class="line">Preparing: select id,last_name lastName,email,gender from tbl_employee where id = ? </span><br><span class="line">MySecondPlugin...interceptpublic <span class="keyword">abstract</span> <span class="keyword">void</span> org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) <span class="keyword">throws</span> java.sql.SQLException</span><br><span class="line">MyFirstPlugin...intercept:<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) <span class="keyword">throws</span> java.sql.SQLException</span><br><span class="line">Parameters: <span class="number">1</span>(Integer)  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">Total: <span class="number">1</span>  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">org.apache.ibatis.binding.MapperProxy@<span class="number">54107f</span>42</span><br><span class="line">Employee [id=<span class="number">1</span>, lastname=admin, email=tom<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h4 id="4-开发插件"><a href="#4-开发插件" class="headerlink" title="4.开发插件"></a>4.开发插件</h4><p>对“MyFirstPlugin.java”中的intercept方法做如下修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"MyFirstPlugin...intercept:"</span> + invocation.getMethod());</span><br><span class="line">    <span class="comment">//动态改变sql运行的参数（之前是1号员工，实际从数据库查询3号员工</span></span><br><span class="line">    Object target = invocation.getTarget();</span><br><span class="line">    System.out.println(<span class="string">"当前拦截到的对象："</span> + target);</span><br><span class="line">    <span class="comment">//拿到StatementHandler==&gt;ParameterHandler==&gt;parameterObject</span></span><br><span class="line">    <span class="comment">//拿到target的元数据</span></span><br><span class="line">    MetaObject metaObject = SystemMetaObject.forObject(target);</span><br><span class="line">    Object value = metaObject.getValue(<span class="string">"parameterHandler.parameterObject"</span>);</span><br><span class="line">    System.out.println(<span class="string">"sql语句用的参数是："</span> + value);</span><br><span class="line">    <span class="comment">//修改sql语句要使用的参数</span></span><br><span class="line">    metaObject.setValue(<span class="string">"parameterHandler.parameterObject"</span>, <span class="number">11</span>);</span><br><span class="line">    <span class="comment">//执行目标方法</span></span><br><span class="line">    Object proceed = invocation.proceed();</span><br><span class="line">    <span class="comment">//返回执行后的返回值</span></span><br><span class="line">    <span class="keyword">return</span> proceed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Preparing: select id,last_name lastName,email,gender from tbl_employee where id = ?  </span><br><span class="line">MySecondPlugin...interceptpublic <span class="keyword">abstract</span> <span class="keyword">void</span> org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) <span class="keyword">throws</span> java.sql.SQLException</span><br><span class="line">MyFirstPlugin...intercept:<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> org.apache.ibatis.executor.statement.StatementHandler.parameterize(java.sql.Statement) <span class="keyword">throws</span> java.sql.SQLException</span><br><span class="line">当前拦截到的对象：org.apache.ibatis.executor.statement.RoutingStatementHandler@<span class="number">6</span>aa3a905</span><br><span class="line">sql语句用的参数是：<span class="number">1</span></span><br><span class="line">Parameters: <span class="number">11</span>(Integer)  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">Total: <span class="number">1</span>  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">org.apache.ibatis.binding.MapperProxy@<span class="number">6</span>cea706c</span><br><span class="line">Employee [id=<span class="number">11</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br></pre></td></tr></table></figure>



<h3 id="十一、扩展：MyBatis—实用场景"><a href="#十一、扩展：MyBatis—实用场景" class="headerlink" title="十一、扩展：MyBatis—实用场景"></a>十一、扩展：MyBatis—实用场景</h3><h4 id="1-PageHelper分页插件"><a href="#1-PageHelper分页插件" class="headerlink" title="1.PageHelper分页插件"></a>1.PageHelper分页插件</h4><p>PageHelper是MyBatis中非常方便的第三方分页插件</p>
<p>官方文档：<a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/README_zh.md" target="_blank" rel="noopener">https://github.com/pagehelper/Mybatis-PageHelper/blob/master/README_zh.md</a></p>
<p>使用步骤：</p>
<p>1.导入相关包<a href="https://repo1.maven.org/maven2/com/github/pagehelper/pagehelper/5.2.0/" target="_blank" rel="noopener">pagehelper-5.2.0.jar</a>和<a href="https://repo1.maven.org/maven2/com/github/jsqlparser/jsqlparser/3.2/" target="_blank" rel="noopener">jsqlparser-3.2.jar</a></p>
<p>2.在MyBatis全局配置文件中配置分页插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用下面的方式配置参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"param1"</span> <span class="attr">value</span>=<span class="string">"value1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.使用PageHelper提供的方法进行分页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//分页：Mapper接口方式的调用，推荐这种使用方式</span></span><br><span class="line">        Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmps();		</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : emps) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;			</span><br><span class="line">        System.out.println(<span class="string">"当前页码："</span> + page.getPageNum());</span><br><span class="line">        System.out.println(<span class="string">"总记录数："</span> + page.getTotal());</span><br><span class="line">        System.out.println(<span class="string">"每页的记录数："</span> + page.getPageSize());</span><br><span class="line">        System.out.println(<span class="string">"总页数"</span> + page.getPages());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cache Hit Ratio [SQL_CACHE]: <span class="number">0.0</span> </span><br><span class="line">Preparing: <span class="function">SELECT <span class="title">count</span><span class="params">(<span class="number">0</span>)</span> FROM tbl_employee  </span></span><br><span class="line"><span class="function">Parameters:   </span></span><br><span class="line"><span class="function">Total: 1 </span></span><br><span class="line"><span class="function">Preparing: select id,last_name lastName,email,gender from tbl_employee LIMIT ?, ?  </span></span><br><span class="line"><span class="function">Parameters: 8<span class="params">(Long)</span>, 2<span class="params">(Integer)</span> </span></span><br><span class="line"><span class="function">Total: 2  </span></span><br><span class="line"><span class="function">Employee [id</span>=<span class="number">10</span>, lastname=allen, email=allen<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">11</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">当前页码：<span class="number">5</span></span><br><span class="line">总记录数：<span class="number">13</span></span><br><span class="line">每页的记录数：<span class="number">2</span></span><br><span class="line">总页数<span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>4.使用更强大的PageInfo封装返回结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">        List&lt;Employee&gt; emps = mapper.getEmps();</span><br><span class="line">        <span class="comment">//用PageInfo对结果进行包装</span></span><br><span class="line">        <span class="comment">//连续显示多少页</span></span><br><span class="line">        PageInfo&lt;Employee&gt; info = <span class="keyword">new</span> PageInfo&lt;Employee&gt;(emps, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Employee employee : emps) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"当前页码："</span> + info.getPageNum());</span><br><span class="line">        System.out.println(<span class="string">"总记录数："</span> + info.getTotal());</span><br><span class="line">        System.out.println(<span class="string">"每页的记录数："</span> + info.getPageSize());</span><br><span class="line">        System.out.println(<span class="string">"总页数："</span> + info.getPages());</span><br><span class="line">        System.out.println(<span class="string">"是否是第一页："</span> + info.isIsFirstPage());</span><br><span class="line">        System.out.println(<span class="string">"连续显示的页码："</span>);</span><br><span class="line">        <span class="keyword">int</span>[] nums = info.getNavigatepageNums();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            System.out.print(nums[i] + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cache Hit Ratio [SQL_CACHE]: <span class="number">0.0</span>  </span><br><span class="line">Preparing: <span class="function">SELECT <span class="title">count</span><span class="params">(<span class="number">0</span>)</span> FROM tbl_employee </span></span><br><span class="line"><span class="function">Parameters:   </span></span><br><span class="line"><span class="function">Total: 1 </span></span><br><span class="line"><span class="function">Preparing: select id,last_name lastName,email,gender from tbl_employee LIMIT ?, ? </span></span><br><span class="line"><span class="function">Parameters: 8<span class="params">(Long)</span>, 2<span class="params">(Integer)</span> </span></span><br><span class="line"><span class="function">Total: 2  </span></span><br><span class="line"><span class="function">Employee [id</span>=<span class="number">10</span>, lastname=allen, email=allen<span class="meta">@atguigu</span>.com, gender=<span class="number">0</span>]</span><br><span class="line">Employee [id=<span class="number">11</span>, lastname=smith, email=smith<span class="meta">@atguigu</span>.com, gender=<span class="number">1</span>]</span><br><span class="line">当前页码：<span class="number">5</span></span><br><span class="line">总记录数：<span class="number">13</span></span><br><span class="line">每页的记录数：<span class="number">2</span></span><br><span class="line">总页数：<span class="number">7</span></span><br><span class="line">是否是第一页：<span class="keyword">false</span></span><br><span class="line">连续显示的页码：</span><br><span class="line"><span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span></span><br></pre></td></tr></table></figure>

<h4 id="2-批量操作"><a href="#2-批量操作" class="headerlink" title="2.批量操作"></a>2.批量操作</h4><ul>
<li><p>openSession方法的ExecutorType类型的参数，枚举类型：</p>
<p>①ExecutorType.SIMPLE：这个执行器类型不做特殊的事情（默认装配的），它为每个语句的执行创建一个新的预处理语句</p>
<p>②ExecutorType.REUSE：这个执行器类型会复用预处理语句</p>
<p>③ExecutorType.BATCH：这个执行器类型会批量执行所有更新语句</p>
</li>
<li><p>批量操作使用MyBatis提供的BatchExecutor进行的，它的底层是通过jdbc攒sql的方式进行的，可以让它攒够一定数量后发给数据库一次</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    <span class="comment">//可以执行批量操作的SqlSession</span></span><br><span class="line">    SqlSession openSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            mapper.addEmp(<span class="keyword">new</span> Employee(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>), <span class="string">"b"</span>, <span class="string">"1"</span>));		</span><br><span class="line">        &#125;</span><br><span class="line">        openSession.commit();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意</p>
<p>①批量操作是在openSession.commit()以后才发送sql语句给数据库进行执行的</p>
<p>②如果想让其提前执行，以方便后续可能的查询操作获取数据，可以使用sqlSession.flushStatements()方法，让其直接冲刷到数据库进行执行</p>
</li>
</ul>
<h4 id="3-存储过程"><a href="#3-存储过程" class="headerlink" title="3.存储过程"></a>3.存储过程</h4><p>实际开发中，通常会写一些存储过程，MyBatis也支持对存储过程的调用</p>
<ul>
<li><p>存储过程的调用：</p>
<p>①select标签中statementType=”CALLABLE”</p>
<p>②标签体中调用语法：</p>
<p>{call procedure_name(#{param1_info}, #{param2_info})}</p>
</li>
</ul>
<h4 id="4-自定义类型处理器"><a href="#4-自定义类型处理器" class="headerlink" title="4.自定义类型处理器"></a>4.自定义类型处理器</h4><p>通过自定义TypeHandler的形式来在设置参数或者取出结果集的时候自定义参数封装策略。</p>
<ul>
<li><p>步骤：</p>
<p>①实现TypeHandler接口或者继承BaseTypeHandler</p>
<p>②使用@MappedTypes定义处理的java类型，使用@MappedJdbcTypes定义处理的jdbcType类型</p>
<p>③在自定义结果集标签或者参数处理的时候声明使用自定义TypeHandler进行处理，或者在全局配置TypeHandler要处理的javaType</p>
</li>
</ul>
<blockquote>
<p>【说明】&copy;本文为学习笔记，参考自视频<a href="https://www.bilibili.com/video/BV1mW411M737" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1mW411M737</a>，如有侵权，请联系我删除。</p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/31/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" rel="prev" title="数据结构和算法">
      <i class="fa fa-chevron-left"></i> 数据结构和算法
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/16/JVM%E5%9F%BA%E7%A1%80/" rel="next" title="JVM基础">
      JVM基础 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、MyBatis简介"><span class="nav-number">1.</span> <span class="nav-text">一、MyBatis简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-MyBatis介绍"><span class="nav-number">1.1.</span> <span class="nav-text">1.MyBatis介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MyBatis历史"><span class="nav-number">1.2.</span> <span class="nav-text">2.MyBatis历史</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-为什么要使用MyBatis"><span class="nav-number">1.3.</span> <span class="nav-text">3.为什么要使用MyBatis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-MyBatis下载"><span class="nav-number">1.4.</span> <span class="nav-text">4.MyBatis下载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、MyBatis—HelloWorld"><span class="nav-number">2.</span> <span class="nav-text">二、MyBatis—HelloWorld</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-HelloWorld简单版"><span class="nav-number">2.1.</span> <span class="nav-text">1.HelloWorld简单版</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MyBatis操作数据库"><span class="nav-number">2.2.</span> <span class="nav-text">2.MyBatis操作数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-HelloWorld-接口式编程"><span class="nav-number">2.3.</span> <span class="nav-text">3.HelloWorld-接口式编程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-SqlSession"><span class="nav-number">2.4.</span> <span class="nav-text">4.SqlSession</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、MyBatis—全局配置文件"><span class="nav-number">3.</span> <span class="nav-text">三、MyBatis—全局配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0-dtd约束文件"><span class="nav-number">3.1.</span> <span class="nav-text">0.dtd约束文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-属性（properties）"><span class="nav-number">3.2.</span> <span class="nav-text">1.属性（properties）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-设置（settings）"><span class="nav-number">3.3.</span> <span class="nav-text">2.设置（settings）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-类型别名（typeAliases）"><span class="nav-number">3.4.</span> <span class="nav-text">3.类型别名（typeAliases）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-类型处理器（typeHandles）"><span class="nav-number">3.5.</span> <span class="nav-text">4.类型处理器（typeHandles）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-插件（plugins）"><span class="nav-number">3.6.</span> <span class="nav-text">5.插件（plugins）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-环境配置（environments）"><span class="nav-number">3.7.</span> <span class="nav-text">6.环境配置（environments）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-数据库厂商标识（databaseIdProvider）"><span class="nav-number">3.8.</span> <span class="nav-text">7.数据库厂商标识（databaseIdProvider）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-映射器（mappers）"><span class="nav-number">3.9.</span> <span class="nav-text">8.映射器（mappers）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-注意事项"><span class="nav-number">3.10.</span> <span class="nav-text">9.注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、MyBatis—映射文件"><span class="nav-number">4.</span> <span class="nav-text">四、MyBatis—映射文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-insert，-update-和-delete"><span class="nav-number">4.1.</span> <span class="nav-text">1.insert， update 和 delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-参数"><span class="nav-number">4.2.</span> <span class="nav-text">2.参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-select"><span class="nav-number">4.3.</span> <span class="nav-text">3.select</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、MyBatis—动态SQL"><span class="nav-number">5.</span> <span class="nav-text">五、MyBatis—动态SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-if"><span class="nav-number">5.1.</span> <span class="nav-text">1.if</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-trim"><span class="nav-number">5.2.</span> <span class="nav-text">2.trim</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-choose"><span class="nav-number">5.3.</span> <span class="nav-text">3.choose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-foreach"><span class="nav-number">5.4.</span> <span class="nav-text">4.foreach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-内置参数"><span class="nav-number">5.5.</span> <span class="nav-text">5.内置参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-sql"><span class="nav-number">5.6.</span> <span class="nav-text">6.sql</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、MyBatis—缓存机制"><span class="nav-number">6.</span> <span class="nav-text">六、MyBatis—缓存机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-一级缓存"><span class="nav-number">6.1.</span> <span class="nav-text">1.一级缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-二级缓存"><span class="nav-number">6.2.</span> <span class="nav-text">2.二级缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-缓存有关的设置以及属性"><span class="nav-number">6.3.</span> <span class="nav-text">3.缓存有关的设置以及属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-缓存原理图示"><span class="nav-number">6.4.</span> <span class="nav-text">4.缓存原理图示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-第三方缓存整合"><span class="nav-number">6.5.</span> <span class="nav-text">5.第三方缓存整合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#七、MyBatis—Spring整合"><span class="nav-number">7.</span> <span class="nav-text">七、MyBatis—Spring整合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#八、MyBatis—逆向工程"><span class="nav-number">8.</span> <span class="nav-text">八、MyBatis—逆向工程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-MyBatis-Generator"><span class="nav-number">8.1.</span> <span class="nav-text">1.MyBatis Generator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MBG的使用"><span class="nav-number">8.2.</span> <span class="nav-text">2.MBG的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#九、MyBatis—工作原理"><span class="nav-number">9.</span> <span class="nav-text">九、MyBatis—工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#十、MyBatis—插件开发"><span class="nav-number">10.</span> <span class="nav-text">十、MyBatis—插件开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-插件原理"><span class="nav-number">10.1.</span> <span class="nav-text">1.插件原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-插件编写"><span class="nav-number">10.2.</span> <span class="nav-text">2.插件编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-多个插件运行流程"><span class="nav-number">10.3.</span> <span class="nav-text">3.多个插件运行流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-开发插件"><span class="nav-number">10.4.</span> <span class="nav-text">4.开发插件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#十一、扩展：MyBatis—实用场景"><span class="nav-number">11.</span> <span class="nav-text">十一、扩展：MyBatis—实用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-PageHelper分页插件"><span class="nav-number">11.1.</span> <span class="nav-text">1.PageHelper分页插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-批量操作"><span class="nav-number">11.2.</span> <span class="nav-text">2.批量操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-存储过程"><span class="nav-number">11.3.</span> <span class="nav-text">3.存储过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-自定义类型处理器"><span class="nav-number">11.4.</span> <span class="nav-text">4.自定义类型处理器</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo-Fang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Leo-Fang</p>
  <div class="site-description" itemprop="description">记录学习笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Leo-Fang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Leo-Fang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lefang0530@gmail.com" title="E-Mail → mailto:lefang0530@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo-Fang</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共134.8k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'V6ESupTFrlogGO5niagnkvsh-gzGzoHsz',
      appKey     : 'aA5SS2K4SpyjvaSTnAUoxupj',
      placeholder: "ฅ՞•ﻌ•՞ฅ来唠唠嗑呗~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
